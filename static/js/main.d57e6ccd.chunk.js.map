{"version":3,"sources":["../node_modules/tableschema/lib/profiles sync /^/.//.*/.json$","redux/modules/modification.js","redux/modules/referenceTables.js","redux/modules/ui.js","redux/modules/flows.js","constants.js","redux/modules/repoData.js","redux/modules/schemaValidation.js","components/SummaryTable.js","components/ContextTable.js","utils/formUtils.js","components/FieldInput.js","components/FormatCorrection.js","components/NewResourceRow.js","components/NewRICentityForm.js","components/ReferenceResourceForm.js","components/ForeignkeyCorrection.js","containers/DataModification/ModificationComponent.js","components/AlertModal.js","containers/DataModification/DataModification.js","containers/DataModification/index.js","utils/fileExporter.js","components/GithubAuthModal.js","containers/DataPublish/DataPublish.js","containers/DataPublish/index.js","containers/DataPrep/DataPrep.js","containers/DataPrep/index.js","components/HeaderValidation.js","containers/FileUpload/FileUpload.js","containers/FileUpload/index.js","utils/fileParser.js","components/OverviewTable.js","containers/SchemaValidation/SchemaValidation.js","containers/SchemaValidation/index.js","containers/Layout/index.js","containers/Layout/Layout.js","components/LeaveModificationModal.js","App.js","serviceWorker.js","redux/rootReducer.js","redux/configureStore.js","index.js","../node_modules/datapackage/node_modules/tableschema/lib/profiles sync /^/.//.*/.json$","../node_modules/datapackage/lib/profiles sync /^/.//.*/.json$"],"names":["map","./geojson.json","./table-schema.json","./topojson.json","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","START_MODIFICATION","initialState","foreignKeyField","modificationIndex","modificationList","createReducer","SET_STEP","state","action","payload","REVALIDATE_ROWS_SUCCESS","originalValue","fixedValues","forEach","item","index","field","value","split","objectSpread","fixed","fixedStatus","unchangable","currency","year","reporting","REVALIDATE_ROWS_FAILURE","rowNumbers","errorRowNumbers","errors","err","rowNumber","isEqual","fixedValue","existItem","find","HIDE_MODIFICATION","SELECT_ERROR","GO_NEXT_ERROR","GO_PREV_ERROR","SUBMIT_MODIFICATION","INIT_TABLES","FETCH_TABLES_SUCCESS","_ref","referenceTables","originalLength","csvParse","d","mapValues","v","k","length","DELETE_TABLE_ROW","_ref2","data","resourceName","newTable","slice","filter","row","some","r","ADD_TABLE_ROW","_ref3","splice","apply","concat","toConsumableArray","SHOW_CONFIRMATION_MODAL","HIDE_CONFIRMATION_MODAL","setStep","dispatch","type","steps","name","title","isModalDisplay","selectedStep","isModification","fixedIndex","IMPORT_FLOWS","UPDATE_FLOWS","fieldList","error","columnNumber","indexOf","RANKED_FIELDS","flow","unit","species_bullions","transport_type","statistical_period","partner_sum","world_trade_type","notes","source","partner","export_import|special_general","currency|year|reporting","LABEL_FIELDS_FK_SOLVED","export_import","special_general","NON_CHANGABLE_FIELDS","re","source_generic_slugify","fields","f","trim","w","capitalize","replace","join","SOURCE_SLUGIFY","source_category","SOURCE_SLUG_FIELDS","SOURCE_SUGGESTION_FIELDS","FETCH_DATAPACKAGE_SUCCESS","FETCH_TABLES_FAILURE","FETCH_BRANCHES_SUCCESS","LOGOUT_USER","LOGIN_CREATE_BRANCH_SUCCESS","LOGIN_CREATE_BRANCH_FAILURE","UPDATE_REMOTE_FILES_REQUEST","UPDATE_REMOTE_FILES_LOG","UPDATE_REMOTE_FILES_SUCCESS","UPDATE_REMOTE_FILES_FAILURE","VALIDATE_TABLE_REQUEST","VALIDATE_TABLE_SUCCESS","VALIDATE_TABLE_FAILURE","VALIDATE_HEADER_REQUEST","VALIDATE_HEADER_SUCCESS","VALIDATE_HEADER_FAILURE","joinForeignKeyFields","getCollectedErrors","flows","schema","foreignKeys","allFields","foreignKeysList","formatFields","foreignKeysFields","foreignKey","errorTypes","formatErrors","reduce","res","defineProperty","errorType","foreignKeyErrors","joinedFields","originalRowNumber","selectedErrors","columnIndex","message","push","joinedColumn","columnName","values","schemaFeedback","headerFeedback","descriptor","getResourceName","schemaValidation","getResources","resources","getResourceSchema","createSelector","resource","group","getRelations","selectedResource","relations","key","tableName","reference","console","SummaryTable","className","onSelectError","columnNames","yearFormatValues","react_default","a","createElement","style","position","width","height","errorIndex","isNonchangableField","difference","handleSelectError","isCurrencyFixDisabled","isNull","components","fixedReferenceTable","table","isDisabled","isOutlined","isColor","onClick","ContextTable","modificationItem","errorColumn","rowIndex","errorColumnIndex","wordBreak","getEnumOptions","enumList","label","getOptions","tables","referenceField","valuesCounted","countBy","sortBy","toPairs","slicedToArray","_ref4","_ref5","FieldInput","props","_this","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","getStateFromProps","options","_this$props","fieldDescriptor","fieldValue","fieldSchema","Field","constraints","enum","fieldValid","valid","suggestions","validateField","castValue","setState","onChange","fieldName","handleChange","event","target","handleClickCreate","onClickCreate","referenceMap","onSuggestionsFetchRequested","suggestedOptions","inputValue","toLowerCase","inputLength","option","getSuggestions","onSuggestionsClearRequested","handleSuggestionChange","newValue","renderSuggestion","suggestion","prevProps","_this$props2","_this2","_this$props3","showNewReference","newReference","isNonchangable","isValidationField","_this$state","inputProps","placeholder","isReferenceField","generateValue","findIndex","react_select_browser_esm","isSearchable","isClearable","onInputChange","matchSorter","dist_default","getSuggestionValue","_this$state2","_this$props4","required","renderField","React","Component","FormatCorrection","hydrateState","showSolving","handleFieldChange","onTouch","handleSubmitForm","onSubmitForm","handleShowSolving","handleHideSolving","handleDiscard","onDiscard","printValue","isModificationTouched","isSubmitDisabled","components_FieldInput","isGrouped","isSize","renderOriginal","renderFixed","renderInput","NewResourceRow","overflow","RICname","continent","COW_code","NewRICentityForm","resourceDescriptor","handleChangeMulti","list","orderBy","multiParts","continentValue","continents","getContinent","fieldsInvalid","sortedFields","_this2$state$fields$f","isMulti","onCancel","newResource","part","RICname_group","RICname_part","onAddNew","castFormObject","formObject","ReferenceResourceForm","originalValues","prefixedValues","getSlug","preFields","slug","onSelectGroup","handleShowNew","handleHideNew","isRICentityGroup","handleCreateNewReference","resourceValid","handleAddNewReference","_this$state$reference","newRefReference","handleResetNewReference","handleSelectGroup","getReferenceDescriptor","handleAddNew","asyncToGenerator","regenerator_default","mark","_callee","_prefixedValues","rows","wrap","_context","prev","next","exchange_rates","modified_currency","Table","load","sent","read","forceCast","t0","stop","arguments","uniq","components_NewRICentityForm","components_NewResourceRow","ForeignKeyCorrection","initFixedValues","undefined","showNewForm","handleResetCreate","handleAddNewResource","special_field_for_label","handleCancel","handleSelectExist","i","referenceFieldResource","mapFieldValue","layoutColumn","getLayoutColumns","renderSolving","flex","components_ReferenceResourceForm","connect","validateResource","Resource","multiple","messages","onSubmitModification","handleSubmitModification","components_FormatCorrection","getFieldDescriptor","ForeignkeyCorrection","getForeignKeyField","components_ContextTable","AlertModal","isActive","closeModal","bodyContent","DataModification","handleTouchModification","touched","handleShowAlert","showAlert","handleHideAlert","nonFixedList","components_SummaryTable","selectError","display","justifyContent","currentIndex","DataModification_ModificationComponent","goNextError","hideModification","updateFlows","currencies","revalidateRows","prevFixedReferenceTable","deleteTableRow","addTableRow","submitModification","toString","marginLeft","goPrevError","components_AlertModal","modification","ui","status","_callee3","_context3","downloadFlow","array","fileName","ext","file","header","csvString","unparse","File","FileSaver","saveAs","sheet","XLSX","utils","aoa_to_sheet","wb","book_new","book_append_sheet","writeFile","downloadTable","GithubAuthModal","handleChangeToken","token","handleChangeMessage","handleSubmit","onSubmitAuth","isCommit","invalidInput","bloomer_min","DataPublish","handleOpenModal","isModalShow","handleCloseModal","repoData","selectedBranch","remoteUpdateStatus","lastCommit","remoteUpdateMessage","updatedTables","updatedRows","groupedFlows","sources","keyBy","s","parsedFlows","csvFormatRows","groupBy","deburr","log","path","href","owner","repoName","components_GithubAuthModal","auth","flowFiles","filePath","tableFiles","sha","updateRemoteFiles","files","branch","exportFlows","github","Octokat","repo","baseReference","flowRessourceMultipart","flowRessourceGroup","treeItems","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","exists","newRessource","_fileGit","fileGit","tree","commit","repos","fetch","git","refs","Symbol","iterator","done","includes","get","repoRawContent","responseType","responseEncoding","parse","response","blobs","create","content","Base64","encode","encoding","mode","t1","return","finish","JSON","stringify","trees","base_tree","object","commits","parents","update","t2","DataPrep","handleShowLogin","handleLogin","loginCreateBranch","isBranchCreated","fetchAllTables","isLogined","logoutUser","renderFetchTable","_callee2","userInfo","username","branches","refBranch","_context2","user","login","items","ref","then","tablesList","Promise","all","t","catch","HeaderValidation","diff","headerNames","fieldNames","diffLength","validationMap","Math","abs","prepareFlowData","FKFieldsIndices","fk","Array","isArray","set","FileUpload","importFlows","validateHeader","limit","headers","containers_DataPrep","maxSize","onDrop","reject","reader","FileReader","onload","bstr","result","wsname","SheetNames","ws","Sheets","sheet_to_json","defval","blankrows","onerror","readAsBinaryString","parseSheet","csvParseRows","tsvParse","readAsText","parseTable","onDropRejected","textAlign","components_HeaderValidation","OverviewTable","collectedErrors","orderedErrors","totalErrors","groupedErrors","distinctErrors","missingRows","SchemaValidation","validateTable","isRequiredFieldMissing","loader","components_OverviewTable","errorsList","groupedErrorsList","getGroupedErrors","startModification","_callee4","tableLength","chunkSize","chunks","chunkIndex","chunkedTable","chunkErrors","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","_context4","chunk","Layout","onSetStep","children","hasConfig","isConfig","step","isSelectedStep","isStepDisabled","isWorkspace","isSecondary","isPrimary","LeaveModificationModal","onSelectDiscard","onSelectDownload","showModal","hideModal","containers_Layout","containers_FileUpload","containers_SchemaValidation","containers_DataModification","containers_DataPublish","renderChildren","components_LeaveModificationModal","Boolean","window","location","hostname","match","combineReducers","persistConfig","storage","persistedReducer","persistReducer","rootReducer","store","middleware","thunk","composedEnhancers","compose","applyMiddleware","createStore","persistor","persistStore","configureStore","ReactDOM","render","es","src_App_0","document","getElementById","navigator","serviceWorker","ready","registration","unregister","./data-package.json","./data-resource.json","./fiscal-data-package.json","./registry.json","./tabular-data-package.json","./tabular-data-resource.json"],"mappings":"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","file":"static/js/main.d57e6ccd.chunk.js","sourcesContent":["var map = {\n\t\"./geojson.json\": 422,\n\t\"./table-schema.json\": 1054,\n\t\"./topojson.json\": 423\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 1053;","import { createReducer } from 'redux-starter-kit';\nimport { isEqual} from 'lodash'\n\n\nexport const SUBMIT_MODIFICATION = 'SUBMIT_MODIFICATION';\nexport const START_MODIFICATION = 'START_MODIFICATION';\n\nexport const startModification = (payload) => ({\n  type: START_MODIFICATION,\n  payload\n});\n\nexport const submitModification = (payload) => ({\n  type: SUBMIT_MODIFICATION,\n  payload\n});\n\n\nconst initialState = {\n  foreignKeyField: null,\n  modificationIndex: 0,\n  modificationList: null\n}\n\nexport default createReducer(initialState, {\n  SET_STEP: (state, action) => {\n    const {payload} = action;\n    if (payload.id === '0') {\n      return initialState\n    }\n  },\n  START_MODIFICATION: (state, action) => {\n    const {payload} = action;\n    state.modificationList = payload\n    state.modificationIndex = 0\n  },\n  REVALIDATE_ROWS_SUCCESS: (state, action) => {\n    // case 1: only year format error, no foreignkey error\n    const {payload} = action;\n    const {originalValue, fixedValues} = payload;\n    state.modificationList\n    .forEach((item, index) => {\n      if (item.field === 'currency|year|reporting' && item.value.split(\"|\")[1] === ''+originalValue) {\n        state.modificationList[index] = {\n          ...state.modificationList[index],\n          fixed: true,\n          fixedStatus: 'autoFixed',\n          unchangable: true,\n          fixedValues: {\n            'currency': item.value.split('|')[0],\n            'year': fixedValues['year'],\n            'reporting': item.value.split('|')[2]\n          }\n        }\n      }\n    })\n  },\n  REVALIDATE_ROWS_FAILURE: (state, action) => {\n    // case 2,3: voilation relations\n    const {payload} = action;\n    const {fixedValues, rowNumbers} = payload;\n    state.modificationList\n    .forEach((item, index) => {\n      const errorRowNumbers = item.errors.map((err) => err.rowNumber);\n      if (item.field === 'currency|year|reporting' && isEqual(errorRowNumbers, rowNumbers)) {\n        const fixedValue = item.value.split(\"|\")[0] + '|' + fixedValues['year'] + '|' + item.value.split(\"|\")[2];\n        const existItem = state.modificationList.find((item) => item.value === fixedValue)\n        if ( existItem && existItem.index !== index) {\n          // case 2: fixed formatted year rows values of (currency|year|reporting) are same with other rows\n          state.modificationList[index] = {\n            ...state.modificationList[index],\n            fixed: true,\n            fixedStatus: 'fixInOther',\n            unchangable: true,\n            fixedValues: {\n              'currency': item.value.split('|')[0],\n              'year': fixedValues['year'],\n              'reporting': item.value.split('|')[2]\n            }\n          }\n        } else {\n          // case 3: fixed formatted year rows are new combo of (currency|year|reporting)\n          state.modificationList[index] = {\n            ...state.modificationList[index],\n            fixed: false,\n            fixedStatus: 'notFixed',\n            unchangable: false,\n            value: fixedValue,\n            fixedValues: null\n          }\n        } \n      }\n    })\n  },\n  HIDE_MODIFICATION: (state, action) => {\n    state.modificationIndex = 0\n  },\n  SELECT_ERROR: (state, action) => {\n    const {payload} = action;\n    state.modificationIndex = payload.index;\n  },\n  GO_NEXT_ERROR: (state, action) => {\n    state.modificationIndex = state.modificationIndex + 1\n  },\n  GO_PREV_ERROR: (state, action) => {\n    if (state.modificationIndex > 0) {\n      state.modificationIndex = state.modificationIndex - 1\n    }\n  },\n  SUBMIT_MODIFICATION: (state, action) => {\n    const {payload} = action;\n    state.modificationList[payload.index] = {\n      ...state.modificationList[payload.index],\n      ...payload,\n      fixed: true\n    }\n  }\n})\n\n","import { createReducer } from 'redux-starter-kit';\n\nimport {\n  csvParse,\n} from 'd3-dsv';\n\nimport {isEqual, mapValues} from 'lodash';\n\n\nexport const ADD_TABLE_ROW = 'ADD_TABLE_ROW';\nexport const INIT_TABLES = 'INIT_TABLES';\nexport const DELETE_TABLE_ROW = 'DELETE_TABLE_ROW';\n\nexport const initTables = () => ({\n  type: INIT_TABLES,\n})\n\nexport const addTableRow = (payload) => ({\n  type: ADD_TABLE_ROW,\n  payload\n})\n\nexport const deleteTableRow = (payload) => ({\n  type: DELETE_TABLE_ROW,\n  payload\n})\n\nconst initialState = {};\n\n\nexport default createReducer(initialState, {\n  INIT_TABLES: (state) => {\n    return initialState;\n  },\n  FETCH_TABLES_SUCCESS: (state, {payload}) => {\n    const referenceTables = {}\n    const originalLength = {}\n    Object.keys(payload).forEach((id) => {\n      // TODO : use datapackage to load those data\n      referenceTables[id] = csvParse(payload[id], (d) => {\n        const newD = mapValues(d, (v,k) => {\n          //cast year to integer\n          if (k === 'year')\n            return +v\n          // cast empty string to null (in datapackage '' default to missing value)\n          if (v === '')\n            return null\n          return v\n        });\n        return newD;\n      })\n      originalLength[id] = referenceTables[id].length\n    })\n    state.referenceTables = referenceTables;\n    state.originalLength = originalLength\n  },\n  DELETE_TABLE_ROW: (state, {payload}) => {\n    const {data, resourceName} = payload;\n    let newTable = state.referenceTables[resourceName].slice();\n    newTable = newTable.filter((row) =>{\n      return !data.some((r) => { return isEqual(row, r) })\n    });\n    state.referenceTables[resourceName] = newTable\n  },\n  ADD_TABLE_ROW: (state, {payload}) => {\n    const {data, resourceName} = payload;\n    const newTable = state.referenceTables[resourceName].slice();\n    newTable.splice(newTable.length, 0, ...data);\n    state.referenceTables[resourceName] = newTable;\n  },\n})","import {\n  START_MODIFICATION,\n} from './modification';\n\nimport {INIT_TABLES} from './referenceTables';\n\nexport const SET_STEP = 'SET_STEP';\n\n// export const SHOW_MODIFICATION = 'SHOW_MODIFICATION';\nexport const HIDE_MODIFICATION = 'HIDE_MODIFICATION';\n\nexport const GO_NEXT_ERROR = 'GO_NEXT_ERROR';\nexport const GO_PREV_ERROR = 'GO_PREV_ERROR';\nexport const SELECT_ERROR = 'SELECT_ERROR';\n\nexport const SHOW_CONFIRMATION_MODAL = 'SHOW_CONFIRMATION_MODAL';\nexport const HIDE_CONFIRMATION_MODAL = 'HIDE_CONFIRMATION_MODAL';\n\nexport const setStep = (payload) => (dispatch) => {\n  if (payload.id === '0') {\n    dispatch({\n      type: INIT_TABLES\n    })\n  }\n  dispatch({\n    type: SET_STEP,\n    payload\n  });\n}\n\nexport const showModal = () => ({\n  type: SHOW_CONFIRMATION_MODAL\n})\n\nexport const hideModal = () => ({\n  type: HIDE_CONFIRMATION_MODAL\n})\n\nexport const hideModification = () => ({\n  type: HIDE_MODIFICATION,\n});\n\nexport const selectError = (payload) => ({\n  type: SELECT_ERROR,\n  payload\n});\n\nexport const goPrevError = () => ({\n  type: GO_PREV_ERROR,\n});\n\nexport const goNextError = () => ({\n  type: GO_NEXT_ERROR,\n});\n\nconst steps = [\n  {\n    id: '0',\n    name: 'Upload file',\n    title: 'Choose a file'\n  },\n  {\n    id: '1',\n    name: 'Schema Validation',\n    title: 'Schema validation against datapackage'\n  },\n  {\n    id: '2',\n    name: 'Error Fixing',\n    title: 'Fix errors by fields'\n  },\n  {\n    id: '3',\n    name: 'Export/Publish Data',\n    title: 'Export or Publish your data to Github'\n  }\n];\n\nconst initialState = {\n  steps, \n  isModalDisplay: false,\n  selectedStep: steps[0],\n  isModification: false,\n  // modificationIndex: 0,\n  fixedIndex: []\n}\n\nexport default function reducer(state = initialState, action){\n  const {payload} = action;\n  switch (action.type){\n    case SET_STEP:\n      return {\n        ...initialState,\n        selectedStep: steps.find((step) => payload.id === step.id),\n      }\n    case SHOW_CONFIRMATION_MODAL:\n      return {\n        ...state,\n        isModalDisplay: true\n      }\n    case HIDE_CONFIRMATION_MODAL:\n      return {\n        ...state,\n        isModalDisplay: false\n      }\n    case START_MODIFICATION:\n      return {\n        ...state,\n        isModification: true,\n        // modificationIndex: 0\n      }\n    case HIDE_MODIFICATION:\n      return {\n        ...state,\n        isModification: false,\n        // modificationIndex: 0\n      }\n    case SELECT_ERROR: \n      return {\n        ...state,\n        isModification: true,\n        // modificationIndex: payload.index\n      }\n    // case GO_NEXT_ERROR:\n    //   return {\n    //     ...state,\n    //     modificationIndex: state.modificationIndex + 1\n    //   }\n    // case GO_PREV_ERROR:\n    //   if (state.modificationIndex === 0) return;\n    //   return {\n    //     ...state,\n    //     modificationIndex: state.modificationIndex - 1\n    //   }\n    default:\n     return state\n  }\n}","import { createReducer } from 'redux-starter-kit';\n\nexport const UPDATE_FLOWS = 'UPDATE_FLOWS';\nexport const IMPORT_FLOWS = 'IMPORT_FLOWS';\nexport const EXPORT_FLOWS = 'EXPORT_FLOWS';\n\nexport const updateFlows = (payload) => ({\n  type: UPDATE_FLOWS,\n  payload\n});\n\nexport const importFlows = (payload) => ({\n  type: IMPORT_FLOWS,\n  payload\n});\n\nexport const exportFlows = (payload) => ({\n  type: EXPORT_FLOWS\n});\n\n\nconst initialState = {}\n\nexport default createReducer(initialState, {\n  SET_STEP: (state, action) => {\n    const {payload} = action;\n    if (payload.id === '0') {\n      return initialState\n    }\n  },\n  IMPORT_FLOWS: (state, action) => {\n    const {payload} = action;\n    return payload\n  },\n  UPDATE_FLOWS: (state, action) => {\n    const {payload} = action;\n    const {errors, fixedValues} = payload;\n    const fieldList = Object.keys(fixedValues)\n    errors.forEach((error) => {\n      fieldList.forEach((field) => {\n        const columnNumber = state.data[0].indexOf(field);\n        state.data[error.rowNumber -1][columnNumber] = fixedValues[field];\n      })\n    })\n  }\n})\n","import {capitalize, deburr} from 'lodash';\n\nexport const MAXIMUM_FILE_SIZE = 10000000;\nexport const DEFAULT_CHUNK_SIZE = 100;\nexport const DEFAULT_REF_BRANCH = 'master';\n\nexport const RANKED_FIELDS = {\n  \"id\": 0,\n  'flow': 1,\n  \"unit\": 2,\n  \"year\": 3,\n  \"species_bullions\": 4,\n  \"transport_type\": 5,\n  \"statistical_period\": 6,\n  \"partner_sum\": 7,\n  \"world_trade_type\": 8,\n  \"notes\": 9,\n  \"source\": 10,\n  \"reporting\": 11,\n  \"partner\": 12,\n  \"export_import|special_general\": 13,\n  \"currency|year|reporting\": 14\n}\n\nexport const LABEL_FIELDS_FK_SOLVED = {\n  'partner': 'RICname',\n  'reporting': 'RICname',\n  'currency': 'modified_currency',\n  'export_import': 'modified_export_import',\n  'special_general': 'modified_special_general'\n}\nexport const NON_CHANGABLE_FIELDS = ['slug', 'export_import', 'special_general', 'reporting', 'partner', 'original_name', 'currency', 'year']\n\nexport const SOURCE_SLUG_FIELDS = source => [ source.source_category === 'website' ? 'editor' : 'author','name', 'country', 'volume_date', 'volume_number', 'pages'];\n\nconst re = /[^a-zA-Z0-9]+/g;\nconst  source_generic_slugify = (source, fields) => fields.map(f => {\n  if (source[f]){\n    return source[f].trim().split(' ').map(w => capitalize(w.replace(re, ''))).join('')\n  }\n  else\n    return null;\n  \n}, '').filter(e => e).join('_');\n\nexport const SOURCE_SLUGIFY = source => source_generic_slugify(source, SOURCE_SLUG_FIELDS(source))\n\nexport const SOURCE_SLUG_FILENAME = source => deburr(source_generic_slugify(source,\n  [ source.source_category === 'website' ? 'editor' : 'author','name', 'country', 'volume_date', 'volume_number']));\n\nexport const SOURCE_SUGGESTION_FIELDS = ['name', 'editor', 'country', 'volumn_number', 'shelf_number']","import { get, post } from \"axios\";\nimport {\n  apiUri,\n  branchUri,\n  referenceUri,\n  owner,\n  repoName,\n  repoRawContent,\n} from \"../../config/default\";\nimport { DEFAULT_REF_BRANCH } from \"../../constants\";\n\nimport Octokat from \"octokat\";\n\nimport { Base64 } from \"js-base64\";\nimport { unparse, parse } from \"papaparse\";\n\nimport { INIT_TABLES } from \"./referenceTables\";\n\nexport const FETCH_TABLE_REQUEST = \"FETCH_TABLE_REQUEST\";\nexport const FETCH_TABLE_SUCCESS = \"FETCH_TABLE_SUCCESS\";\nexport const FETCH_TABLE_FAILURE = \"FETCH_TABLE_FAILURE\";\n\nexport const FETCH_DATAPACKAGE_REQUEST = \"FETCH_DATAPACKAGE_REQUEST\";\nexport const FETCH_DATAPACKAGE_SUCCESS = \"FETCH_DATAPACKAGE_SUCCESS\";\nexport const FETCH_DATAPACKAGE_FAILURE = \"FETCH_DATAPACKAGE_FAILURE\";\n\nexport const FETCH_TABLES_REQUEST = \"FETCH_TABLES_REQUEST\";\nexport const FETCH_TABLES_SUCCESS = \"FETCH_TABLES_SUCCESS\";\nexport const FETCH_TABLES_FAILURE = \"FETCH_TABLES_FAILURE\";\n\nexport const FETCH_BRANCHES_REQUEST = \"FETCH_BRANCHES_REQUEST\";\nexport const FETCH_BRANCHES_SUCCESS = \"FETCH_BRANCHES_SUCCESS\";\nexport const FETCH_BRANCHES_FAILURE = \"FETCH_BRANCHES_FAILURE\";\n\nexport const CREATE_BRANCH_REQUEST = \"CREATE_BRANCH_REQUEST\";\nexport const CREATE_BRANCH_SUCCESS = \"CREATE_BRANCH_SUCCESS\";\nexport const CREATE_BRANCH_FAILURE = \"CREATE_BRANCH_FAILURE\";\n\nexport const LOGOUT_USER = \"LOGOUT_USER\";\n\nexport const LOGIN_CREATE_BRANCH_REQUEST = \"LOGIN_CREATE_BRANCH_REQUEST\";\nexport const LOGIN_CREATE_BRANCH_SUCCESS = \"LOGIN_CREATE_BRANCH_SUCCESS\";\nexport const LOGIN_CREATE_BRANCH_FAILURE = \"LOGIN_CREATE_BRANCH_FAILURE\";\n\nexport const UPDATE_REMOTE_FILES_REQUEST = \"UPDATE_REMOTE_FILES_REQUEST\";\nexport const UPDATE_REMOTE_FILES_LOG = \"UPDATE_REMOTE_FILES_LOG\";\nexport const UPDATE_REMOTE_FILES_SUCCESS = \"UPDATE_REMOTE_FILES_SUCCESS\";\nexport const UPDATE_REMOTE_FILES_FAILURE = \"UPDATE_REMOTE_FILES_FAILURE\";\n\nconst DEFAULT_MESSAGE = \"update data\";\n/**\n * ACTIONS\n */\n\nexport const fetchBranches = (payload) => (dispatch) => {\n  dispatch({\n    type: FETCH_BRANCHES_REQUEST,\n    payload,\n  });\n  return get(branchUri)\n    .then((res) => {\n      return dispatch({\n        type: FETCH_BRANCHES_SUCCESS,\n        payload: {\n          ...payload,\n          branches: res.data,\n        },\n      });\n    })\n    .catch((error) =>\n      dispatch({\n        type: FETCH_BRANCHES_FAILURE,\n        payload,\n        error,\n      })\n    );\n};\n\nexport const fetchTable = (payload) => (dispatch) => {\n  const { branch, table } = payload;\n  dispatch({\n    type: FETCH_TABLE_REQUEST,\n    payload,\n  });\n  return get(`${apiUri}/${table.path}?ref=${branch}`)\n    .then((res) =>\n      dispatch({\n        type: FETCH_TABLE_SUCCESS,\n        payload: {\n          ...payload,\n          data: res.data,\n        },\n      })\n    )\n    .catch((error) =>\n      dispatch({\n        type: FETCH_TABLE_FAILURE,\n        payload,\n        error,\n      })\n    );\n};\n\nexport const fetchAllTables = (payload) => (dispatch) => {\n  const { branch } = payload;\n  // let's get the datapackage from the branch\n  dispatch({\n    type: FETCH_DATAPACKAGE_REQUEST,\n  });\n  try {\n    get(`${repoRawContent}/${branch}/datapackage.json`, {\n      responseType: \"json\",\n      responseEncoding: \"utf8\",\n    }).then((res) => {\n      const descriptor = res.data;\n      const tablesList = descriptor.resources.filter(\n        (r) => !r.group && r.name !== \"flows\"\n      );\n      dispatch({\n        type: FETCH_DATAPACKAGE_SUCCESS,\n        payload: descriptor,\n      });\n      // now we can get tables\n      dispatch({\n        type: FETCH_TABLES_REQUEST,\n      });\n      Promise.all(\n        tablesList.map((table) => {\n          return get(`${repoRawContent}/${branch}/${table.path}`, {\n            responseType: \"text\",\n            responseEncoding: \"utf8\",\n          }).then((res) => {\n            return { ...table, data: res.data };\n          });\n        })\n      )\n        .then((res) => {\n          let tables = {};\n          res.forEach((t) => {\n            tables[t.name] = t.data;\n          });\n          dispatch({\n            type: FETCH_TABLES_SUCCESS,\n            payload: tables,\n          });\n        })\n        .catch((error) => {\n          console.log(error);\n          dispatch({\n            type: FETCH_TABLES_FAILURE,\n            payload,\n            error,\n          });\n        });\n    });\n  } catch (error) {\n    console.log(error);\n    dispatch({\n      type: FETCH_DATAPACKAGE_FAILURE,\n      error,\n    });\n  }\n};\n\nexport const updateRemoteFiles = (payload) => (dispatch) => {\n  dispatch({\n    type: UPDATE_REMOTE_FILES_REQUEST,\n  });\n  const { files, branch, auth, descriptor } = payload;\n\n  const github = new Octokat({\n    token: auth.token,\n  });\n\n  dispatch(async () => {\n    try {\n      let repo = await github.repos(owner, repoName).fetch();\n      let baseReference = await repo.git.refs(`heads/${branch}`).fetch();\n      let flowRessourceMultipart = descriptor.resources.find(\n        (r) => r.name === \"flows\"\n      );\n      let flowRessourceGroup = descriptor.resources.find(\n        (r) => r.group === \"flows\"\n      );\n      let treeItems = [];\n      for (let file of files) {\n        if (!file.sha && file.filePath.includes(\"flows\")) {\n          //new file flow ?\n          //check if file already exists\n          dispatch({\n            type: UPDATE_REMOTE_FILES_LOG,\n            payload: `downloading existing flows file ${file.filePath}`,\n          });\n          try {\n            const exists = await get(\n              `${repoRawContent}/${branch}/${file.filePath}`,\n              { responseType: \"text\", responseEncoding: \"utf8\" }\n            );\n            if (exists.status === 200) {\n              // append new rows at end of the existing file\n              file.data = parse(exists.data).concat(file.data);\n            }\n          } catch (error) {\n            if (error.response && error.response.status === 404) {\n              // that's a 404 error which is fine\n              // it's a new file, add it to the datapackage see issue #70\n              if (flowRessourceMultipart) {\n                flowRessourceMultipart.path.push(file.filePath);\n              } else if (flowRessourceGroup) {\n                const newRessource = { ...flowRessourceGroup };\n                newRessource.path = file.filePath;\n                newRessource.title = file.source;\n                descriptor.resources.push(newRessource);\n              }\n            } else console.log(error);\n            dispatch({\n              type: UPDATE_REMOTE_FILES_FAILURE,\n              error,\n            });\n          }\n        }\n        dispatch({\n          type: UPDATE_REMOTE_FILES_LOG,\n          payload: `uploading ${file.filePath}`,\n        });\n        let fileGit = await repo.git.blobs.create({\n          // we force one final empty line\n          content: Base64.encode(unparse(file.data) + \"\\r\\n\"),\n          encoding: \"base64\",\n        });\n        treeItems.push({\n          path: file.filePath,\n          sha: fileGit.sha,\n          mode: \"100644\",\n          type: \"blob\",\n        });\n      }\n      // commit new version of the datapackage\n      dispatch({\n        type: UPDATE_REMOTE_FILES_LOG,\n        payload: `uploading datapackage`,\n      });\n      let fileGit = await repo.git.blobs.create({\n        content: Base64.encode(JSON.stringify(descriptor, null, 2)),\n        encoding: \"base64\",\n      });\n      let filePath = `datapackage.json`;\n      treeItems.push({\n        path: filePath,\n        sha: fileGit.sha,\n        mode: \"100644\",\n        type: \"blob\",\n      });\n      dispatch({\n        type: UPDATE_REMOTE_FILES_LOG,\n        payload: `creating tree`,\n      });\n      let tree = await repo.git.trees.create({\n        tree: treeItems,\n        base_tree: baseReference.object.sha,\n      });\n      dispatch({\n        type: UPDATE_REMOTE_FILES_LOG,\n        payload: `creating commit`,\n      });\n      let commit = await repo.git.commits.create({\n        message: auth.message || DEFAULT_MESSAGE,\n        tree: tree.sha,\n        parents: [baseReference.object.sha],\n      });\n\n      baseReference.update({ sha: commit.sha });\n      dispatch({\n        type: UPDATE_REMOTE_FILES_SUCCESS,\n        payload: commit.sha,\n      });\n    } catch (err) {\n      console.error(err);\n      dispatch({\n        type: UPDATE_REMOTE_FILES_FAILURE,\n        err,\n      });\n    }\n  });\n};\n\nexport const createBranch = (payload) => (dispatch) => {\n  dispatch({\n    type: CREATE_BRANCH_REQUEST,\n  });\n\n  const { auth, branch, reference } = payload;\n  const data = {\n    ref: `refs/heads/${branch}`,\n    sha: reference.sha,\n  };\n\n  return post(referenceUri, data, {\n    auth: {\n      username: auth.username,\n      password: auth.token,\n    },\n  })\n    .then((res) =>\n      dispatch({\n        type: CREATE_BRANCH_SUCCESS,\n        payload: {\n          name: auth.username,\n          ref: res.data,\n        },\n      })\n    )\n    .catch((error) =>\n      dispatch({\n        type: CREATE_BRANCH_FAILURE,\n        error,\n      })\n    );\n};\n\nexport const logoutUser = () => ({\n  type: LOGOUT_USER,\n});\n\nexport const loginCreateBranch = (payload) => (dispatch) => {\n  dispatch({\n    type: LOGIN_CREATE_BRANCH_REQUEST,\n    payload,\n  });\n  const { token } = payload;\n\n  const github = new Octokat({\n    token: token,\n  });\n\n  dispatch(async () => {\n    try {\n      let userInfo = await github.user.fetch();\n      const username = userInfo.login;\n      let repo = await github.repos(owner, repoName).fetch();\n      let branches = await repo.branches.fetch();\n      let selectedBranch = branches.items.find(\n        (branch) => branch.name === username\n      );\n      if (!selectedBranch) {\n        const refBranch = branches.items.find(\n          (branch) => branch.name === DEFAULT_REF_BRANCH\n        );\n        selectedBranch = await repo.git.refs.create({\n          ref: `refs/heads/${username}`,\n          sha: refBranch.commit.sha,\n        });\n      }\n      dispatch({\n        type: LOGIN_CREATE_BRANCH_SUCCESS,\n        payload: {\n          name: username,\n          ref: selectedBranch,\n        },\n      });\n    } catch (error) {\n      console.error(error);\n      dispatch({\n        type: LOGIN_CREATE_BRANCH_FAILURE,\n        payload: {\n          error,\n        },\n      });\n    }\n  });\n};\n\n/**\n * REDUCER\n */\n\nconst initialState = {};\n\nexport default function reducer(state = initialState, action) {\n  const { payload } = action;\n  switch (action.type) {\n    case LOGOUT_USER:\n      return {\n        ...state,\n        isLogined: false,\n        tables: null,\n        selectedBranch: null,\n        isBranchCreated: false,\n      };\n    case INIT_TABLES:\n      return {\n        ...state,\n        tables: null,\n        remoteUpdateStatus: null,\n      };\n    case FETCH_TABLES_SUCCESS:\n      return {\n        ...state,\n        tables: payload,\n      };\n    case FETCH_TABLES_FAILURE:\n      return {\n        ...state,\n        tables: null,\n      };\n    case FETCH_DATAPACKAGE_SUCCESS:\n      return {\n        ...state,\n        descriptor: payload,\n      };\n    case FETCH_BRANCHES_SUCCESS:\n      return {\n        ...state,\n        branches: payload.branches,\n      };\n    case LOGIN_CREATE_BRANCH_SUCCESS:\n      return {\n        ...state,\n        isLogined: true,\n        selectedBranch: payload,\n        isBranchCreated: true,\n      };\n    case LOGIN_CREATE_BRANCH_FAILURE:\n      return {\n        ...state,\n        isLogined: false,\n        selectedBranch: null,\n        isBranchCreated: false,\n      };\n    case UPDATE_REMOTE_FILES_REQUEST:\n      return {\n        ...state,\n        remoteUpdateStatus: \"loading\",\n        lastCommit: null,\n        remoteUpdateMessage: null,\n      };\n    case UPDATE_REMOTE_FILES_LOG:\n      return {\n        ...state,\n        remoteUpdateStatus: \"loading\",\n        remoteUpdateMessage: payload,\n      };\n    case UPDATE_REMOTE_FILES_SUCCESS:\n      return {\n        ...state,\n        remoteUpdateStatus: \"updated\",\n        lastCommit: payload,\n      };\n    case UPDATE_REMOTE_FILES_FAILURE:\n      return {\n        ...state,\n        remoteUpdateStatus: \"fail\",\n      };\n    default:\n      return state;\n  }\n}\n","import { createSelector } from 'reselect'\n\nimport {chunk, groupBy, sortBy, values } from 'lodash';\nimport {Resource} from 'datapackage';\nimport {Table} from 'tableschema';\nimport {SET_STEP} from './ui';\n\nimport {DEFAULT_CHUNK_SIZE, RANKED_FIELDS} from '../../constants';\n\nimport {\n  FETCH_DATAPACKAGE_SUCCESS,\n} from './repoData';\n\n\nexport const VALIDATE_RESOURCE_REQUEST = 'VALIDATE_RESOURCE_REQUEST';\nexport const VALIDATE_RESOURCE_SUCCESS = 'VALIDATE_RESOURCE_SUCCESS';\nexport const VALIDATE_RESOURCE_FAILURE = 'VALIDATE_RESOURCE_FAILURE';\n\nexport const VALIDATE_TABLE_REQUEST = 'VALIDATE_TABLE_REQUEST';\nexport const VALIDATE_TABLE_SUCCESS = 'VALIDATE_TABLE_SUCCESS';\nexport const VALIDATE_TABLE_FAILURE = 'VALIDATE_TABLE_FAILURE';\n\nexport const VALIDATE_HEADER_REQUEST = 'VALIDATE_HEADER_REQUEST';\nexport const VALIDATE_HEADER_SUCCESS = 'VALIDATE_HEADER_SUCCESS';\nexport const VALIDATE_HEADER_FAILURE = 'VALIDATE_HEADER_FAILURE';\n\nexport const REVALIDATE_ROWS_REQUEST = 'REVALIDATE_ROWS_REQUEST';\nexport const REVALIDATE_ROWS_SUCCESS = 'REVALIDATE_ROWS_SUCCESS';\nexport const REVALIDATE_ROWS_FAILURE = 'REVALIDATE_ROWS_FAILURE';\n\n\nconst joinForeignKeyFields = (fields) => {\n  if (typeof(fields) === 'string') return fields;\n  else return fields.join('|');\n};\n\n// const getForeignKeyFields = (fields) => {\n//   return fields.reduce((res, field) => {\n//     if (typeof(field) === 'string') return res.concat([field]);\n//     else return res.concat(field)\n//   }, []);\n// } \n\nconst getCollectedErrors = (flows, schema, errors) => {\n  const {fields, foreignKeys} = schema;\n\n  const allFields = fields.map((field)=> field.name);\n  // const foreignKeysList = getForeignKeyFields(foreignKeys.map((d) => d.fields));\n  // TODO: hardcoded\n  const foreignKeysList = [\"source\", \"export_import\", \"special_general\", \"currency\"];\n\n  const formatFields = fields.filter((field) => foreignKeysList.indexOf(field.name) === -1)\n  const foreignKeysFields = foreignKeys.map((foreignKey) => joinForeignKeyFields(foreignKey.fields));\n\n  const errorTypes = ['ERROR_FORMAT', 'ERROR_FOREIGN_KEY'];\n\n  const formatErrors = formatFields.reduce((res, field) => {\n    return {\n      ...res,\n      [field.name]: {\n        name: field.name,\n        schema: field,\n        errorType: 'ERROR_FORMAT',\n        errors: []\n      }\n    }\n  }, {});\n\n  const foreignKeyErrors = foreignKeys.reduce((res, foreignKey) => {\n    const joinedFields = joinForeignKeyFields(foreignKey.fields);\n    // const foreignKeySchema = fields.find((field) => field.name === foreignKey.fields)\n    return {\n      ...res,\n      [joinedFields]: {\n        name: joinedFields,\n        ...foreignKey,\n        errorType: 'ERROR_FOREIGN_KEY',\n        errors: []\n      }\n    }\n  }, {});\n\n  errors.forEach((error)=>{\n    const row = flows[error.rowNumber -1];\n    const {rowNumber, originalRowNumber} = error;\n    errorTypes.forEach((errorType) => {\n      const selectedErrors = error.errors.find((err) => err.type === errorType)\n      if(!selectedErrors) return;\n      if(errorType === 'ERROR_FORMAT') {\n        allFields.forEach((field, columnIndex) => {\n          selectedErrors.errors.forEach((err) => {\n            if (err.columnNumber === columnIndex + 1 && foreignKeysList.indexOf(field) === -1) {\n              const item = {\n                rowNumber,\n                errorType,\n                columnNumber: err.columnNumber,\n                field,\n                value: row[columnIndex],\n                message: err.message\n              }\n              formatErrors[field].errors.push(item)\n            }\n          })\n        })\n      }\n\n      else if (errorType === 'ERROR_FOREIGN_KEY') {\n        foreignKeysFields.forEach((fields) => {\n          selectedErrors.errors.forEach((err) => {\n            // const fieldsList = fields.split('|');\n            const joinedColumn = joinForeignKeyFields(err.columnName);\n            if (joinedColumn === fields) {\n              const values = err.columnName.map((field) => {\n                const columnIndex = allFields.indexOf(field);\n                return row[columnIndex]\n              })\n              const item = {\n                rowNumber,\n                originalRowNumber,\n                errorType,\n                columnName: err.columnName,\n                field: joinedColumn,\n                value: values.join('|'),\n                message: err.message\n              }\n              foreignKeyErrors[fields].errors.push(item)\n            }\n          })\n        })\n      }\n    })\n  });\n\n  Object.keys(formatErrors).forEach((columnName) => {\n    if(!formatErrors[columnName].errors.length) {\n      delete formatErrors[columnName]\n    }\n  });\n\n  Object.keys(foreignKeyErrors).forEach((columnName) => {\n    if(!foreignKeyErrors[columnName].errors.length) {\n      delete foreignKeyErrors[columnName]\n    }\n  });\n  if (formatErrors['reporting'] || formatErrors['partner']) {\n    return formatErrors\n  }\n  return {\n    ...formatErrors,\n    ...foreignKeyErrors\n  }\n}\n\n// not used yet\nexport const validateResource = (payload) => (dispatch) => {\n  const {descriptor} = payload;\n  dispatch(async () => {\n    let resource;\n    try {\n      // const dataPackage = await Package.load(descriptor);\n      // resource = dataPackage.getResource(resourceName);\n      resource = Resource.load(descriptor);\n      await resource.read()\n      \n      dispatch({\n        type: VALIDATE_RESOURCE_SUCCESS,\n        payload: {\n          valid: true\n        }\n      })\n    } catch (error) {\n      console.error(error)\n      if (error.multiple) {\n        dispatch({\n          type: VALIDATE_RESOURCE_FAILURE,\n          payload : {\n            rowNumber: error.rowNumber,\n            messages: error.errors.map((err) => { \n              return {\n              ...err,\n              message: err.message\n              }\n            })\n          }\n        })\n      } else {\n        dispatch({\n          type: VALIDATE_RESOURCE_FAILURE,\n          payload : {\n            rowNumber: error.rowNumber,\n            messages: [\n              {\n                ...error,\n                message: error.message\n              }\n            ]\n          }\n        })\n      }\n    }\n  })\n}\n\nexport const validateHeader = (payload) => (dispatch) => {\n  const {source, schema} = payload;\n  dispatch({\n    type: VALIDATE_HEADER_REQUEST,\n    payload: {\n      ...payload,\n      status: 'loading'\n    }\n  })\n  dispatch(async() => {\n    let table;\n    try {\n      table = await Table.load(source.slice(0,2), {schema});\n      await table.read({limit: 1});\n      dispatch({\n        type: VALIDATE_HEADER_SUCCESS,\n        payload: {\n          status: 'done',\n          valid: true,\n          headers: table.headers\n        }\n      })\n    } catch (error) {\n      console.error(error)\n      if (error.type !== 'ERROR_HEADER') {\n        dispatch({\n          type: VALIDATE_HEADER_SUCCESS,\n          payload: {\n            status: 'done',\n            valid: true,\n            headers: table.headers\n          }\n        })\n      } else {\n        dispatch({\n          type: VALIDATE_HEADER_FAILURE,\n          valid: false,\n          status: 'done',\n          payload: error\n        })\n      }\n    }\n  })\n}\n\nexport const revalidateRows = (payload) => (dispatch) => {\n  const {rowNumbers, originalValue, fixedValues, source, schema, relations} = payload;\n\n  dispatch({\n    type: REVALIDATE_ROWS_REQUEST,\n    payload: {\n      ...payload,\n      status: 'loading'\n    }\n  })\n  dispatch(async() => {\n    let table;\n    try {\n      table = await Table.load(source, {schema});\n      const rows = await table.read({forceCast: true, relations});\n      const errors = rows.filter((row) => row.errors);\n\n      if (errors.length) {\n        dispatch({\n          type: REVALIDATE_ROWS_FAILURE,\n          payload: {\n            status: 'done',\n            valid: false,\n            rowNumbers,\n            originalValue,\n            fixedValues\n          }\n        })\n      } else {\n        dispatch({\n          type: REVALIDATE_ROWS_SUCCESS,\n          payload: {\n            status: 'done',\n            valid: true,\n            rowNumbers,\n            originalValue,\n            fixedValues\n          }\n        })\n      }\n    } catch (error) {\n      console.error(error)\n      dispatch({\n        type: REVALIDATE_ROWS_FAILURE,\n        payload: {\n          status: 'done',\n          valid: false,\n          error\n        }\n      })\n    }\n  })\n}\n\nexport const validateTable = (payload) => (dispatch) => {\n  const {source, schema, relations} = payload;\n  dispatch(async() => {\n    try {\n      const tableLength = source.length;\n      const chunkSize = DEFAULT_CHUNK_SIZE;\n      let i = 0\n      let errors = []\n      const headers = source[0];\n      const chunks = chunk(source.slice(1,), chunkSize);\n      let chunkIndex = 0\n      for (const chunkedTable of chunks) {\n        dispatch({\n          type: VALIDATE_TABLE_REQUEST,\n          payload: {  \n            status: 'loading',\n            loader: `validating ${chunkIndex*chunkSize}/${tableLength-1} rows`\n          }\n        });\n        const table = await Table.load([headers].concat(chunkedTable), {schema});\n        const rows = await table.read({forceCast: true, relations});\n        const chunkErrors = rows.filter((row) => row.errors)\n        if (chunkErrors.length) {\n          for (const error of chunkErrors){\n            error.rowNumber = error.rowNumber + chunkSize * chunkIndex;\n            errors.push(error)\n          }\n        }\n        chunkIndex += 1;\n      };\n     \n      // const table = await Table.load(source, {schema});\n      // const rows = await table.read({forceCast: true});\n      // const errors = rows.filter((row) => row.errors)\n      if (errors.length) {\n        dispatch({\n          type: VALIDATE_TABLE_FAILURE,\n          payload: {\n            status: 'done',\n            valid: false,\n            errors,\n            collectedErrors: getCollectedErrors(source, schema, errors)\n          }\n        })\n      } else {\n        dispatch({\n          type: VALIDATE_TABLE_SUCCESS,\n          payload: {\n            status: 'done',\n            valid: true\n          }\n        })\n      }\n    } catch (error) {\n      console.error(error)\n      dispatch({\n        type: VALIDATE_TABLE_FAILURE,\n        payload: error\n      })\n    }\n  })\n}\n\n/**\n * REDUCER\n */\n\nconst initialState = {\n  resourceName: 'flows',\n  schemaFeedback: null,\n  headerFeedback: null,\n  descriptor: null,\n}\n\nexport default function reducer(state = initialState, action){\n  const {payload} = action;\n  switch (action.type){\n    case SET_STEP: \n      if (payload.id === '0') {\n        return {\n          ...state,\n          schemaFeedback: null,\n          headerFeedback: null,\n        }\n      }\n      return state;\n    case FETCH_DATAPACKAGE_SUCCESS:\n      return {\n        ...state,\n        descriptor: payload\n      }\n    case VALIDATE_HEADER_REQUEST: \n    case VALIDATE_HEADER_FAILURE:\n    case VALIDATE_HEADER_SUCCESS:\n      return {\n        ...state,\n        headerFeedback: payload\n      }\n    case VALIDATE_TABLE_REQUEST: \n    case VALIDATE_TABLE_FAILURE:\n    case VALIDATE_TABLE_SUCCESS: \n      return {\n        ...state,\n        schemaFeedback: payload\n      }\n    default:\n    return state\n  }\n}\n\nconst getResourceName = state => state.schemaValidation.resourceName;\nconst getResources = state => state.schemaValidation.descriptor.resources;\nconst getTables = state => state.referenceTables.referenceTables;\n\nconst re = /row\\s\\d*/;\nexport const getGroupedErrors = (collectedErrors) => {\n  const errorsList = values(collectedErrors).reduce((res, item) => {\n    return res.concat(item.errors)\n  },[]);\n\n  const groupedErrorsList = \n    values(groupBy(errorsList,(v) => v.field + v.value))\n    .map((errors, index)=> {\n      // const fieldName = errors[0].field;\n      // let yearRange;\n      // if (fieldName === 'currency|year|reporting') {\n      //   const years = uniq(errors.map((error) => error.value.split('|')[1]));\n      //   yearRange = years.length > 1 ? `${min(years)}-${max(years)}` : years[0]\n      // }\n      // const value = fieldName !== 'currency|year|reporting' ? errors[0].value : `${errors[0].value.split('|')[0]}|${yearRange}|${errors[0].value.split('|')[2]}`\n      return {\n        index,\n        field: errors[0].field,\n        errorType: errors[0].errorType,\n        fixed: false,\n        message: errors[0].message.replace(re, `${errors.length} rows`),\n        originalValue: errors[0].value,\n        value: errors[0].value, \n        errors\n      }\n    });\n  return sortBy(groupedErrorsList, (field) => {\n    return RANKED_FIELDS[field.name]\n  });\n}\n\n/** \n* SELECTORS\n*/\n\n\nexport const getResourceSchema = createSelector(\n  getResourceName,\n  getResources,\n  (resourceName, resources) => {\n    const selectedResource = resources.find((resource) => resource.name === resourceName || (resource.group === resourceName && resource.schema));\n    return selectedResource.schema\n})\n\nexport const getRelations = createSelector(\n  getResourceName,\n  getResources,\n  getTables,\n  (resourceName, resources, referenceTables) => {\n    const selectedResource = resources.find((resource) => resource.name === resourceName || (resource.group === resourceName && resource.schema));\n    const relations = {};\n    if (!selectedResource) {\n      console.error(`the resource ${resourceName} could not be found!`)\n      return {};\n    }\n    if (selectedResource.schema) {\n      if (selectedResource.schema.foreignKeys) {\n        selectedResource.schema.foreignKeys.forEach((key) => {\n          const tableName = key.reference.resource;\n          relations[tableName] = referenceTables[tableName]\n        });\n        return relations;\n      }\n      else\n        return {};\n    }\n    else {\n      console.error(`the resource ${selectedResource.name} has no schema !`);\n      return {};\n    }\n  })","import React from 'react';\nimport {isNull, values, difference} from 'lodash';\nimport {\n  HelpPin,\n  Button,\n} from 'design-workshop';\nimport {NON_CHANGABLE_FIELDS} from '../constants'\n\n\nconst SummaryTable = ({\n  className,\n  modificationList,\n  onSelectError\n}) => {\n  const columnNames = ['', 'Field', 'Value', 'Rows', ''];\n  const yearFormatValues = modificationList\n                            .filter((item)=> item.field === 'year' && !item.fixed)\n                            .map((item) => ''+item.value);\n\n  return (\n    <div style={{position: 'relative', width: '100%', height: '70vh'}}>\n      \n      <div className={`action-table ${className}`}>\n        <div className={'action-table-header'}>\n          {\n            columnNames.map((columnName, index) => {\n              return (\n                <div key={index} className=\"table-cell\">\n                  <span className={columnName === 'Value' ? 'has-text-danger': 'has-text-black'}>{columnName}</span>\n                </div>\n              );\n            })\n          }\n        </div>\n        <div className={'action-table-main'}>\n          {\n            modificationList.map((item, errorIndex) => {\n              const {field, errors,originalValue, value, message, fixed, fixedValues} = item;\n              const fixedValue = values(fixedValues).join('|');\n\n              const isNonchangableField = difference(NON_CHANGABLE_FIELDS, field.split('|')).length < NON_CHANGABLE_FIELDS.length\n\n              const handleSelectError = () => {\n                onSelectError(errorIndex)\n              }\n              let isCurrencyFixDisabled = false;\n              if (item.field === 'currency|year|reporting' && yearFormatValues.indexOf(item.value.split('|')[1]) !== -1) {\n                isCurrencyFixDisabled = true\n              }\n\n              return (\n                <div key={errorIndex} className=\"table-row\">\n                  {\n                    columnNames.map((columnName, columnIndex) => {\n\n                      switch (columnIndex) {\n                        case 0:\n                        default:\n                          return (<div key={columnIndex} className=\"table-cell\">{errorIndex + 1}</div>)\n                        case 1:\n                          return (<div key={columnIndex} className=\"table-cell\">{field}</div>);\n                        case 2:\n                          return (\n                            <div key={columnIndex} className=\"table-cell\">\n                              {originalValue !== value && <span className=\"has-text-danger\">{originalValue}-></span>}\n                              <span className=\"has-text-danger\">{isNull(value)? 'none' : value }</span>\n                              {fixed && <span className=\"has-text-success\">->{fixedValue === ''?'none': fixedValue}</span>}\n                              <HelpPin>{message}</HelpPin>\n                            </div>);\n                        case 3:\n                          return (\n                            <div key={columnIndex} className=\"table-cell\">\n                              <p className={item.fixed ? 'has-text-success': 'has-text-black'}>{errors.length} {item.fixed && !isNonchangableField ? 'rows updated' : ''}</p>\n                              {\n                                item.fixedReferenceTable && item.fixedReferenceTable.length>0 &&\n                                  (\n                                    item.fixedReferenceTable.map((table, index)=> {\n                                      return (\n                                        <p key={index} className=\"has-text-success\">{table.data.length} row(s) added to \"{table.resourceName}\" table</p>\n                                      )\n                                    })\n                                  )\n                              }\n                            </div>);\n                        case 4:\n                          return (\n                            <div key={columnIndex} className=\"table-cell\">\n                              <Button isDisabled={isCurrencyFixDisabled} isOutlined isColor={item.fixed? 'success': 'info'} onClick={handleSelectError}>{item.fixed ? 'fixed': 'fix error'}</Button>\n                            </div>\n                          )\n                      }\n                    })\n                  }\n                </div>\n              )\n            })\n          }\n        </div>\n        {/* <div className={'action-table-footer'}></div> */}\n      </div>\n    </div>\n  );\n}\n\nexport default SummaryTable","import React from 'react';\n\nconst ContextTable = ({\n  className,\n  flows,\n  modificationItem\n}) => {\n  const columnNames = flows[0];\n  const {errors, field, value, fixedValues} = modificationItem;\n  return (\n    <div style={{position: 'relative', width: '100%', height: '20vh'}}>\n      <div className={`action-table ${className}`}>\n        <div className={'action-table-header'}>\n          {\n            columnNames.map((columnName, index) => {\n              const errorColumn = field.split('|').indexOf(columnName) !== -1 ? true : false\n              return (\n                <div key={index} className=\"table-cell\">\n                  <span className={errorColumn ? 'has-text-danger': 'has-text-black'}>{columnName}</span>\n                </div>\n              );\n            })\n          }\n        </div>\n        <div className={'action-table-main'} style={{height: '100%'}}>\n            {\n              errors.map((error, rowIndex) => {\n                return (\n                  <div key={rowIndex} className=\"table-row\">\n                    {\n                      columnNames.map((columnName, columnIndex) => {\n                        const errorColumn = field.split('|').indexOf(columnName) !== -1 ? true : false\n                        let fixedValue;\n                        const errorColumnIndex = field.split('|').indexOf(columnName);\n                        let originalValue = (''+value).split('|')[errorColumnIndex];\n                        if (columnName === 'year' && errorColumnIndex===1) {\n                          originalValue = flows[error.rowNumber - 1][columnIndex]\n                        }\n                        if (fixedValues && errorColumn) {\n                          fixedValue = fixedValues[columnName].length === 0 ? 'none' : fixedValues[columnName];\n                        }\n                      return (\n                        <div key={columnIndex} className=\"table-cell\" style={{ wordBreak: 'break-all' }}>\n                          <span className={errorColumn ? 'has-text-danger': 'has-text-black'}>\n                            {errorColumn ? originalValue: flows[error.rowNumber - 1][columnIndex]}\n                          </span>\n                          {\n                            fixedValue && \n                              <span  className=\"has-text-success\">->{fixedValue}</span>\n                          }\n                        </div>\n                      );\n                    })\n                  }\n                  </div>\n                );\n              })\n            }\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default ContextTable;","import {sortedUniq, sortBy, countBy, toPairs, uniq} from 'lodash';\n\nexport const getEnumOptions = (enumList) => {\n  const options = enumList.map((e) => {\n    return {\n      label: e,\n      value: e\n    }\n  })\n  return options\n}\n\nexport const getOptions = ({tables, resourceName, referenceField, filter}) => {\n  let values;\n  if (filter) {\n    values = tables[resourceName]\n            .filter((item) => item[filter.field] !== filter.value)\n            .map((item) => item[referenceField])\n  }\n  else {\n    values = tables[resourceName].map((item) => item[referenceField])\n  }\n  const valuesCounted = countBy(values, v => v)\n  const uniqValues = sortBy(toPairs(valuesCounted), ([k,v]) => -1*v).map(([k,v])=>k);\n\n  return uniqValues.map((item) => {\n    return {\n      value: item,\n      label: item\n    }\n  })\n}","\nimport React from 'react';\n\nimport {Field} from 'tableschema';\nimport {findIndex} from 'lodash';\n\nimport Select from 'react-select';\nimport Autosuggest from 'react-autosuggest';\n\nimport matchSorter from 'match-sorter';\n\nimport {\n  Button,\n  Field as FieldContainer,\n  Label,\n  Control,\n  Input,\n  Help,\n} from 'design-workshop'\n\n\nimport {getEnumOptions, getOptions} from '../utils/formUtils';\n\n\nclass FieldInput extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = this.getStateFromProps();\n  }\n\n  componentDidUpdate (prevProps) {\n    const {fieldDescriptor, fieldValue, fixedValue} = this.props;\n    if (fieldDescriptor.name === 'slug' && fieldValue !== prevProps.fieldValue) {\n      this.validateField(fieldValue)\n    }\n    if (fixedValue !== prevProps.fixedValue && !fixedValue) {\n      const state = this.getStateFromProps();\n      this.setState({\n        ...state\n      })\n    }\n  }\n\n  getStateFromProps = () => {\n    const {fieldDescriptor, fieldValue} = this.props;\n    const fieldSchema = new Field(fieldDescriptor);\n    \n    let options;\n    if (fieldSchema.constraints && fieldSchema.constraints.enum) {\n      options = getEnumOptions(fieldSchema.constraints.enum)\n    }\n    return {\n      fieldSchema,\n      value: fieldValue || '',\n      fieldValid: {\n        valid: false\n      },\n      options,\n      suggestions: []\n    }\n  }\n\n  validateField = (value) => {\n    const {fieldSchema} = this.state;\n    let payload\n    try {\n      fieldSchema.castValue(value);\n      payload  = {\n        value,\n        fieldValid: {\n          valid: true\n        }\n      }\n      this.setState(payload)\n      this.props.onChange({\n        fieldName: this.state.fieldSchema.name,\n        ...payload\n      })\n    } catch(error) {\n      payload = {\n        value,\n        fieldValid: {\n          valid: false,\n          error\n        }\n      }\n      this.setState(payload)\n      this.props.onChange({\n        fieldName: this.state.fieldSchema.name,\n        ...payload\n      });\n    }\n  }\n\n  handleChange = (event) => {\n    let value;\n    if(!event) {\n      value = '';\n      this.validateField(value);\n    }\n    else if(event && event.value) {\n      this.validateField(event.value);\n    }\n    else if (event && event.target) {\n      this.validateField(event.target.value);\n    }\n    else {\n      this.validateField('')\n    }\n  }\n\n  handleClickCreate = () => {\n    const field = this.props.foreignKeys.find((f) => f.fields === this.state.fieldSchema.name);\n    this.handleChange('');\n    this.props.onClickCreate({\n      referenceMap: {\n        field: this.state.fieldSchema.name,\n        referenceField: field ? field.reference.fields : this.state.fieldSchema.name\n      }\n    })\n  }\n\n  // Autosuggest will call this function every time you need to update suggestions.\n  // You already implemented this logic above, so just use it.\n  onSuggestionsFetchRequested = (value, suggestedOptions) => {\n    const getSuggestions = (value, options) => {\n      const inputValue = value.trim().toLowerCase();\n      const inputLength = inputValue.length;\n\n      return inputLength === 0 ? [] : options.filter(option =>\n        option.toLowerCase().slice(0, inputLength) === inputValue\n      );\n    };\n    this.setState({\n      suggestions: getSuggestions(value, suggestedOptions)\n    });\n  };\n\n  // Autosuggest will call this function every time you need to clear suggestions.\n  onSuggestionsClearRequested = () => {\n    this.setState({\n      suggestions: []\n    });\n  };\n\n  handleSuggestionChange =  (event, { newValue }) => {\n    this.validateField(newValue)\n  };\n\n\n  // Use your imagination to render suggestions.\n  renderSuggestion = suggestion => (\n    <div>\n      {suggestion}\n    </div>\n  );\n\n\n  renderField() {\n    const {fieldValue, foreignKeys, referenceTables, showNewReference, newReference, isNonchangable, isValidationField, suggestedOptions} = this.props;\n    const {fieldSchema, value, suggestions} = this.state;\n\n    // Autosuggest will pass through all these props to the input.\n    const inputProps = {\n      placeholder: '',\n      value,\n      onChange: this.handleSuggestionChange\n    };\n\n    let isReferenceField = false;\n    \n    const handleSuggestionsFetchRequested = ({value}) => {\n      this.onSuggestionsFetchRequested(value, suggestedOptions)\n    }\n    let options;\n\n    const generateValue = (value) => {\n      return {\n        value,\n        label: value\n      }\n    }\n    \n    if (findIndex(foreignKeys, (item)=>item.fields === fieldSchema.name || item.fields.indexOf(fieldSchema.name) !== -1) !== -1) {\n      const index = findIndex(foreignKeys, (item)=>item.fields === fieldSchema.name || item.fields.indexOf(fieldSchema.name) !== -1)\n      const referenceField = foreignKeys[index].reference.fields;\n      isReferenceField = true;\n      \n      options = getOptions({\n        tables: referenceTables,\n        resourceName: foreignKeys[index].reference.resource,\n        referenceField: typeof(referenceField) === 'object' ? referenceField[0]: referenceField\n      });\n    }\n\n    if (isNonchangable) {\n      return (<span>{fieldValue}</span>)\n    }\n    else if (isReferenceField) {\n      return (\n        <div>\n          {\n            !showNewReference && !newReference &&\n            <Select isSearchable={true}\n              isClearable={true}\n              value={generateValue(value)}\n              options={this.state.options}\n              onChange={this.handleChange} \n              onInputChange={inputValue => {\n                this.setState({ options : (matchSorter(options, inputValue, {keys: ['label']}).slice(0,50))});\n              }}\n              />\n          }\n          {\n            newReference &&\n            <div>{fieldValue}</div>\n          }\n          {\n            (!this.state.value || isValidationField)  &&\n            <Button isColor='info' onClick={this.handleClickCreate}>Create new item</Button>\n          } \n        </div>\n      )\n    }\n    else if (fieldSchema.constraints && fieldSchema.constraints.enum) {\n      return (\n        <Select isClearable={true}\n        value= {generateValue(value)}\n        options={this.state.options}\n        onChange={this.handleChange} />\n      )\n    }\n    else if (suggestedOptions) {\n      return <Autosuggest\n      suggestions={suggestions}\n      onSuggestionsFetchRequested={handleSuggestionsFetchRequested}\n      onSuggestionsClearRequested={this.onSuggestionsClearRequested}\n      getSuggestionValue={(value) => value}\n      renderSuggestion={this.renderSuggestion}\n      inputProps={inputProps} />\n    }\n    else {\n      return (\n        <Input\n        value={value}\n        onChange={this.handleChange} />\n      )\n    }\n  }\n\n  render() {\n    const {fieldSchema, fieldValid} = this.state;\n    const {showNewReference, newReference} = this.props;\n    return (\n      <FieldContainer>\n        <Label>\n          {fieldSchema.name}\n          {\n            fieldSchema.constraints && fieldSchema.constraints.required &&\n            <span>*</span>\n          }\n        </Label>\n        <Control>\n          {this.renderField()}\n        </Control>\n        {\n          fieldValid && fieldValid.error && !showNewReference && !newReference &&\n            <Help isColor=\"danger\">{fieldValid.error.message}</Help>\n        }\n      </FieldContainer> \n    )\n  }\n}\n\nexport default FieldInput;","import React from 'react';\n\nimport {\n  Columns,\n  Column,\n  Button,\n  Field as FieldContainer,\n  Label,\n  Control,\n  Help,\n} from 'design-workshop'  \n\nimport FieldInput from './FieldInput';\n\nclass FormatCorrection extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = this.hydrateState();\n  }\n\n  componentDidUpdate (prevProps) {\n   if (this.props.modificationIndex !== prevProps.modificationIndex) {\n      const state = this.hydrateState()\n      this.setState({\n        ...state\n      });\n   }\n  }\n\n  hydrateState = () => {\n    const {modificationItem} = this.props;\n\n    return {\n      fixedValue: null,\n      showSolving: !modificationItem.fixed,\n      fieldValid: null\n    }\n  }\n\n  handleFieldChange = (payload) => {\n    const {value, fieldValid} = payload;\n    this.props.onTouch(true)\n    this.setState({\n      fixedValue: value,\n      fieldValid\n    })\n  }\n\n\n  handleSubmitForm = () => {\n    const {modificationItem} = this.props;\n    const {fixedValue, fieldValid} = this.state;\n    if(!fieldValid || !fieldValid.valid) return;\n    const fixedValues = {\n      [modificationItem.field]: fixedValue\n    }\n    this.props.onSubmitForm({fixedValues});\n  }\n\n  handleShowSolving = () => {\n    this.props.onTouch(true)\n    this.setState({\n      showSolving: true\n    })\n  }\n\n  handleHideSolving = () => {\n    this.props.onTouch(false)\n    this.setState({\n      showSolving: false\n    })\n  }\n\n  handleDiscard = () => {\n    this.props.onTouch(false);\n    const state = this.hydrateState()\n    this.setState({\n      ...state\n    });\n    this.props.onDiscard()\n  }\n\n  renderOriginal() {\n    const {modificationItem} = this.props;\n    const {value, message, field}= modificationItem;\n\n    return (\n      <FieldContainer>\n        <Label>Original value of \"{field}\":</Label>\n        <strong>{value.length === 0 ? 'none': value}</strong>\n        <Help isColor=\"danger\">{message}</Help>\n      </FieldContainer>\n    )\n  }\n\n  renderFixed() {\n    const {modificationItem} = this.props;\n    const {fixedValues, field, errors}= modificationItem;\n    const printValue = fixedValues[field].length === 0 ? 'none' : fixedValues[field];\n    return (\n      <FieldContainer>\n        <Label className=\"has-text-success\">Fixed with value</Label>\n        <strong className=\"has-text-success\">{printValue}</strong>\n        <Help isColor=\"success\">total {errors.length} rows affected</Help>\n        <Button isColor=\"info\" onClick={this.handleShowSolving}>Change this fix</Button>\n      </FieldContainer>\n    )\n  }\n\n  renderInput() {\n    const {modificationItem, fieldDescriptor, isModificationTouched} = this.props;\n    const {fieldValid} = this.state;\n    const isSubmitDisabled = !fieldValid || !fieldValid.valid\n\n    return (\n      <div>\n        <Label>Fix with a new input</Label>\n        <FieldInput \n          isNonchangable={false}\n          fieldDescriptor={fieldDescriptor} \n          fieldValue={modificationItem.value}\n          fixedValue={this.state.fixedValue}\n          onChange={this.handleFieldChange} />\n          \n        <FieldContainer isGrouped>  \n          {/*\n             modificationItem.fixed &&\n            <Control>\n              <Button isColor=\"info\" onClick={this.handleHideSolving}>Cancel</Button>\n            </Control>\n          */}\n          {\n            isModificationTouched &&\n            <Control>\n              <Button isColor=\"info\" onClick={this.handleDiscard}>Discard modification</Button>\n            </Control>\n          }\n          <Control>\n            <Button isColor=\"info\" isDisabled={isSubmitDisabled} onClick={this.handleSubmitForm}>Confirm this fix</Button>\n          </Control>\n        </FieldContainer>\n      </div>\n    )\n  }\n\n  render() {\n    const {modificationItem} = this.props;\n    const {fixed}= modificationItem;\n    \n\n    return (\n      <div style={{height: '60vh'}}>\n        <form>\n          <Columns>\n            <Column isSize=\"1/2\">\n              {this.renderOriginal()}\n              {\n                fixed && !this.state.showSolving && this.renderFixed()\n              }\n              {\n                this.state.showSolving && this.renderInput()\n              }\n\n            </Column>\n          </Columns>\n  \n        </form>    \n      </div>\n    )\n  }\n}\n\nexport default FormatCorrection;","import React from 'react';\nimport {\n  Label,\n} from 'design-workshop'\nconst NewResourceRow = ({resource}) => { \n  const {data, resourceName} = resource;\n  return (\n    <div style={{height: '40vh', overflow:'auto'}}>\n      <h3>{data.length} row(s) add to \"{resourceName}\" table</h3>\n      {\n        data.map((row)=> {\n          return (\n            Object.keys(row).map((key) => {\n              return (\n                <div key={key}>\n                  <Label>{key}:</Label>\n                  <p>{row[key]}</p>\n                </div>\n              )\n            })\n          )\n        })\n      }\n    </div>\n  );\n}\n\nexport default NewResourceRow;","import React from 'react';\n\nimport {values, mapValues, sortBy, orderBy} from 'lodash';\nimport {\n  Button,\n  Field as FieldContainer,\n  Label,\n  Control,\n  Help\n} from 'design-workshop';\nimport Select from 'react-select';\n\nimport {getOptions} from '../utils/formUtils';\n\nimport FieldInput from './FieldInput';\n\nconst RANKED_FIELDS = {\n  \"type\": 0,\n  'RICname': 1,\n  \"continent\": 2,\n  \"COW_code\": 3\n}\n\nclass NewRICentityForm extends React.Component {\n  \n  constructor(props) {\n    super(props);\n    this.state = this.getStateFromProps()\n  }\n\n  getStateFromProps = () => {\n    const {resourceDescriptor} = this.props;\n    const {schema} = resourceDescriptor;\n    const fields = schema.fields.reduce((res, field) => {\n      let value = '';\n      let valid = true;\n      if (field.constraints && field.constraints.enum) {\n        const enumList = field.constraints.enum\n        value = enumList[0]\n      }\n      if (field.constraints && field.constraints.required && !field.constraints.enum ) {\n        valid = false\n      }\n      // TODO: hardcoded\n      if (field.name === 'type') {\n        value = 'group';\n      }\n      if (field.name === 'continent') {\n        value = ''\n      }\n      return {\n        ...res,\n        [field.name]: {\n          value,\n          fieldValid: {\n            valid\n          }\n        }\n      }\n    }, {});\n    return {\n      fields\n    }\n  }\n\n  handleFieldChange = (payload) => {\n    this.setState({\n      fields: {\n        ...this.state.fields,\n        [payload.fieldName]: payload\n      }\n    })\n  }\n\n  handleChangeMulti = (event) => {\n    const {referenceTables} = this.props;\n    const table = referenceTables['ricentities'];\n\n    const getRICname = (list) => {\n      const orderedList = orderBy(list, [item => item.value.toLowerCase()], ['asc'])\n      return orderedList.map((item) => item.value).join(' & ');\n    }\n\n    const getContinent = (list, table) => {\n      const continents = list.map((item) => {\n        const findRow = table.find((row) => row['RICname'] === item.value);\n        return findRow.continent\n      });\n      if (continents.length > 1) return 'World';\n      else if (continents.length === 1) return continents[0];\n      return null;\n    }\n\n    const value = event ? getRICname(event) : '';\n    const multiParts = event ? event : [];\n    const continentValue = event ? getContinent(multiParts, table) : null;\n\n    // mockup validation\n    this.setState({\n      multiParts,\n      fields: {\n        ...this.state.fields,\n        RICname: {\n          fieldName: 'RICname',\n          value,\n          fieldValid:{\n            valid: value ==='' ? false: true,\n            error: value === ''? {message: 'field is required'} : null\n          }\n        },\n        continent: {\n          fieldName: 'continent',\n          value: continentValue,\n          fieldValid:{\n            valid: continentValue ==='' ? false: true,\n            error: continentValue === ''? {message: 'field is required'} : null\n          }\n        }\n      }\n    });\n  }\n\n  render() {\n    const {resourceDescriptor, referenceTables} = this.props;\n    const {schema} = resourceDescriptor;\n    const fieldsInvalid = values(this.state.fields).filter((field) => field.fieldValid && !field.fieldValid.valid);\n\n    const handleAddNew = () => {\n      const payload = {\n        newResource: {\n          resourceName: resourceDescriptor.name,\n          data: [mapValues(this.state.fields, (item) => item.value || '')]\n        },\n        newReference: {\n          resourceName: 'ricentities_groups',\n          data: this.state.multiParts.map((part) => {\n            return {\n              'RICname_group': this.state.fields['RICname'].value,\n              'RICname_part': part.value\n            }\n          })\n        }\n      }\n      this.props.onAddNew(payload)\n    }\n\n    const sortedFields = sortBy(schema.fields, (field) => {\n      return RANKED_FIELDS[field.name]\n    })\n\n    const options = getOptions({\n      tables: referenceTables,\n      resourceName: 'ricentities',\n      referenceField: 'RICname',\n      filter: {\n        field: 'type',\n        value: 'group'\n      }\n    });\n    return (\n      <div>\n        <div style={{height: '40vh', overflow:'auto'}}>\n          <h3>New row to \"{resourceDescriptor.name}\" table</h3>\n          {\n            sortedFields.map((field, index) => {\n              if (field.name === 'RICname') {\n                const {value, fieldValid} = this.state.fields[field.name];\n                return (\n                  <FieldContainer>\n                    <Label>\n                      {field.name}\n                      {\n                        field.constraints && field.constraints.required &&\n                        <span>*</span>\n                      }\n                    </Label>\n                    <Control>\n                      <Select isSearchable={true}\n                          isClearable={true}\n                          isMulti\n                          value={this.state.multiParts}\n                          options={options}\n                          onChange={this.handleChangeMulti} />\n                        <div>{value}</div> \n                    </Control>\n                    {\n                      fieldValid && fieldValid.error && <Help isColor=\"danger\">{fieldValid.error.message}</Help>\n                    }\n                  </FieldContainer> \n                )\n              } \n              return (\n                <FieldInput \n                  key={index}\n                  isNonchangable={field.name !== 'RICname'}\n                  referenceTables={referenceTables}\n                  fieldDescriptor={field} \n                  fieldValue={this.state.fields[field.name].value}\n                  onChange={this.handleFieldChange} />\n              )\n            })\n          }\n        </div>\n        <FieldContainer isGrouped>\n          <Control>\n            <Button isColor=\"info\" onClick={this.props.onCancel}>Cancel</Button>\n          </Control>\n          <Control>\n            {/* TODO: add resource validation for all field */}\n            <Button isColor=\"info\" isDisabled={fieldsInvalid.length > 0}  onClick={handleAddNew}>Add new</Button>\n          </Control>\n        </FieldContainer>\n      </div>\n    )\n  }\n}\nexport default NewRICentityForm;","import React from 'react';\nimport {Table} from 'tableschema';\n\nimport {keys, values, mapValues, sortBy, uniq} from 'lodash';\n\nimport {\n  Button,\n  Field as FieldContainer,\n  Control,\n  Help,\n  Columns,\n  Column\n} from 'design-workshop';\n\nimport FieldInput from './FieldInput';\nimport NewResourceRow from './NewResourceRow';\nimport NewRICentityForm from './NewRICentityForm';\nimport {NON_CHANGABLE_FIELDS, SOURCE_SLUGIFY, SOURCE_SUGGESTION_FIELDS} from '../constants';\n\nconst castFormObject = (formObject) =>  mapValues(formObject, (v => v.value));\n\n\nclass ReferenceResourceForm extends React.Component {\n  \n  constructor(props) {\n    super(props);\n    this.state = this.getStateFromProps()\n  }\n\n  getStateFromProps = () => {\n    const {resourceDescriptor, originalValues, prefixedValues} = this.props;\n    const {schema} = resourceDescriptor;\n    const newResource = schema.fields.reduce((res, field) => {\n      let value = '';\n      let valid = true;\n\n      if (field.constraints && field.constraints.required) {\n        valid = false\n      }\n      if(originalValues && originalValues.find((item) => item.referenceField=== field.name) && field.name !== 'slug') {\n        value = originalValues.find((item) => item.referenceField=== field.name).value;\n        valid = true;\n      }\n      if (prefixedValues && prefixedValues[field.name]) {\n        value = prefixedValues[field.name];\n        valid = true\n      }\n      return {\n        ...res,\n        [field.name]: {\n          value,\n          fieldValid: {\n            valid\n          }\n        }\n      }\n    }, {});\n    return {\n      newResource,\n      showNewReference:false\n    }\n  }\n\n  getSlug = (payload) => {\n    let preFields = {\n      ...this.state.newResource,\n      [payload.fieldName]: payload\n    };\n    // remove field data structure to mimic source object\n    const value = SOURCE_SLUGIFY(castFormObject(preFields)) ;\n    return {\n      fieldName: 'slug',\n      value\n    }\n  }\n\n  handleFieldChange = (payload) => {\n    const {resourceDescriptor} = this.props;\n\n    if (this.state.newResource['slug']) {\n      const slug = this.getSlug(payload);\n      this.setState({\n        newResource: {\n          ...this.state.newResource,\n          slug,\n          [payload.fieldName]: payload\n        }\n      });\n      return;\n    }\n    \n    if (resourceDescriptor.name === 'ricentities' && payload.fieldName === 'type' && payload.value === 'group') {\n      this.props.onSelectGroup()\n    }\n\n    this.setState({\n      newResource: {\n        ...this.state.newResource,\n        [payload.fieldName]: payload\n      }\n    })\n  }\n\n  handleShowNew = (payload) => {\n    this.setState({\n      showNewReference: true\n    })\n  }\n\n  handleHideNew = () => {\n    const {referenceMap} = this.state;\n    const {field} = referenceMap;\n    this.setState({\n      showNewReference: false,\n      newReference: null,\n      referenceMap: null,\n      isRICentityGroup: false,\n      prefixedValues: null,\n      newResource: {\n        ...this.state.newResource,\n        [field]: {\n          fieldValid: {valid: false},\n          value: ''\n        }\n      }\n    })\n  }\n\n  handleCreateNewReference = (payload) => {\n    const {referenceMap} = payload\n    const {field} = referenceMap;\n    this.setState({\n      showNewReference: true,\n      resourceValid: {\n        valid: true\n      },\n      referenceMap,\n      newReference: null,\n      newResource: {\n        ...this.state.newResource,\n        [field]: {\n          fieldValid: {valid: false},\n          value: ''\n        }\n      }\n    })\n  }\n\n  handleAddNewReference = (payload) => {\n    const {newResource, newReference} = payload;\n    const {field, referenceField} = this.state.referenceMap;\n    this.setState({\n      newReference: newResource,\n      newRefReference: newReference,\n      showNewReference: false,\n      newResource: {\n        ...this.state.newResource,\n        [field]: {\n          fieldValid: {valid: true},\n          value: newResource.data[0][referenceField]\n        }\n      }\n    })\n  }\n\n  handleResetNewReference = () => {\n    const {referenceMap} = this.state;\n    const {field} = referenceMap;\n    this.setState({\n      newReference: null,\n      newRefReference: null,\n      showNewReference: true,\n      newResource: {\n        ...this.state.newResource,\n        [field]: {\n          fieldValid: {valid: false},\n          value: ''\n        }\n      }\n    })\n  }\n\n  handleSelectGroup = () => {\n    this.setState({\n      isRICentityGroup: true\n    })\n  }\n\n  render() {\n    const {descriptor, resourceDescriptor, referenceTables, originalValues, prefixedValues} = this.props;\n    const {schema} = resourceDescriptor;\n    const fieldsInvalid = values(this.state.newResource).filter((field) => field.fieldValid && !field.fieldValid.valid);\n\n    const getReferenceDescriptor = () => {\n      if (schema.foreignKeys) {\n        const {reference} = schema.foreignKeys[0];\n        return descriptor.resources.find((resource) => resource.name === reference.resource);\n      }\n      return;\n    }\n    \n    const handleAddNew = async () =>{\n      const payload = {\n        newResource: {\n          resourceName: resourceDescriptor.name,\n          data: [mapValues(this.state.newResource, (item) => item.value || '')]\n        },\n        newReference: this.state.newReference,\n        newRefReference: this.state.newRefReference\n      }\n\n      // TODO: hardcoded\n      if (resourceDescriptor.name === 'currencies' && !this.state.newReference) {\n        const source = [keys(payload.newResource.data[0])].concat([values(payload.newResource.data[0])]);\n        const relations = {\n          exchange_rates: referenceTables['exchange_rates']\n        };\n        let table;\n        const prefixedValues = {\n          \"modified_currency\": this.state.newResource['modified_currency'].value\n        }\n        try {\n          table = await Table.load(source, {schema});\n          const rows = await table.read({forceCast: true, relations});\n          const errors = rows.filter((row) => row.errors);\n          if (errors.length) {\n            this.setState({\n              prefixedValues,\n              resourceValid: {\n                valid: false,\n                message: errors[0].errors[0].errors[0].message\n              }\n            });\n          } else {\n            this.setState({\n              resourceValid: {valid: true}\n            })\n            this.props.onAddNew(payload)\n          }\n        } catch (error) {\n          this.setState({\n            prefixedValues,\n            resourceValid: {\n              valid: false,\n              message: error.message || 'validation fail'\n            }\n          });\n          console.error(error)\n        }\n      }\n      else this.props.onAddNew(payload)\n    }\n    return (\n      <div>\n        <Columns>\n          <Column style={{height: '50vh', overflow:'auto'}}>\n            <h3>New row to \"{resourceDescriptor.name}\" table</h3>\n            {\n              sortBy(schema.fields, (field) => field.constraints && field.constraints.required)\n              .map((field, index) => {\n                let suggestedOptions;\n                if (resourceDescriptor.name === 'sources' && SOURCE_SUGGESTION_FIELDS.indexOf(field.name)!== -1) {\n                  suggestedOptions = uniq(referenceTables['sources'].map((d) => d[field.name]))\n                }\n                return (\n                  <FieldInput \n                    key={index}\n                    isNonchangable={NON_CHANGABLE_FIELDS.indexOf(field.name) !==-1 || (prefixedValues && prefixedValues[field.name])}\n                    isValidationField={this.state.prefixedValues && this.state.prefixedValues[field.name]}\n                    fieldDescriptor={field}\n                    foreignKeys={schema.foreignKeys}\n                    referenceTables={referenceTables}\n                    suggestedOptions={suggestedOptions}\n                    fieldValue={(this.state.newResource[field.name] && this.state.newResource[field.name].value) || (prefixedValues && prefixedValues[field.name])}\n                    showNewReference={this.state.showNewReference}\n                    newReference={this.state.newReference}\n                    onClickCreate={this.handleCreateNewReference}\n                    onChange={this.handleFieldChange} />\n                )\n              })\n            }\n            {\n              this.state.resourceValid && this.state.resourceValid.message &&\n              <FieldContainer>\n                <Help isColor=\"danger\">{this.state.resourceValid.message}</Help>\n              </FieldContainer>\n            }\n          </Column>\n          {schema.foreignKeys && \n          <Column>\n            {this.state.showNewReference && \n            (this.state.isRICentityGroup ?\n              <NewRICentityForm\n                descriptor={descriptor}\n                resourceDescriptor={getReferenceDescriptor()} \n                referenceTables={referenceTables}\n                onCancel={this.handleHideNew}\n                onAddNew={this.handleAddNewReference} /> :\n              <ReferenceResourceForm\n                descriptor={descriptor}\n                originalValues={originalValues.filter((item)=> item.field === 'year')}\n                resourceDescriptor={getReferenceDescriptor()} \n                referenceTables={referenceTables}\n                prefixedValues={this.state.prefixedValues}\n                onSelectGroup={this.handleSelectGroup}\n                onCancel={this.handleHideNew}\n                onAddNew={this.handleAddNewReference} />\n            )\n            }\n            {this.state.newReference && \n              <div>\n                <NewResourceRow resource={this.state.newReference} />\n                <Button onClick={this.handleResetNewReference}>Reset</Button>\n              </div>\n            }\n          </Column>}\n          {schema.foreignKeys && this.state.newRefReference && \n            <Column>\n              <NewResourceRow resource={this.state.newRefReference} />\n            </Column>\n          }\n        </Columns>\n        <FieldContainer isGrouped>\n          <Control>\n            <Button isColor=\"info\" onClick={this.props.onCancel}>Cancel</Button>\n          </Control>\n          <Control>\n            {/* TODO: add resource validation for all field */}\n            <Button isColor=\"info\" isDisabled={fieldsInvalid.length>0} onClick={handleAddNew}>Add new</Button>\n          </Control>\n        </FieldContainer>\n      </div>\n    )\n  }\n}\nexport default ReferenceResourceForm;","import React from 'react';\nimport {connect} from 'react-redux';\nimport {values, difference} from 'lodash'\n\nimport {\n  Columns,\n  Column,\n  Button,\n  Field as FieldContainer,\n  Label,\n  Control,\n  Help,\n} from 'design-workshop';\n\nimport {NON_CHANGABLE_FIELDS, LABEL_FIELDS_FK_SOLVED} from '../constants'\n\nimport {validateResource} from '../redux/modules/schemaValidation';\n\nimport NewResourceRow from './NewResourceRow';\nimport ReferenceResourceForm from './ReferenceResourceForm';\nimport FieldInput from './FieldInput';\n\nclass ForeignKeyCorrection extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = this.hydrateState()\n  }\n\n  componentDidUpdate (prevProps) {\n   if (this.props.modificationIndex !== prevProps.modificationIndex) {\n      const state = this.hydrateState();\n      this.setState({\n        ...state\n      })\n   }\n  }\n\n  initFixedValues = () => {\n    const {modificationItem} = this.props;\n    const fieldList = modificationItem.field.split('|');\n    return fieldList.reduce((res, field) => {\n      return {\n        ...res,\n        [field]: undefined\n      }\n    }, {});\n  }\n\n  hydrateState = () => {\n    const {modificationItem} = this.props;\n\n    let fixedValues = this.initFixedValues()\n    if (modificationItem.fixedValues) fixedValues = modificationItem.fixedValues\n\n    return {\n      fixedValues,\n      showNewForm: false,\n      newResource: null,\n      newReference: null,\n      newRefReference: null,\n      showSolving: !modificationItem.fixed,\n    }\n  }\n\n  handleSubmitForm = () => {\n    const {fixedValues, newResource, newReference, newRefReference} = this.state;\n    // if(!fixedValue || fixedValue.length === 0) return;\n    let fixedReferenceTable = []\n    if (newResource) {\n      fixedReferenceTable.push(newResource);\n    }\n    if (newReference) {\n      fixedReferenceTable.push(newReference);\n    }\n    if (newRefReference) {\n      fixedReferenceTable.push(newRefReference);\n    }\n\n    this.props.onSubmitForm({\n      fixedValues,\n      fixedReferenceTable\n    });\n  }\n\n  handleClickCreate = () => {\n    this.props.onTouch(true);\n    const fixedValues = this.initFixedValues();\n    this.setState({\n      fixedValues,\n      showSolving: true,\n      showNewForm: true,\n      newResource: null,\n      newReference: null,\n      newRefReference: null\n    })\n  }\n\n  handleResetCreate = () => {\n    this.setState({\n      showNewForm: true,\n      newResource: null,\n      newReference: null\n    })\n  }\n\n  handleAddNewResource = (payload) => {\n    const {newResource, newReference, newRefReference} = payload;\n    const {modificationItem, foreignKeyField} = this.props;\n\n    const fieldList = modificationItem.field.split('|');\n    const fixedValues = fieldList.reduce((res, field, index) => {\n      let fixedValue = fieldList.length > 1 ? newResource.data[0][foreignKeyField.reference.fields[index]]:\n                                              newResource.data[0][foreignKeyField.reference.fields]\n      const special_field_for_label = LABEL_FIELDS_FK_SOLVED[field];\n      if (special_field_for_label && special_field_for_label in newResource.data[0]) {\n        fixedValue = newResource.data[0][special_field_for_label]\n      }\n      return {\n        ...res,\n        [field]: fixedValue\n      }\n    }, {})\n    this.setState({\n      newResource,\n      newReference,\n      newRefReference,\n      fixedValues,\n      showNewForm: false\n    })\n  }\n\n  handleCancel = () => {\n    this.setState({\n      showNewForm: false,\n      newResource: null,\n      newReference: null,\n      newRefReference: null\n    })\n  }\n\n  handleSelectExist = (item) => {\n    const {modificationItem} = this.props;\n    this.props.onTouch(true)\n    if (!item) {\n      this.setState({\n        fixedValues: {\n          [modificationItem.field]: ''\n        }\n      })\n    }\n    else {\n      this.setState({\n        fixedValues: {\n          [modificationItem.field]: item.value\n        },\n        newResource: null\n      })\n    }\n  }\n\n  handleShowSolving = () => {\n    this.props.onTouch(true);\n    const fixedValues = this.initFixedValues();\n\n    this.setState({\n      fixedValues,\n      showSolving: true,\n      newResource: null,\n      newReference: null,\n      newRefReference: null\n    })\n  }\n\n  handleHideSolving = () => {\n    this.props.onTouch(false)\n    this.setState({\n      showSolving: false,\n      showNewForm: false,\n      newResource: null,\n      newReference: null,\n      newRefReference: null\n    })\n  }\n\n  handleDiscard = () => {\n    const {modificationItem} = this.props;\n    this.props.onTouch(false);\n    const fixedValues = this.initFixedValues();\n    this.setState({\n      fixedValues,\n      showSolving: modificationItem.fixed ? false : true,\n      showNewForm: false,\n      newResource: null,\n      newReference: null,\n      newRefReference: null\n    });\n    this.props.onDiscard()\n  }\n  \n  renderFixed() {\n    const {modificationItem} = this.props;\n    const {field, fixedValues, fixedReferenceTable, unchangable, fixedStatus}= modificationItem;\n    const fixedValue = values(fixedValues).join('|');\n    const printValue = fixedValue.length ? fixedValue: 'none';\n    const isNonchangableField = difference(NON_CHANGABLE_FIELDS, field.split('|')).length < NON_CHANGABLE_FIELDS.length\n\n    return (\n      <FieldContainer>\n        <Control>\n\n          <Label className=\"has-text-success\">Fixed with value</Label>\n          <p className=\"has-text-success\">{printValue}</p>\n          <Help isColor=\"success\">\n            {!isNonchangableField && <li>total {modificationItem.errors.length} rows updated</li>}\n            {\n              fixedReferenceTable && fixedReferenceTable.map((table, i)=> {\n                return (\n                  <li key={i}>{table.data.length} row(s) added to \"{table.resourceName}\" table</li>\n                )\n              })\n            }\n          </Help>\n          {!this.state.showSolving && <Button isColor=\"info\" isDisabled={unchangable} onClick={this.handleShowSolving}>Change this fix</Button>}\n          {unchangable && fixedStatus === 'fixInOther' &&<Help isColor=\"success\">found same value in other error, please fix it there</Help>}\n          {unchangable && fixedStatus === 'autoFixed' &&<Help isColor=\"success\">this foreign key error is auto fixed by previous format modification</Help>}\n        </Control>\n      </FieldContainer>\n    )\n  }\n\n  renderSolving() {\n    const {modificationItem, referenceTables, isCurrencyFixDisabled, schema} = this.props;\n\n    const fieldDescriptor = schema.fields.find((f) => f.name === modificationItem.field)\n    \n    return (\n      <div>\n        {modificationItem.field === 'source' && !this.state.showNewForm && !this.state.newResource &&\n          <FieldInput \n            isNonchangable={false}\n            foreignKeys={schema.foreignKeys}\n            fieldDescriptor={fieldDescriptor} \n            referenceTables={referenceTables}\n            fixedValue={this.state.fixedValues[modificationItem.field]}\n            fieldValue={this.state.fixedValues[modificationItem.field]}\n            onClickCreate={this.handleClickCreate}\n            onChange={this.handleSelectExist} />\n        }\n        {\n          modificationItem.field !== 'source' &&\n          <FieldContainer>\n            <Control>\n              {isCurrencyFixDisabled && <Help isColor=\"danger\">Please fix year format error first</Help>}\n              <Button isDisabled={isCurrencyFixDisabled} isColor='info' onClick={this.handleClickCreate}>Create new item</Button>\n            </Control>\n          </FieldContainer>  \n        }\n      </div>\n      )\n  }\n\n  render() {\n    const {modificationItem, foreignKeyField, descriptor, referenceTables, isModificationTouched} = this.props;\n    const {value, message, field}= modificationItem;\n    const resourceName = foreignKeyField.reference.resource;  \n    const referenceFieldResource = descriptor.resources.find((resource) => resource.name === resourceName);\n    \n    const getLayoutColumns = (field) => {\n      switch(field) {\n        case 'reporting':\n        case 'partner':\n        case 'currency|year|reporting':\n          return '1/4'\n        default:\n          return '1/2'\n      }\n    }\n    const validateFixedValues = () => {\n      if (field.split('|').length > 0) {\n        const invalidValue = values(this.state.fixedValues).filter((fixedValue) => fixedValue === undefined);\n        return invalidValue.length > 0;\n      } else return this.state.fixedValues[field] === undefined;\n    }\n    const mapFieldValue = (field, value) => {\n      return field.split('|').map((f, index) => {\n        return  {\n          value: value.split('|')[index],\n          field: f,\n          referenceField: typeof(foreignKeyField.reference.fields) === 'string' ?\n            foreignKeyField.reference.fields:foreignKeyField.reference.fields[index]\n        }\n      })\n    }\n    const originalValues = mapFieldValue(field, value);\n\n    const layoutColumn = getLayoutColumns(modificationItem.field);\n\n    const isSubmitDisabled = validateFixedValues();\n\n    return (\n      <div style={{height: '60vh'}}>\n        <form>\n          <Columns>\n            <Column isSize={layoutColumn}>\n              <FieldContainer>\n                <Label>Original value of \"{field}\":</Label>\n                {/* <Input value={value} disabled /> */}\n                <div className=\"has-text-danger\">{value}</div>\n                <Help isColor=\"danger\">{message}</Help>\n              </FieldContainer>\n              {!this.state.showSolving && modificationItem.fixed && this.renderFixed()}\n              {this.state.showSolving && this.renderSolving()}\n            </Column>\n            { this.state.showNewForm && \n              <Column className='new-resource-form' style={{flex: 'auto'}}>\n                <ReferenceResourceForm \n                  originalValues={originalValues}\n                  descriptor={descriptor}\n                  resourceDescriptor={referenceFieldResource}\n                  referenceTables={referenceTables}\n                  onCancel={this.handleCancel}\n                  onAddNew={this.handleAddNewResource} />\n              </Column>\n            }\n            {\n              this.state.newResource && \n              <Column>\n                <NewResourceRow resource={this.state.newResource}/>\n                <Button onClick={this.handleClickCreate}>Reset</Button>\n              </Column>\n            }\n            {\n              this.state.newReference && \n              <Column>\n                <NewResourceRow resource={this.state.newReference}/>\n              </Column>\n            }\n            {\n              this.state.newRefReference && \n              <Column>\n                <NewResourceRow resource={this.state.newRefReference}/>\n              </Column>\n            }\n          </Columns>\n          {\n            this.state.showSolving &&\n            <FieldContainer isGrouped>\n              {/* {\n                modificationItem.fixed &&\n                <Control>\n                  <Button isColor=\"info\" onClick={this.handleHideSolving}>Cancel</Button>\n                </Control>\n              } */}\n              {\n                isModificationTouched &&\n                <Control>\n                  <Button isColor=\"info\" onClick={this.handleDiscard}>Discard modification</Button>\n                </Control>\n              }\n              <Control>\n                <Button isColor=\"info\" isDisabled={isSubmitDisabled} onClick={this.handleSubmitForm}>Confirm this fix</Button>\n              </Control>\n            </FieldContainer>\n          }\n\n        </form>\n      </div>\n    )\n  }\n}\nexport default connect(null, {\n  validateResource\n})(ForeignKeyCorrection);","import React from 'react';\nimport {connect} from 'react-redux';\n\nimport {isEqual} from 'lodash';\n\nimport ContextTable from '../../components/ContextTable'\nimport FormatCorrection from '../../components/FormatCorrection';\nimport ForeignkeyCorrection from '../../components/ForeignkeyCorrection';\n\nconst ModificationComponent = ({\n  className,\n  flows,\n  referenceTables,\n  descriptor,\n  schema,\n  isCurrencyFixDisabled,\n  isModificationTouched,\n  modificationItem,\n  modificationIndex,\n  onDiscard,\n  onTouch,\n  onSubmitModification,\n}) => {\n  const handleSubmitModification = (payload) => {\n    const {fixedValues, fixedReferenceTable} = payload;\n    return onSubmitModification({\n      ...modificationItem,\n      fixedValues,\n      fixedReferenceTable,\n      index: modificationIndex\n    })\n  }\n\n  const getFieldDescriptor = () => {\n    const {field}= modificationItem;\n    const descriptor = schema.fields.find((f) => f.name === field)\n    return descriptor;\n  }\n\n  const getForeignKeyField = () => {\n    let foreignKeyField;\n    if (modificationItem.field.indexOf('|') !== -1) {\n      const fieldList = modificationItem.field.split('|');\n      foreignKeyField = schema.foreignKeys.find((f) => isEqual(f.fields, fieldList));\n    }\n    else {\n      foreignKeyField = schema.foreignKeys.find((f) => f.fields === modificationItem.field);\n    }\n    return foreignKeyField;\n  }  \n  return (\n    <div>\n      {\n        modificationItem.errorType === 'ERROR_FORMAT' &&\n        <FormatCorrection \n          fieldDescriptor={getFieldDescriptor()} \n          modificationItem={modificationItem}\n          modificationIndex={modificationIndex}\n          isModificationTouched={isModificationTouched}\n          onDiscard={onDiscard}\n          onTouch={onTouch}\n          onSubmitForm={handleSubmitModification} \n        /> \n      }\n      {\n        modificationItem.errorType === 'ERROR_FOREIGN_KEY' &&\n        <ForeignkeyCorrection \n          schema={schema}\n          descriptor={descriptor}\n          foreignKeyField={getForeignKeyField()}\n          isCurrencyFixDisabled={isCurrencyFixDisabled}\n          isModificationTouched={isModificationTouched}\n          referenceTables={referenceTables}\n          modificationItem={modificationItem}\n          modificationIndex={modificationIndex}\n          onDiscard={onDiscard}\n          onTouch={onTouch}\n          onSubmitForm={handleSubmitModification} \n        /> \n      }\n      <ContextTable flows={flows} modificationItem={modificationItem} />\n    </div>\n  );\n}\n\nconst mapStateToProps = state => ({\n  descriptor: state.schemaValidation.descriptor,\n  referenceTables: state.referenceTables.referenceTables\n});\n\nexport default connect(mapStateToProps)(ModificationComponent);","import React from 'react';\n\nimport {\n  Card,\n  Modal,\n  ModalBackground,\n  ModalContent,\n  ModalClose\n} from 'design-workshop';\n\n\nconst AlertModal = ({\n  isActive,\n  closeModal\n}) => {\n  return (\n    <Modal isActive={isActive}>\n      <ModalBackground onClick={closeModal} />\n      <ModalContent>\n        <Card bodyContent=\"You have made a modification, please confirm your fix first?\" />\n      </ModalContent>\n      <ModalClose onClick={closeModal} />\n    </Modal>\n  )\n}\n\nexport default AlertModal","import React from 'react';\nimport {connect} from 'react-redux';\nimport {findIndex} from 'lodash';\n\nimport {\n  Button,\n} from 'design-workshop';\n\nimport {\n  setStep,\n  hideModification,\n  selectError,\n  goNextError,\n  goPrevError\n} from '../../redux/modules/ui';\n\nimport {updateFlows} from '../../redux/modules/flows';\nimport {revalidateRows} from '../../redux/modules/schemaValidation';\nimport {submitModification} from '../../redux/modules/modification';\nimport {getResourceSchema} from '../../redux/modules/schemaValidation';\nimport {addTableRow, deleteTableRow} from '../../redux/modules/referenceTables';\n\nimport SummaryTable from '../../components/SummaryTable';\nimport ModificationComponent from './ModificationComponent';\nimport AlertModal from '../../components/AlertModal';\n\nclass DataModification extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      showAlert: false,\n      isModificationTouched: false\n    }\n  }\n\n  handleTouchModification = (touched) => {\n    this.setState({\n      isModificationTouched: touched\n    })\n  }\n\n  handleShowAlert = () => {\n    this.setState({\n      showAlert: true\n    })\n  }\n\n  handleHideAlert = () => {\n    this.setState({\n      showAlert: false\n    })\n  }\n  \n  render() {\n    const {flows, schema, isModification, modificationIndex, modificationList, referenceTables, steps, selectedStep} = this.props;\n    const nonFixedList = modificationList.filter((item) => item.fixed === false);\n    const yearFormatValues = modificationList\n                            .filter((item)=> item.field === 'year' && !item.fixed)\n                            .map((item) => ''+item.value);\n\n    const modificationItem = modificationList[modificationIndex]\n    let isCurrencyFixDisabled = false;\n    if (modificationItem.field === 'currency|year|reporting' && yearFormatValues.indexOf(modificationItem.value.split('|')[1]) !== -1) {\n      isCurrencyFixDisabled = true\n    }\n    \n    const handlePrevStep = () => {\n      const currentIndex = findIndex(steps, selectedStep)\n      this.props.setStep(steps[currentIndex-1])\n    }\n    const handleNextStep = () =>  {\n      const currentIndex = findIndex(steps, selectedStep)\n      this.props.setStep(steps[currentIndex+1])\n    }\n\n    const handlePrevError = () => {\n      if (this.state.isModificationTouched) {\n        this.handleShowAlert();\n        return;\n      }\n      if (modificationIndex > 0) this.props.goPrevError();\n    }\n\n    const handleNextError = () => {\n      if (this.state.isModificationTouched) {\n        this.handleShowAlert();\n        return;\n      }\n      if (modificationIndex < modificationList.length - 1) this.props.goNextError();\n    }\n\n    const handleDiscard = () => {\n      if ( modificationIndex < modificationList.length - 1 && nonFixedList.length > 0) {\n        this.props.goNextError();\n      }\n      else {\n        this.props.hideModification()\n      }\n    }\n\n    const handleHideModification = () => {\n      if (this.state.isModificationTouched) {\n        this.handleShowAlert();\n        return;\n      }\n      this.props.hideModification();\n    }\n    \n    const handleSelectError = (index) => {\n      if (index < modificationList.length) {\n        this.props.selectError({\n          index\n        })\n      }\n    }\n\n    const handleSelectFirstError = () => {\n      this.props.selectError({\n        index: nonFixedList[0].index\n      })\n    }\n\n    const handleSubmitModification = (payload) => {\n      const {errors, errorType, fixedReferenceTable} = payload;      \n    \n      if (errorType === 'ERROR_FORMAT' || payload.field === 'source') {\n        this.props.updateFlows(payload);\n      }\n      \n      if(payload.field === 'year') {\n        const rowNumbers = errors.map((e) => e.rowNumber);\n        const columnIndex = flows[0].indexOf('year');\n        const source = [flows[0]].concat(errors.map((e) => {\n          const row = [...flows[e.rowNumber -1]]\n          row[columnIndex] = payload.fixedValues['year'];\n          return row;\n        }));\n        const relations = {currencies: referenceTables['currencies']}\n        this.props.revalidateRows({\n          originalValue: payload.value,\n          fixedValues: payload.fixedValues,\n          rowNumbers,\n          source,\n          schema,\n          relations,\n        });\n      }\n\n      if (errorType === 'ERROR_FOREIGN_KEY') {\n        const prevFixedReferenceTable = modificationItem.fixedReferenceTable;\n        if (prevFixedReferenceTable && fixedReferenceTable) {\n          prevFixedReferenceTable.forEach((table) => {\n            this.props.deleteTableRow(table);\n          })\n        }\n        fixedReferenceTable.forEach((table) => {\n          this.props.addTableRow(table)\n        })\n      }\n\n      this.props.submitModification(payload);\n\n      this.setState({\n        isModificationTouched: false\n      });\n\n      if ( modificationIndex < modificationList.length - 1 && nonFixedList.length > 0) {\n        this.props.goNextError()\n      }\n      else {\n        this.props.hideModification()\n      }\n    }\n\n    return (\n      <div>\n        {\n          !isModification &&\n            <div>\n              {\n                modificationList.length > 0 &&\n                <div className=\"has-text-danger has-text-weight-bold\">{modificationList.length} different errors need to modify</div>\n              }\n              {\n                modificationList && \n                <SummaryTable modificationList={modificationList} onSelectError={handleSelectError} />\n              }\n              <div style={{\n                display: 'flex',\n                justifyContent: 'space-between'\n              }}>\n                <Button \n                  isColor=\"info\" \n                  onClick={handlePrevStep}>\n                    Previous Step\n                </Button>\n                {\n                  nonFixedList.length === 0 ?\n                    <Button isColor=\"info\" onClick={handleNextStep}>\n                      Ready to publish\n                    </Button> :\n                    <Button isColor=\"info\" onClick={handleSelectFirstError}>\n                      Start fix error\n                    </Button>\n                }\n              </div>\n            </div>\n        }\n        {\n          isModification &&\n          <div>\n            <ModificationComponent \n              flows={flows}\n              schema={schema}\n              isCurrencyFixDisabled={isCurrencyFixDisabled}\n              modificationIndex={modificationIndex}\n              modificationItem={modificationItem} \n              isModificationTouched={this.state.isModificationTouched}\n              onTouch={this.handleTouchModification}\n              onDiscard={handleDiscard}\n              onSubmitModification={handleSubmitModification} />\n            \n            <div style={{\n              display: 'flex',\n              justifyContent: 'space-between'\n            }}>\n              <div>\n                <Button isColor=\"info\" onClick={handleHideModification}>\n                  Back to summary\n                </Button>\n              </div>\n              <span className=\"has-text-danger has-text-weight-bold\">{modificationIndex + 1} / {modificationList.length }</span>\n              <span>{(this.state.showAlert).toString()}</span>\n              <div>\n                {\n                  modificationIndex !==0 &&\n                    <Button isColor=\"info\" style={{marginLeft: '10px'}}\n                      onClick={handlePrevError}>\n                      Prev Error\n                    </Button>\n                }\n                {\n                  modificationIndex !== (modificationList.length-1) &&\n                    <Button isColor=\"info\" style={{marginLeft: '10px'}}\n                      onClick={handleNextError}>\n                      Next Error\n                    </Button>\n                }\n              </div>\n            </div>\n            <AlertModal isActive={this.state.showAlert} closeModal={this.handleHideAlert} />\n          </div>\n        }\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = state => ({\n  flows: state.flows.data,\n  referenceTables: state.referenceTables.referenceTables,\n  schema: getResourceSchema(state),\n  modificationList: state.modification.modificationList,\n  steps: state.ui.steps,\n  selectedStep: state.ui.selectedStep,\n  isModification: state.ui.isModification,\n  modificationIndex: state.modification.modificationIndex\n})\n\nexport default connect(mapStateToProps, {\n  setStep,\n  updateFlows,\n  addTableRow,\n  deleteTableRow,\n  revalidateRows,\n  hideModification,\n  selectError,\n  goNextError,\n  goPrevError,\n  submitModification\n})(DataModification);","import DataModification from './DataModification'\n\nexport default DataModification","import XLSX from \"xlsx\";\n\nimport FileSaver from \"file-saver\";\nimport { unparse } from \"papaparse\";\n\nexport function downloadFlow(array, fileName, ext) {\n  let file;\n  const header = array[0];\n  switch (ext) {\n    case \"csv\":\n    default: {\n      const csvString = unparse(array) + \"\\r\\n\";\n      file = new File([csvString], `${fileName}.${ext}`, {\n        type: \"text/csv;charset=utf-8\",\n      });\n      FileSaver.saveAs(file);\n      break;\n    }\n    case \"xlsx\": {\n      const sheet = XLSX.utils.aoa_to_sheet(array, { header });\n      const wb = XLSX.utils.book_new();\n      XLSX.utils.book_append_sheet(wb, sheet, \"SheetJS\");\n      XLSX.writeFile(wb, `${fileName}.${ext}`);\n      break;\n    }\n  }\n}\n\nexport function downloadTable(array, fileName, ext) {\n  let file;\n  switch (ext) {\n    case \"csv\":\n    default: {\n      const csvString = unparse(array) + \"\\r\\n\";\n      file = new File([csvString], `${fileName}.${ext}`, {\n        type: \"text/csv;charset=utf-8\",\n      });\n      FileSaver.saveAs(file);\n      break;\n    }\n  }\n}\n","import React from 'react';\nimport {\n  Button,\n  Field,\n  Label,\n  Input,\n  Control,\n  Help\n} from 'design-workshop';\n\nimport {\n  Modal,\n  ModalBackground,\n  ModalClose,\n  ModalCard,\n  ModalCardBody,\n} from 'bloomer';\n\n\nclass GithubAuthModal extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      token: '',\n      message: ''\n    };\n  }\n\n  handleChangeToken = (event) => {\n    this.setState({\n      token: event.target.value\n    });\n  }\n\n  handleChangeMessage = (event) => {\n    this.setState({\n      message: event.target.value\n    });\n  }\n\n\n  handleSubmit = () => {\n    this.props.onSubmitAuth(this.state)\n  }\n\n  render() {\n    const {isActive, isCommit, closeModal} = this.props;\n    let invalidInput = !this.state.token;\n    \n    if (isCommit) {\n      invalidInput = !this.state.token || !this.state.message;\n    }\n\n    return (\n      <Modal isActive={isActive}>\n        <ModalBackground onClick={closeModal} />\n        <ModalCard>\n          <ModalCardBody>\n            <Field>\n              <Label>personal access token*:</Label>\n              <Control>\n                <Input type=\"password\" value={this.state.token} onChange={this.handleChangeToken} />\n              </Control>\n            </Field>\n            {isCommit && \n              <Field>\n                <Label>commit message*:</Label>\n                <Control>\n                  <Input value={this.state.message} onChange={this.handleChangeMessage} />\n                </Control>\n              </Field>\n            }\n            <Field>\n              {invalidInput &&<Help isColor=\"danger\">requied field is missing</Help>}\n              <Button isDisabled={invalidInput} isColor=\"info\" onClick={this.handleSubmit}>{isCommit ? 'Commit': 'Login'}</Button>\n            </Field>\n          </ModalCardBody>\n        </ModalCard>\n        <ModalClose onClick={closeModal} />\n      </Modal>\n    )\n  }\n}\n\nexport default GithubAuthModal;","/* eslint-disable jsx-a11y/anchor-is-valid */\nimport React from \"react\";\nimport { connect } from \"react-redux\";\nimport { groupBy, keyBy } from \"lodash\";\n\nimport { Button, Control, Field, Columns, Column, Help } from \"design-workshop\";\n\nimport { csvFormatRows, csvParse } from \"d3-dsv\";\n\nimport { exportFlows } from \"../../redux/modules/flows\";\nimport { setStep } from \"../../redux/modules/ui\";\n\nimport { updateRemoteFiles } from \"../../redux/modules/repoData\";\n\nimport { downloadFlow, downloadTable } from \"../../utils/fileExporter\";\nimport GithubAuthModal from \"../../components/GithubAuthModal\";\n\nimport { SOURCE_SLUG_FILENAME } from \"../../constants\";\nimport { owner, repoName } from \"../../config/default\";\n\nclass DataPublish extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isModalShow: false,\n    };\n  }\n\n  handleOpenModal = () => {\n    this.setState({ isModalShow: true });\n  };\n\n  handleCloseModal = () => {\n    this.setState({ isModalShow: false });\n  };\n\n  render() {\n    const { flows, repoData, referenceTables, originalLength } = this.props;\n    const {\n      selectedBranch,\n      remoteUpdateStatus,\n      lastCommit,\n      remoteUpdateMessage,\n      tables,\n    } = repoData;\n\n    let updatedTables = [];\n\n    Object.keys(referenceTables).forEach((name) => {\n      if (referenceTables[name].length !== originalLength[name]) {\n        updatedTables.push({\n          name,\n          updatedRows: referenceTables[name].slice(originalLength[name]),\n        });\n      }\n    });\n\n    const handleExportFlow = () => {\n      const { file, data } = flows;\n      downloadFlow(data, `${file.name}_corrections`, \"csv\");\n    };\n\n    let groupedFlows = {};\n    try {\n      // group flows by source filename\n      // we need to source metadata to generate source filename\n      const sources = keyBy(referenceTables.sources, (s) => s.slug);\n      // format + parse to go from array representation to list of obejct\n      const parsedFlows = csvParse(csvFormatRows(flows.data));\n      groupedFlows = groupBy(parsedFlows, (item) =>\n        SOURCE_SLUG_FILENAME(sources[item[\"source\"]])\n      );\n    } catch (e) {\n      //TODO: display error message to user\n      console.log(e);\n      setStep(2);\n    }\n\n    const handleUpdateRemoteFiles = (auth) => {\n      this.handleCloseModal();\n\n      const flowFiles = Object.keys(groupedFlows).map((file) => {\n        return {\n          filePath: `data/flows/${file}.csv`,\n          data: groupedFlows[file],\n          source: file,\n        };\n      });\n      const tableFiles = updatedTables.map((table) => {\n        const resource = this.props.repoData.descriptor.resources.find(\n        (r) => r.name === table.name);\n        if (!resource)\n          throw new Error(`Resource ${table.name} can't be found in descriptor.`);\n        return {\n          filePath: resource.path,\n          data: referenceTables[table.name],\n          sha: tables[table.name].sha,\n        };\n      });\n      this.props.updateRemoteFiles({\n        auth,\n        files: flowFiles.concat(tableFiles),\n        branch: selectedBranch.name,\n        descriptor: this.props.repoData.descriptor,\n      });\n    };\n    const handleStartOver = () => {\n      this.props.setStep({ id: \"0\" });\n    };\n\n    return (\n      <div>\n        <Columns>\n          <Column>\n            <strong>fixed flows table by source</strong>\n            {Object.keys(groupedFlows).map((source) => {\n              return <p>{source}.csv</p>;\n            })}\n          </Column>\n          <Column>\n            <div>\n              <strong>updated reference tables</strong>\n              {updatedTables.map((table) => {\n                const resource = this.props.repoData.descriptor.resources.find(\n                  (r) => r.name === table.name);\n                  if (!resource)\n                    throw new Error(`Resource ${table.name} can't be found in descriptor.`);\n                const fileName = resource.path.split(\".\")[0].split(\"/\").slice(-1)[0]\n                const handleExportTable = () => {     \n                  downloadTable(referenceTables[table.name], fileName, \"csv\");\n                };\n                return (\n                  <Control>\n                    <a href=\"#\" onClick={handleExportTable}>\n                      {fileName} table: {table.updatedRows.length} rows added\n                    </a>\n                  </Control>\n                );\n              })}\n            </div>\n          </Column>\n        </Columns>\n        <Field isGrouped>\n          <Control>\n            <Button isColor=\"info\" onClick={handleExportFlow}>\n              Download fixed flows\n            </Button>\n          </Control>\n          <Control>\n            {remoteUpdateStatus === \"updated\" ? (\n              <Button isColor=\"success\" onClick={handleStartOver}>\n                Start a new import\n              </Button>\n            ) : (\n              <Button\n                isDisabled={remoteUpdateStatus === \"loading\"}\n                isColor=\"info\"\n                onClick={this.handleOpenModal}\n              >\n                Publish tables to \"{selectedBranch.name}\" branch\n              </Button>\n            )}\n          </Control>\n        </Field>\n        <Field>\n          {remoteUpdateStatus === \"loading\" && (\n            <Help isColor=\"success\">\n              updating files on github: {remoteUpdateMessage}...\n            </Help>\n          )}\n          {remoteUpdateStatus === \"updated\" && (\n            <Help isColor=\"success\">\n              files have been commited on github see{\" \"}\n              <a\n                href={`https://github.com/${owner}/${repoName}/commit/${lastCommit}`}\n              >\n                commit details\n              </a>\n            </Help>\n          )}\n          {remoteUpdateStatus === \"fail\" && (\n            <Help isColor=\"danger\">fail to update files on github</Help>\n          )}\n        </Field>\n        <GithubAuthModal\n          isActive={this.state.isModalShow}\n          isCommit={true}\n          closeModal={this.handleCloseModal}\n          onSubmitAuth={handleUpdateRemoteFiles}\n        />\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = (state) => ({\n  flows: state.flows,\n  referenceTables: state.referenceTables.referenceTables,\n  originalLength: state.referenceTables.originalLength,\n  repoData: state.repoData,\n});\n\nexport default connect(mapStateToProps, {\n  setStep,\n  exportFlows,\n  updateRemoteFiles,\n})(DataPublish);\n","import DataPublish from './DataPublish'\n\nexport default DataPublish","import React from 'react';\nimport {connect} from 'react-redux'\n\nimport {\n  Button,\n  Help\n} from 'design-workshop';\n\nimport { \n  fetchAllTables,\n} from '../../redux/modules/repoData';\n\nimport {loginCreateBranch, logoutUser} from '../../redux/modules/repoData';\n\nimport GithubAuthModal from '../../components/GithubAuthModal';\n\n\nclass DataPrep extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isModalShow: false \n    }\n  }\n   \n  handleShowLogin =()=> {\n    this.setState({\n      isModalShow: true\n    })\n  }\n\n  handleCloseModal = () => {\n    this.setState({\n      isModalShow: false\n    })\n  }\n   \n  handleLogin = (payload) => {\n    this.props.loginCreateBranch(payload);\n    this.handleCloseModal()\n  }\n\n  renderFetchTable() {\n    const {repoData} = this.props;\n    const {selectedBranch, tables, isBranchCreated} = repoData;\n\n    const handleGetTables = () => {\n      this.props.fetchAllTables({branch: selectedBranch.name});\n    }\n\n    return (\n      <div>\n        {isBranchCreated ? \n          <Help isColor=\"success\">branch \"{selectedBranch.name}\" is created</Help> : \n          <Help isColor=\"danger\">could not get branch from github, try login again</Help>\n        }\n        {\n          selectedBranch && !tables && \n          <Button isColor=\"info\" onClick={handleGetTables}>Fetch table from branch {selectedBranch.name}</Button>\n        }\n        {selectedBranch && (tables ?\n          <Help isColor=\"success\">tables from {selectedBranch.name} branch are loaded</Help>:\n          <Help isColor=\"danger\">tables are not loaded, please reload from {selectedBranch.name} branch</Help>)\n        }\n      </div>\n    )\n  }\n\n  render () {\n    const {repoData} = this.props;\n    const {selectedBranch, isLogined} = repoData;\n  \n    return (\n      <div>\n        {/* <Label>Get tables from {selectedBranch.name} branch</Label>\n          <Select value={selectedBranch} onChange={handleSelectBranch}>\n            {\n              branches.map((item, index) => {\n                return (\n                  <option key={index}>{item.name}</option>\n                )\n              })\n            }\n          </Select>\n          <Button isColor=\"info\" onClick={handleGetTables}>Fetch</Button> */}\n          { !isLogined &&\n            <Button isColor=\"info\" onClick={this.handleShowLogin}>\n            <span>Login to get branch</span>\n            </Button>\n          }\n          {\n            isLogined &&\n            <Button isColor=\"info\" onClick={this.props.logoutUser}>\n              <span>Logout</span>\n            </Button>\n          }\n          {selectedBranch && this.renderFetchTable()}\n          <GithubAuthModal \n            isActive={this.state.isModalShow}\n            isCommit={false}\n            closeModal={this.handleCloseModal} \n            onSubmitAuth={this.handleLogin} />\n      </div>\n    )\n  }\n}\n\nconst mapStateToProps = state => ({\n repoData: state.repoData\n})\n\nexport default connect(mapStateToProps, {\n  logoutUser,\n  loginCreateBranch,\n  fetchAllTables\n})(DataPrep);","import DataPrep from './DataPrep'\n\nexport default DataPrep","import React from 'react';\nimport {difference} from 'lodash';\n\n\nconst HeaderValidation = ({\n  headerNames,\n  fieldNames\n}) => {\n  const diffLength = headerNames.length - fieldNames.length;\n  let diff;\n  if (diffLength > 0) {\n    diff = difference(headerNames, fieldNames);\n  }\n  else diff = difference(fieldNames, headerNames);\n  const validationMap = headerNames.map((name, index) => {\n    if (fieldNames[index] && fieldNames[index] === name) {\n      return {\n        name,\n        valid: true\n      }\n    } else {\n      return {\n        name,\n        valid: false\n      }\n    }\n  });\n\n  return (\n    <div style={{\n      }}>\n      {diff.length === diffLength && diffLength > 0 &&\n        <div className=\"has-text-danger\">\n          <span>Extra headers - </span>\n          { diff.map((field) => {\n             return <span>\"{field}\" </span>\n            })\n          }\n        </div>\n      } \n      {diff.length === Math.abs(diffLength) && diffLength < 0 &&\n        <div className=\"has-text-danger has-text-weight-bold\">\n          <span>Missing headers - </span>\n          { diff.map((field) => {\n             return <span>\"{field}\" </span>\n            })\n          }\n        </div>\n      }\n      <div style={{\n        display: 'flex',\n        justifyContent: 'space-evenly'\n      }}>\n        <div>\n          <div className=\"has-text-weight-bold\">headers </div>\n          {\n            validationMap.map((item, index) => {\n              return (\n                <div key={index} className={item.valid ? 'has-text-black': 'has-text-danger'}>\n                  {item.name}\n                </div>\n              );\n            })\n          }\n        </div>\n        <div>\n          <div className=\"has-text-weight-bold\">schema fields</div>\n          {\n            fieldNames.map((columnName, index) => {\n              return (\n                <div key={index}>\n                  {columnName}\n                </div>\n              );\n            })\n          }\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default HeaderValidation;","import React from 'react'\nimport {connect} from 'react-redux'\nimport {findIndex} from 'lodash';\n\nimport {Button, DropZone} from 'design-workshop'\nimport { \n  importFlows,\n} from '../../redux/modules/flows';\n\nimport { \n  setStep\n} from '../../redux/modules/ui';\n\nimport {\n  validateHeader, \n  getResourceSchema\n} from '../../redux/modules/schemaValidation';\n\nimport DataPrep from '../DataPrep';\n\nimport HeaderValidation from '../../components/HeaderValidation';\n\nimport {parseSheet, parseTable} from '../../utils/fileParser';\nimport { MAXIMUM_FILE_SIZE } from '../../constants';\n\nconst prepareFlowData = (data, schema) => {\n  // lower foreignKeys\n  const FKFieldsIndices = schema.foreignKeys.map(fk => Array.isArray(fk.fields) ? fk.fields : [fk.fields]).reduce((set, fields) => {\n    //unique map results\n    fields.forEach(f => {\n      // hardcoded exception...\n      if (f !== 'source') {\n        const i = data[0].indexOf(f)\n        if (!set.includes(i))\n          set.push(i);\n        };\n      }\n    );\n    return set;\n  }, []);\n\n  // lowercase Reporting and partner + strip\n return data.map( (d,i) => {\n    if (i !== 0) {\n      return d.map( (v,i) => {\n        // Foreign Key fields are forced lowercase and trimed to limit glue work\n        if (FKFieldsIndices.includes(i) && v.toLowerCase)\n          return v.toLowerCase().trim();\n        else\n          return v;\n      })\n    }\n    else // don't touch headers..\n      return d\n  })\n}\n\nconst FileUpload = ({\n  steps,\n  selectedStep,\n  schema,\n  tables,\n  flows,\n  headerFeedback,\n  setStep,\n  importFlows,\n  validateHeader\n}) => {\n  const handleDrop = ([file]) => {\n    if (file.name.split('.')[1] === 'xlsx') {\n      parseSheet(file)\n      .then((data) => {\n        data = prepareFlowData(data, schema);\n        importFlows({\n          file: {\n            name: file.name.split('.')[0]\n          },\n          data\n        });\n        validateHeader({source: data, schema})\n      })\n      .catch((error) => {\n        console.error(error)\n        console.error('fail to parse file')\n      })\n    }\n    else {\n      parseTable(file)\n      .then((data) => {\n        data = prepareFlowData(data, schema);\n        importFlows({\n          file: {\n            name: file.name\n          },\n          data\n        });\n        validateHeader({source: data, schema})\n      })\n      .catch((error) => {\n        console.error(error)\n        console.error('fail to parse file')\n      })\n    }\n  }\n  const handleDropRejected = (file, event) => {\n    console.log(\"file is invalid\")\n  }\n  const handleNextStep = () => {\n    const currentIndex = findIndex(steps, selectedStep);\n    setStep(steps[currentIndex+1])\n  }\n  return (\n    <div>\n      <DataPrep />\n      {\n        tables &&\n        <DropZone\n          maxSize={MAXIMUM_FILE_SIZE}\n          onDrop={handleDrop}\n          onDropRejected={handleDropRejected}\n          isSize=\"small\">\n          <span className=\"tech-info\">Cick here to upload or drag and drop .xlsx, .csv file here(maximum 10MB)</span>\n        </DropZone>\n      }\n      {\n        headerFeedback && headerFeedback.status === 'loading' &&\n        <span>Validating Headers</span>\n      }\n      {\n        headerFeedback && headerFeedback.valid &&\n        <div style={{\n          display: 'flex',\n          justifyContent: 'space-between'\n          }}>\n          <span className=\"has-text-success has-text-weight-bold\">Headers of \"{flows.file.name}\" are valid</span>\n          <Button \n            isColor=\"info\" \n            onClick={handleNextStep}>\n              Next Step\n          </Button>\n        </div>\n      }\n      {\n        headerFeedback && !headerFeedback.valid && headerFeedback.type === 'ERROR_HEADER' &&\n        <div style={{\n          textAlign:'center'\n          }}>\n          <span className=\"has-text-danger has-text-weight-bold\">Headers of \"{flows.file.name}\" do not match schema fields, please fix your file and re-upload</span>\n          <HeaderValidation \n            headerNames = {headerFeedback.headerNames}\n            fieldNames = {headerFeedback.fieldNames}\n          />\n        </div>\n      }\n    </div>\n  )\n}\n\n\nconst mapStateToProps = state => ({\n  steps: state.ui.steps,\n  selectedStep: state.ui.selectedStep,\n  schema: state.repoData.descriptor && getResourceSchema(state),\n  flows: state.flows,\n  tables: state.repoData.tables,\n  headerFeedback: state.schemaValidation.headerFeedback\n })\n \n export default connect(mapStateToProps, {\n  importFlows,\n  setStep,\n  validateHeader\n })(FileUpload);\n","import FileUpload from './FileUpload'\n\nexport default FileUpload","\nimport XLSX from 'xlsx';\nimport {\n  csvParseRows,\n  tsvParse,\n} from 'd3-dsv';\n\nexport function parseTable( file ) {\n  return new Promise( ( resolve, reject ) => {\n    let reader = new FileReader();\n    reader.onload = ( event ) => {\n      let data;\n      if (file.name.split('.')[1] === 'csv') {\n        data = csvParseRows(event.target.result);\n      }\n      else {\n        data = tsvParse(event.target.result);\n      }\n      resolve(data);\n      reader = undefined;\n    };\n    reader.onerror = ( event ) => {\n      reject( event.target.error );\n      reader = undefined;\n    };\n    return reader.readAsText( file );\n  } );\n}\n\nexport function parseSheet( file ) {\n  return new Promise( (resolve, reject) => {\n    let reader = new FileReader();\n    // Handle errors loadrABS\n    reader.onload = ( event ) => {\n      const bstr = event.target.result;\n      const wb = XLSX.read(bstr, {\n        type: 'binary', \n        // raw: true //If true, plain text parsing will not parse values **\n      }); \n\t\t\t// Get first worksheet\n\t\t\tconst wsname = wb.SheetNames[0];\n\t\t\tconst ws = wb.Sheets[wsname];\n\t\t\t// Convert to \"2D Array\"\n      const data = XLSX.utils.sheet_to_json(ws, {\n        header: 1, \n        // raw: false, // use raw values (true) or formatted strings (false)\n        defval: '', // set null and undefined to empty string for validation\n        blankrows: false // skip blank rows\n      });\n      resolve(data)\n      reader = undefined;\n    };\n    reader.onerror = ( event ) => {\n      reject( event.target.error );\n      reader = undefined;\n    };\n    // Read file into memory as UTF-8\n    reader.readAsBinaryString( file );\n  })\n}","import React from 'react';\nimport {groupBy, sortBy} from 'lodash';\n\nimport {RANKED_FIELDS} from '../constants';\n\nconst OverviewTable = ({\n  className,\n  collectedErrors,\n}) => {\n  const columnNames = ['Field', 'Error Type', 'Error Overview']\n  const orderedErrors = sortBy(collectedErrors, (field) => {\n    return RANKED_FIELDS[field.name]\n  })\n  return (\n    <div style={{position: 'relative', width: '100%', height: '70vh'}}>\n      \n      <div className={`action-table ${className}`}>\n        <div className={'action-table-header'}>\n          {\n            columnNames.map((columnName, index) => {\n              return (\n                <div key={index} className=\"table-cell\">\n                  {columnName}\n                </div>\n              );\n            })\n          }\n        </div>\n        <div className={'action-table-main'}>\n          {\n            orderedErrors.map((field, rowIndex) => {\n              // const field = collectedErrors[errorKey];\n              const totalErrors = field.errors.length;\n              const groupedErrors = groupBy(field.errors, (v)=> {return v.value});\n              const distinctErrors = Object.keys(groupedErrors).length;\n              return (\n                <div key={rowIndex} className=\"table-row\">\n                  {\n                    columnNames.map((columnName, columnIndex) => {\n                      let missingRows = [];\n                      if (field.errorType === 'ERROR_FORMAT' && (field.name==='reporting' || field.name === 'partner')) {\n                        missingRows = field.errors.map((error) => error.rowNumber);\n                      }\n                      if(columnIndex === 0) return (<div key={columnIndex} className=\"table-cell\">{field.name}</div>)\n                      else if(columnIndex === 1) return (<div key={columnIndex} className=\"table-cell\">{field.errorType}</div>)\n                      else return (\n                        <div key={columnIndex} className=\"table-cell\">\n                          <span>{distinctErrors} different invalid values, {totalErrors} rows affected in total</span>\n                          {missingRows.map((rowNumber)=> {\n                            return (<li className=\"has-text-danger\">missing value in row {rowNumber}</li>)\n                          })}\n                        </div>\n                      )\n                      \n                    })\n                  }\n                </div>\n              );\n            })\n          }\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default OverviewTable","import React from 'react';\nimport {connect} from 'react-redux';\nimport {findIndex} from 'lodash';\n\nimport {Button} from 'design-workshop';\nimport { \n  setStep\n} from '../../redux/modules/ui';\nimport {startModification} from '../../redux/modules/modification';\n\nimport OverviewTable from '../../components/OverviewTable';\n\nimport {validateTable, getRelations, getResourceSchema, getGroupedErrors} from '../../redux/modules/schemaValidation';\n\nclass SchemaValidation extends React.Component {\n  componentDidMount () {\n    const {flows, schema, relations, schemaFeedback} = this.props;\n    if (!schemaFeedback) {\n      this.props.validateTable({source:flows, schema, relations});\n    }\n  }\n  render() {\n    const {schemaFeedback, modificationList, steps, selectedStep} = this.props;\n    let isRequiredFieldMissing = false;\n    if (schemaFeedback && schemaFeedback.collectedErrors) {\n      isRequiredFieldMissing = (schemaFeedback.collectedErrors['reporting'] && schemaFeedback.collectedErrors['reporting'].errorType === 'ERROR_FORMAT') || \n                            (schemaFeedback.collectedErrors['partner'] && schemaFeedback.collectedErrors['partner'].errorType === 'ERROR_FORMAT')\n    }\n    const handlePrevStep = () => {\n      const currentIndex = findIndex(steps, selectedStep)\n      this.props.setStep(steps[currentIndex-1])\n    }\n    const handleNextStep = () => {\n      if (!modificationList) {\n        const groupedErrors = getGroupedErrors(schemaFeedback.collectedErrors);\n        this.props.startModification(groupedErrors)\n      }\n      const currentIndex = findIndex(steps, selectedStep)\n      this.props.setStep(steps[currentIndex+1])\n    }\n    return (\n      <div>\n        {\n          schemaFeedback && schemaFeedback.status === 'loading' &&\n          <span>{schemaFeedback.loader}</span>\n        }\n        {\n          schemaFeedback && !schemaFeedback.valid && schemaFeedback.collectedErrors &&\n          <div>\n            <span className=\"has-text-danger has-text-weight-bold\">\n              Found errors in {schemaFeedback.errors.length} rows of {Object.keys(schemaFeedback.collectedErrors).length} fields\n              {isRequiredFieldMissing && <span>, value of required field is missing, please fix it locally first</span>}\n            </span>\n            <OverviewTable collectedErrors={schemaFeedback.collectedErrors} />\n            <div style={{\n              display: 'flex',\n              justifyContent: 'space-between'\n            }}>\n              <Button \n                isColor=\"info\" \n                onClick={handlePrevStep}>\n                  Previous Step\n              </Button>\n              <Button \n                isColor=\"info\"\n                isDisabled= {isRequiredFieldMissing}\n                onClick={handleNextStep}>\n                  Review Errors\n              </Button>\n            </div>\n           \n          </div>\n        }\n        {\n          schemaFeedback && schemaFeedback.valid && <span className=\"has-text-success has-text-weight-bold\">Flows data is valid</span>\n        }\n      </div>\n    )\n  }\n}\nconst mapStateToProps = state => ({\n  steps: state.ui.steps,\n  selectedStep: state.ui.selectedStep,\n  flows: state.flows.data,\n  schema: getResourceSchema(state),\n  relations: getRelations(state),\n  schemaFeedback: state.schemaValidation.schemaFeedback,\n  modificationList: state.modification.modificationList\n})\n\nexport default connect(mapStateToProps, {\n  validateTable,\n  setStep,\n  startModification,\n})(SchemaValidation);","import SchemaValidation from './SchemaValidation'\n\nexport default SchemaValidation","import Layout from './Layout'\n\nexport default Layout","/* eslint-disable no-unused-vars */\nimport React from 'react';\n\nimport {\n    LayoutWrapper,\n    LayoutContainer,\n    LayoutNav,\n    LayoutFooter,\n    LayoutFooterColumn,\n    LayoutContent,\n    LayoutContentColumn,\n    LayoutHeader,\n    AppTitle,\n    RunningTitle,\n    Content,\n    ButtonContainer,\n    Button\n} from 'design-workshop';\n\nconst Layout = ({\n  steps, \n  selectedStep, \n  onSetStep,\n  children\n}) => {\n  return (\n    <LayoutWrapper hasConfig>\n      <LayoutHeader>\n        <AppTitle>Ricardo Data App</AppTitle>\n        <RunningTitle>{selectedStep.title}</RunningTitle>\n      </LayoutHeader>\n      <LayoutContainer>\n        <LayoutContent>\n          <LayoutContentColumn isConfig>\n            {steps.map((step, index) => {\n              const isSelectedStep = (selectedStep.id === step.id)\n              const isStepDisabled = step.id > selectedStep.id;\n              const handleClickStep = () => onSetStep(step)\n              return (\n                <ButtonContainer key={index} >\n                  <Button \n                    isColor={isSelectedStep ? \"info\" : null} \n                    isDisabled={isStepDisabled}\n                    onClick={handleClickStep}>\n                    {step.name}\n                  </Button>\n                </ButtonContainer>)\n              })\n            }\n          </LayoutContentColumn>\n          <LayoutContentColumn isWorkspace>\n            {children}\n          </LayoutContentColumn>\n        </LayoutContent>\n        <LayoutFooter>\n          <LayoutFooterColumn isSecondary>\n            <h3>médialab SciencesPo</h3>\n          </LayoutFooterColumn>\n          <LayoutFooterColumn isPrimary>\n            Ricardo Data App\n          </LayoutFooterColumn>\n        </LayoutFooter>\n      </LayoutContainer>\n    </LayoutWrapper>\n  )\n};\n\nexport default Layout;\n","/* eslint-disable jsx-a11y/anchor-is-valid */\nimport React from 'react';\n\nimport {\n  Button,\n  Field,\n  Control\n} from 'design-workshop';\n\nimport {\n  Modal,\n  ModalBackground,\n  ModalClose,\n  ModalCard,\n  ModalCardBody,\n} from 'bloomer';\n\nimport {downloadTable} from '../utils/fileExporter';\nconst LeaveModificationModal = ({\n  originalLength,\n  referenceTables,\n  onSelectDiscard, \n  onSelectDownload,\n  isActive,\n  closeModal\n}) => {\n  let updatedTables = [];\n  if (referenceTables) {\n    Object.keys(referenceTables).forEach((name) => {\n      if (referenceTables[name].length !== originalLength[name]) {\n        updatedTables.push({\n          name,\n          updatedRows: referenceTables[name].slice(originalLength[name])\n        })\n      }\n    });\n  }\n\n  return (\n    <Modal isActive={isActive}>\n      <ModalBackground onClick={closeModal} />\n      <ModalCard>\n        <ModalCardBody>\n          <div style={{\n          textAlign:'center'\n          }}>\n              <h5 className=\"title is-5\">Leave this step, you might lost your modification?</h5>\n              {updatedTables.length>0 && <p>updated reference tables</p>}\n              {\n                updatedTables.map((table, i)=>{\n                  const handleExportTable = () => {\n                    downloadTable(referenceTables[table.name], table.name, 'csv')\n                  }\n                  return (\n                    <div key={i}>\n                      <a href=\"#\" onClick={handleExportTable}>{table.name} table: {table.updatedRows.length} rows added</a>\n                    </div>\n                  )\n                })\n              }\n              <Field isGrouped>\n                <Control>\n                  <Button onClick={onSelectDownload} isColor=\"success\">Download fixed flows</Button>\n                </Control>\n                <Control>\n                  <Button onClick={onSelectDiscard} isColor=\"danger\">Discard</Button>\n                </Control>\n                <Control>\n                  <Button onClick={closeModal} isColor=\"info\">Cancel</Button>\n                </Control>\n            </Field>\n            </div>\n        </ModalCardBody>\n      </ModalCard>\n      <ModalClose onClick={closeModal} />\n    </Modal>\n  )\n}\n\nexport default LeaveModificationModal","/* eslint-disable no-unused-vars */\nimport React from 'react';\nimport {connect} from 'react-redux'\n\nimport DataModification from './containers/DataModification';\nimport DataPublish from './containers/DataPublish';\nimport FileUpload from './containers/FileUpload';\n\n\nimport SchemaValidation from './containers/SchemaValidation';\nimport Layout from './containers/Layout';\n\nimport {downloadFlow} from './utils/fileExporter';\n\nimport styles from 'design-workshop/themes/default/style.css';\nimport './App.css';\n\nimport { \n  setStep,\n  showModal,\n  hideModal\n} from './redux/modules/ui';\n\nimport LeaveModificationModal from './components/LeaveModificationModal';\n\nconst App = ({\n  steps,\n  isModalDisplay,\n  selectedStep,\n  repoData,\n  flows,\n  referenceTables,\n  originalLength,\n  modificationList,\n  //actions\n  setStep,\n  showModal,\n  hideModal\n}) => {\n\n  const renderChildren = () => {\n    switch(selectedStep.id) {\n      case '0':\n      default:\n        return <FileUpload />;\n      case '1':\n        return <SchemaValidation />;\n      case '2':\n        return <DataModification />;\n      case '3':\n        return <DataPublish />;\n    }\n  }\n  const handleExport = () => {\n    const {file, data} = flows;\n    downloadFlow(data, `${file.name}_ongoing_corrections`, 'csv')\n  }\n\n  const handleSetStep = (step) => {\n    const {remoteUpdateStatus} = repoData;\n    let fixed\n    if (modificationList) {\n      fixed = modificationList.filter((item) => item.fixed)\n    }\n    if(fixed && step.id === '0' && remoteUpdateStatus !== 'updated') showModal();\n    else setStep(step)\n  }\n\n  const handleDiscard = () => {\n    setStep(steps[0]);\n  }\n  \n  return (\n    <div className=\"App\">\n      <Layout \n        steps={steps}\n        selectedStep={selectedStep}\n        onSetStep={handleSetStep}>\n        {renderChildren()}\n      </Layout>\n      <LeaveModificationModal\n        referenceTables={referenceTables}\n        originalLength={originalLength}\n        isActive={isModalDisplay}\n        onSelectDiscard={handleDiscard}\n        onSelectDownload={handleExport}\n        closeModal={hideModal} />\n    </div>\n  );\n}\n\n\nconst mapStateToProps = state => ({\n  steps: state.ui.steps,\n  isModalDisplay: state.ui.isModalDisplay,\n  flows: state.flows,\n  referenceTables: state.referenceTables.referenceTables,\n  originalLength: state.referenceTables.originalLength,\n  selectedStep: state.ui.selectedStep,\n  modificationList: state.modification.modificationList,\n  repoData: state.repoData\n })\n \n export default connect(mapStateToProps, {\n  showModal,\n  hideModal,\n  setStep\n })(App);\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import { combineReducers } from 'redux'\nimport ui from './modules/ui';\nimport flows from './modules/flows';\nimport referenceTables from './modules/referenceTables';\nimport repoData from './modules/repoData';\nimport schemaValidation from './modules/schemaValidation';\nimport modification from './modules/modification';\nexport default combineReducers({\n  ui,\n  flows,\n  referenceTables,\n  schemaValidation,\n  modification,\n  repoData\n})","import { createStore, applyMiddleware, compose } from 'redux'\nimport { persistStore, persistReducer } from 'redux-persist'\n// import storage from 'redux-persist/lib/storage' // defaults to localStorage for web\nimport * as storage from 'localforage';\n\nimport thunk from 'redux-thunk'\nimport rootReducer from './rootReducer'\n\nconst persistConfig = {\n  key: 'root',\n  storage,\n}\nconst persistedReducer = persistReducer(persistConfig, rootReducer)\n\n\nexport default function configureStore ( initialState = {} ) {\n  const enhancers = []\n  const middleware = [thunk]\n  \n  if (process.env.NODE_ENV === 'development') {\n    const devToolsExtension = window.__REDUX_DEVTOOLS_EXTENSION__\n  \n    if (typeof devToolsExtension === 'function') {\n      enhancers.push(devToolsExtension())\n    }\n  }\n  \n  const composedEnhancers = compose(\n    applyMiddleware(...middleware),\n    ...enhancers\n  )\n  \n  let store = createStore(\n    // rootReducer,\n    persistedReducer,\n    initialState,\n    composedEnhancers\n  )\n  let persistor = persistStore(store)\n  return { store, persistor }\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux'\n\nimport './index.css';\nimport App from './App';\n\nimport * as serviceWorker from './serviceWorker';\n\nimport configureStore from './redux/configureStore';\n\nconst initialState = {};\nconst {store} = configureStore(initialState);\n\n\nReactDOM.render(\n  <Provider store={store}>\n    <App />\n  </Provider>, \n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","var map = {\n\t\"./geojson.json\": 384,\n\t\"./table-schema.json\": 891,\n\t\"./topojson.json\": 385\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 890;","var map = {\n\t\"./data-package.json\": 960,\n\t\"./data-resource.json\": 961,\n\t\"./fiscal-data-package.json\": 962,\n\t\"./registry.json\": 963,\n\t\"./tabular-data-package.json\": 964,\n\t\"./tabular-data-resource.json\": 965\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 959;"],"sourceRoot":""}