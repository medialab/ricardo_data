(this["webpackJsonpricardo-data-app"]=this["webpackJsonpricardo-data-app"]||[]).push([[0],{24:function(e){e.exports=JSON.parse('{"f":"https://raw.githubusercontent.com/medialab/ricardo_data","a":"https://api.github.com/repos/medialab/ricardo_data/contents","b":"https://api.github.com/repos/medialab/ricardo_data/branches","d":"https://api.github.com/repos/medialab/ricardo_data/git/refs","c":"medialab","e":"ricardo_data"}')},339:function(e,t){},353:function(e,t,a){e.exports=a(921)},361:function(e,t,a){},533:function(e,t){},535:function(e,t){},544:function(e,t){},546:function(e,t){},571:function(e,t){},573:function(e,t){},574:function(e,t){},579:function(e,t){},582:function(e,t){},602:function(e,t){},618:function(e,t){},621:function(e,t){},666:function(e,t,a){var s={"./geojson.json":292,"./table-schema.json":667,"./topojson.json":293};function n(e){var t=r(e);return a(t)}function r(e){if(!a.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}n.keys=function(){return Object.keys(s)},n.resolve=r,e.exports=n,n.id=666},732:function(e,t,a){var s={"./data-package.json":733,"./data-resource.json":734,"./fiscal-data-package.json":735,"./registry.json":736,"./tabular-data-package.json":737,"./tabular-data-resource.json":738};function n(e){var t=r(e);return a(t)}function r(e){if(!a.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}n.keys=function(){return Object.keys(s)},n.resolve=r,e.exports=n,n.id=732},832:function(e,t,a){var s={"./geojson.json":327,"./table-schema.json":833,"./topojson.json":328};function n(e){var t=r(e);return a(t)}function r(e){if(!a.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}n.keys=function(){return Object.keys(s)},n.resolve=r,e.exports=n,n.id=832},916:function(e,t){},917:function(e,t){},919:function(e,t,a){},921:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),r=a(40),l=a.n(r),i=a(20),o=(a(361),a(4)),c=a(2),d=a(72);const u={foreignKeyField:null,modificationIndex:0,modificationList:null};var h=Object(d.a)(u,{SET_STEP:(e,t)=>{const{payload:a}=t;if("0"===a.id)return u},START_MODIFICATION:(e,t)=>{const{payload:a}=t;e.modificationList=a,e.modificationIndex=0},REVALIDATE_ROWS_SUCCESS:(e,t)=>{const{payload:a}=t,{originalValue:s,fixedValues:n}=a;e.modificationList.forEach((t,a)=>{"currency|year|reporting"===t.field&&t.value.split("|")[1]===""+s&&(e.modificationList[a]={...e.modificationList[a],fixed:!0,fixedStatus:"autoFixed",unchangable:!0,fixedValues:{currency:t.value.split("|")[0],year:n.year,reporting:t.value.split("|")[2]}})})},REVALIDATE_ROWS_FAILURE:(e,t)=>{const{payload:a}=t,{fixedValues:s,rowNumbers:n}=a;e.modificationList.forEach((t,a)=>{const r=t.errors.map(e=>e.rowNumber);if("currency|year|reporting"===t.field&&Object(o.isEqual)(r,n)){const n=t.value.split("|")[0]+"|"+s.year+"|"+t.value.split("|")[2],r=e.modificationList.find(e=>e.value===n);r&&r.index!==a?e.modificationList[a]={...e.modificationList[a],fixed:!0,fixedStatus:"fixInOther",unchangable:!0,fixedValues:{currency:t.value.split("|")[0],year:s.year,reporting:t.value.split("|")[2]}}:e.modificationList[a]={...e.modificationList[a],fixed:!1,fixedStatus:"notFixed",unchangable:!1,value:n,fixedValues:null}}})},HIDE_MODIFICATION:(e,t)=>{e.modificationIndex=0},SELECT_ERROR:(e,t)=>{const{payload:a}=t;e.modificationIndex=a.index},GO_NEXT_ERROR:(e,t)=>{e.modificationIndex=e.modificationIndex+1},GO_PREV_ERROR:(e,t)=>{e.modificationIndex>0&&(e.modificationIndex=e.modificationIndex-1)},SUBMIT_MODIFICATION:(e,t)=>{const{payload:a}=t;e.modificationList[a.index]={...e.modificationList[a.index],...a,fixed:!0}}}),m=a(924);const f={};var p=Object(d.a)(f,{INIT_TABLES:e=>f,FETCH_TABLES_SUCCESS:(e,t)=>{let{payload:a}=t;const s={},n={};Object.keys(a).forEach(e=>{s[e]=Object(m.b)(a[e],e=>Object(o.mapValues)(e,(e,t)=>"year"===t?+e:""===e?null:e)),n[e]=s[e].length}),e.referenceTables=s,e.originalLength=n},DELETE_TABLE_ROW:(e,t)=>{let{payload:a}=t;const{data:s,resourceName:n}=a;let r=e.referenceTables[n].slice();r=r.filter(e=>!s.some(t=>Object(o.isEqual)(e,t))),e.referenceTables[n]=r},ADD_TABLE_ROW:(e,t)=>{let{payload:a}=t;const{data:s,resourceName:n}=a,r=e.referenceTables[n].slice();r.splice(r.length,0,...s),e.referenceTables[n]=r}});const E=e=>t=>{"0"===e.id&&t({type:"INIT_TABLES"}),t({type:"SET_STEP",payload:e})},g=[{id:"0",name:"Upload file",title:"Choose a file"},{id:"1",name:"Schema Validation",title:"Schema validation against datapackage"},{id:"2",name:"Error Fixing",title:"Fix errors by fields"},{id:"3",name:"Export/Publish Data",title:"Export or Publish your data to Github"}],b={steps:g,isModalDisplay:!1,selectedStep:g[0],isModification:!1,fixedIndex:[]};const w={};var C=Object(d.a)(w,{SET_STEP:(e,t)=>{const{payload:a}=t;if("0"===a.id)return w},IMPORT_FLOWS:(e,t)=>{const{payload:a}=t;return a},UPDATE_FLOWS:(e,t)=>{const{payload:a}=t,{errors:s,fixedValues:n}=a,r=Object.keys(n);s.forEach(t=>{r.forEach(a=>{const s=e.data[0].indexOf(a);e.data[t.rowNumber-1][s]=n[a]})})}}),v=a(199),y=a(347),R=a(46);const S={id:0,flow:1,unit:2,year:3,species_bullions:4,transport_type:5,statistical_period:6,partner_sum:7,world_trade_type:8,notes:9,source:10,reporting:11,partner:12,"export_import|special_general":13,"currency|year|reporting":14},T={partner:"RICname",reporting:"RICname",currency:"modified_currency",export_import:"modified_export_import",special_general:"modified_special_general"},x=["slug","export_import","special_general","reporting","partner","original_name","currency","year"],_=/[^a-zA-Z0-9]+/g,O=(e,t)=>t.map(t=>e[t]?e[t].trim().split(" ").map(e=>Object(o.capitalize)(e.replace(_,""))).join(""):null,"").filter(e=>e).join("_"),A=["name","editor","country","volumn_number","shelf_number"];var N=a(32),F=a(24),I=a(195),L=a.n(I),D=a(196),k=a(88);const V=e=>t=>{const{branch:a}=e;t({type:"FETCH_DATAPACKAGE_REQUEST"});try{Object(N.get)(`${F.f}/${a}/datapackage.json?cb=${Date.now()}`,{responseType:"json",responseEncoding:"utf8"}).then(s=>{const n=s.data,r=n.resources.filter(e=>!e.group&&"flows"!==e.name);t({type:"FETCH_DATAPACKAGE_SUCCESS",payload:n}),t({type:"FETCH_TABLES_REQUEST"}),Promise.all(r.map(e=>Object(N.get)(`${F.f}/${a}/${e.path}?cb=${Date.now()}`,{responseType:"text",responseEncoding:"utf8"}).then(t=>({...e,data:t.data})))).then(e=>{let a={};e.forEach(e=>{a[e.name]=e.data}),t({type:"FETCH_TABLES_SUCCESS",payload:a})}).catch(a=>{console.log(a),t({type:"FETCH_TABLES_FAILURE",payload:e,error:a})})})}catch(s){console.log(s),t({type:"FETCH_DATAPACKAGE_FAILURE",error:s})}},M={};const j=e=>"string"===typeof e?e:e.join("|"),B=(e,t,a)=>{const{fields:s,foreignKeys:n}=t,r=s.map(e=>e.name),l=["source","export_import","special_general","currency"],i=s.filter(e=>-1===l.indexOf(e.name)),o=n.map(e=>j(e.fields)),c=["ERROR_FORMAT","ERROR_FOREIGN_KEY"],d=i.reduce((e,t)=>({...e,[t.name]:{name:t.name,schema:t,errorType:"ERROR_FORMAT",errors:[]}}),{}),u=n.reduce((e,t)=>{const a=j(t.fields);return{...e,[a]:{name:a,...t,errorType:"ERROR_FOREIGN_KEY",errors:[]}}},{});return a.forEach(t=>{const a=e[t.rowNumber-1],{rowNumber:s,originalRowNumber:n}=t;c.forEach(e=>{const i=t.errors.find(t=>t.type===e);i&&("ERROR_FORMAT"===e?r.forEach((t,n)=>{i.errors.forEach(r=>{if(r.columnNumber===n+1&&-1===l.indexOf(t)){const l={rowNumber:s,errorType:e,columnNumber:r.columnNumber,field:t,value:a[n],message:r.message};d[t].errors.push(l)}})}):"ERROR_FOREIGN_KEY"===e&&o.forEach(t=>{i.errors.forEach(l=>{const i=j(l.columnName);if(i===t){const o=l.columnName.map(e=>{const t=r.indexOf(e);return a[t]}),c={rowNumber:s,originalRowNumber:n,errorType:e,columnName:l.columnName,field:i,value:o.join("|"),message:l.message};u[t].errors.push(c)}})}))})}),Object.keys(d).forEach(e=>{d[e].errors.length||delete d[e]}),Object.keys(u).forEach(e=>{u[e].errors.length||delete u[e]}),d.reporting||d.partner?d:{...d,...u}},U={resourceName:"flows",schemaFeedback:null,headerFeedback:null,descriptor:null};const P=e=>e.schemaValidation.resourceName,H=e=>e.schemaValidation.descriptor.resources,G=/row\s\d*/,K=Object(v.a)(P,H,(e,t)=>t.find(t=>t.name===e||t.group===e&&t.schema).schema),$=Object(v.a)(P,H,e=>e.referenceTables.referenceTables,(e,t,a)=>{const s=t.find(t=>t.name===e||t.group===e&&t.schema),n={};return s?s.schema?s.schema.foreignKeys?(s.schema.foreignKeys.forEach(e=>{const t=e.reference.resource;n[t]=a[t]}),n):{}:(console.error(`the resource ${s.name} has no schema !`),{}):(console.error(`the resource ${e} could not be found!`),{})});var W=e=>{let{className:t,modificationList:a,onSelectError:s}=e;const r=["","Field","Value","Rows",""],l=a.filter(e=>"year"===e.field&&!e.fixed).map(e=>""+e.value);return n.a.createElement("div",{style:{position:"relative",width:"100%",height:"70vh"}},n.a.createElement("div",{className:"action-table "+t},n.a.createElement("div",{className:"action-table-header"},r.map((e,t)=>n.a.createElement("div",{key:t,className:"table-cell"},n.a.createElement("span",{className:"Value"===e?"has-text-danger":"has-text-black"},e)))),n.a.createElement("div",{className:"action-table-main"},a.map((e,t)=>{const{field:a,errors:i,originalValue:d,value:u,message:h,fixed:m,fixedValues:f}=e,p=Object(o.values)(f).join("|"),E=Object(o.difference)(x,a.split("|")).length<x.length,g=()=>{s(t)};let b=!1;return"currency|year|reporting"===e.field&&-1!==l.indexOf(e.value.split("|")[1])&&(b=!0),n.a.createElement("div",{key:t,className:"table-row"},r.map((s,r)=>{switch(r){case 0:default:return n.a.createElement("div",{key:r,className:"table-cell"},t+1);case 1:return n.a.createElement("div",{key:r,className:"table-cell"},a);case 2:return n.a.createElement("div",{key:r,className:"table-cell"},d!==u&&n.a.createElement("span",{className:"has-text-danger"},d,"->"),n.a.createElement("span",{className:"has-text-danger"},Object(o.isNull)(u)?"none":u),m&&n.a.createElement("span",{className:"has-text-success"},"->",""===p?"none":p),n.a.createElement(c.HelpPin,null,h));case 3:return n.a.createElement("div",{key:r,className:"table-cell"},n.a.createElement("p",{className:e.fixed?"has-text-success":"has-text-black"},i.length," ",e.fixed&&!E?"rows updated":""),e.fixedReferenceTable&&e.fixedReferenceTable.length>0&&e.fixedReferenceTable.map((e,t)=>n.a.createElement("p",{key:t,className:"has-text-success"},e.data.length,' row(s) added to "',e.resourceName,'" table')));case 4:return n.a.createElement("div",{key:r,className:"table-cell"},n.a.createElement(c.Button,{isDisabled:b,isOutlined:!0,isColor:e.fixed?"success":"info",onClick:g},e.fixed?"fixed":"fix error"))}}))}))))};var q=e=>{let{className:t,flows:a,modificationItem:s}=e;const r=a[0],{errors:l,field:i,value:o,fixedValues:c}=s;return n.a.createElement("div",{style:{position:"relative",width:"100%",height:"20vh"}},n.a.createElement("div",{className:"action-table "+t},n.a.createElement("div",{className:"action-table-header"},r.map((e,t)=>{const a=-1!==i.split("|").indexOf(e);return n.a.createElement("div",{key:t,className:"table-cell"},n.a.createElement("span",{className:a?"has-text-danger":"has-text-black"},e))})),n.a.createElement("div",{className:"action-table-main",style:{height:"100%"}},l.map((e,t)=>n.a.createElement("div",{key:t,className:"table-row"},r.map((t,s)=>{const r=-1!==i.split("|").indexOf(t);let l;const d=i.split("|").indexOf(t);let u=(""+o).split("|")[d];return"year"===t&&1===d&&(u=a[e.rowNumber-1][s]),c&&r&&(l=0===c[t].length?"none":c[t]),n.a.createElement("div",{key:s,className:"table-cell",style:{wordBreak:"break-all"}},n.a.createElement("span",{className:r?"has-text-danger":"has-text-black"},r?u:a[e.rowNumber-1][s]),l&&n.a.createElement("span",{className:"has-text-success"},"->",l))}))))))},Q=a(89),z=a(348),Y=a.n(z),J=a(349);const X=e=>{let t,{tables:a,resourceName:s,referenceField:n,filter:r}=e;t=r?a[s].filter(e=>e[r.field]!==r.value).map(e=>e[n]):a[s].map(e=>e[n]);const l=Object(o.countBy)(t,e=>e);return Object(o.sortBy)(Object(o.toPairs)(l),e=>{let[t,a]=e;return-1*a}).map(e=>{let[t,a]=e;return t}).map(e=>({value:e,label:e}))};class Z extends n.a.Component{constructor(e){super(e),this.getStateFromProps=()=>{const{fieldDescriptor:e,fieldValue:t}=this.props,a=new R.Field(e);let s;return a.constraints&&a.constraints.enum&&(s=a.constraints.enum.map(e=>({label:e,value:e}))),{fieldSchema:a,value:t||"",fieldValid:{valid:!1},options:s,suggestions:[]}},this.validateField=e=>{const{fieldSchema:t}=this.state;let a;try{t.castValue(e),a={value:e,fieldValid:{valid:!0}},this.setState(a),this.props.onChange({fieldName:this.state.fieldSchema.name,...a})}catch(s){a={value:e,fieldValid:{valid:!1,error:s}},this.setState(a),this.props.onChange({fieldName:this.state.fieldSchema.name,...a})}},this.handleChange=e=>{let t;e?e&&e.value?this.validateField(e.value):e&&e.target?this.validateField(e.target.value):this.validateField(""):(t="",this.validateField(""))},this.handleClickCreate=()=>{const e=this.props.foreignKeys.find(e=>e.fields===this.state.fieldSchema.name);this.handleChange(""),this.props.onClickCreate({referenceMap:{field:this.state.fieldSchema.name,referenceField:e?e.reference.fields:this.state.fieldSchema.name}})},this.onSuggestionsFetchRequested=(e,t)=>{this.setState({suggestions:((e,t)=>{const a=e.trim().toLowerCase(),s=a.length;return 0===s?[]:t.filter(e=>e.toLowerCase().slice(0,s)===a)})(e,t)})},this.onSuggestionsClearRequested=()=>{this.setState({suggestions:[]})},this.handleSuggestionChange=(e,t)=>{let{newValue:a}=t;this.validateField(a)},this.renderSuggestion=e=>n.a.createElement("div",null,e),this.state=this.getStateFromProps()}componentDidUpdate(e){const{fieldDescriptor:t,fieldValue:a,fixedValue:s}=this.props;if("slug"===t.name&&a!==e.fieldValue&&this.validateField(a),s!==e.fixedValue&&!s){const e=this.getStateFromProps();this.setState({...e})}}renderField(){const{fieldValue:e,foreignKeys:t,referenceTables:a,showNewReference:s,newReference:r,isNonchangable:l,isValidationField:i,suggestedOptions:d}=this.props,{fieldSchema:u,value:h,suggestions:m}=this.state,f={placeholder:"",value:h,onChange:this.handleSuggestionChange};let p=!1;const E=e=>{let{value:t}=e;this.onSuggestionsFetchRequested(t,d)};let g;const b=e=>({value:e,label:e});if(-1!==Object(o.findIndex)(t,e=>e.fields===u.name||-1!==e.fields.indexOf(u.name))){const e=Object(o.findIndex)(t,e=>e.fields===u.name||-1!==e.fields.indexOf(u.name)),s=t[e].reference.fields;p=!0,g=X({tables:a,resourceName:t[e].reference.resource,referenceField:"object"===typeof s?s[0]:s})}return l?n.a.createElement("span",null,e):p?n.a.createElement("div",null,!s&&!r&&n.a.createElement(Q.a,{isSearchable:!0,isClearable:!0,value:b(h),options:this.state.options,onChange:this.handleChange,onInputChange:e=>{this.setState({options:Object(J.a)(g,e,{keys:["label"]}).slice(0,50)})}}),r&&n.a.createElement("div",null,e),(!this.state.value||i)&&n.a.createElement(c.Button,{isColor:"info",onClick:this.handleClickCreate},"Create new item")):u.constraints&&u.constraints.enum?n.a.createElement(Q.a,{isClearable:!0,value:b(h),options:this.state.options,onChange:this.handleChange}):d?n.a.createElement(Y.a,{suggestions:m,onSuggestionsFetchRequested:E,onSuggestionsClearRequested:this.onSuggestionsClearRequested,getSuggestionValue:e=>e,renderSuggestion:this.renderSuggestion,inputProps:f}):n.a.createElement(c.Input,{value:h,onChange:this.handleChange})}render(){const{fieldSchema:e,fieldValid:t}=this.state,{showNewReference:a,newReference:s}=this.props;return n.a.createElement(c.Field,null,n.a.createElement(c.Label,null,e.name,e.constraints&&e.constraints.required&&n.a.createElement("span",null,"*")),n.a.createElement(c.Control,null,this.renderField()),t&&t.error&&!a&&!s&&n.a.createElement(c.Help,{isColor:"danger"},t.error.message))}}var ee=Z;class te extends n.a.Component{constructor(e){super(e),this.hydrateState=()=>{const{modificationItem:e}=this.props;return{fixedValue:null,showSolving:!e.fixed,fieldValid:null}},this.handleFieldChange=e=>{const{value:t,fieldValid:a}=e;this.props.onTouch(!0),this.setState({fixedValue:t,fieldValid:a})},this.handleSubmitForm=()=>{const{modificationItem:e}=this.props,{fixedValue:t,fieldValid:a}=this.state;if(!a||!a.valid)return;const s={[e.field]:t};this.props.onSubmitForm({fixedValues:s})},this.handleShowSolving=()=>{this.props.onTouch(!0),this.setState({showSolving:!0})},this.handleHideSolving=()=>{this.props.onTouch(!1),this.setState({showSolving:!1})},this.handleDiscard=()=>{this.props.onTouch(!1);const e=this.hydrateState();this.setState({...e}),this.props.onDiscard()},this.state=this.hydrateState()}componentDidUpdate(e){if(this.props.modificationIndex!==e.modificationIndex){const e=this.hydrateState();this.setState({...e})}}renderOriginal(){const{modificationItem:e}=this.props,{value:t,message:a,field:s}=e;return n.a.createElement(c.Field,null,n.a.createElement(c.Label,null,'Original value of "',s,'":'),n.a.createElement("strong",null,0===t.length?"none":t),n.a.createElement(c.Help,{isColor:"danger"},a))}renderFixed(){const{modificationItem:e}=this.props,{fixedValues:t,field:a,errors:s}=e,r=0===t[a].length?"none":t[a];return n.a.createElement(c.Field,null,n.a.createElement(c.Label,{className:"has-text-success"},"Fixed with value"),n.a.createElement("strong",{className:"has-text-success"},r),n.a.createElement(c.Help,{isColor:"success"},"total ",s.length," rows affected"),n.a.createElement(c.Button,{isColor:"info",onClick:this.handleShowSolving},"Change this fix"))}renderInput(){const{modificationItem:e,fieldDescriptor:t,isModificationTouched:a}=this.props,{fieldValid:s}=this.state,r=!s||!s.valid;return n.a.createElement("div",null,n.a.createElement(c.Label,null,"Fix with a new input"),n.a.createElement(ee,{isNonchangable:!1,fieldDescriptor:t,fieldValue:e.value,fixedValue:this.state.fixedValue,onChange:this.handleFieldChange}),n.a.createElement(c.Field,{isGrouped:!0},a&&n.a.createElement(c.Control,null,n.a.createElement(c.Button,{isColor:"info",onClick:this.handleDiscard},"Discard modification")),n.a.createElement(c.Control,null,n.a.createElement(c.Button,{isColor:"info",isDisabled:r,onClick:this.handleSubmitForm},"Confirm this fix"))))}render(){const{modificationItem:e}=this.props,{fixed:t}=e;return n.a.createElement("div",{style:{height:"60vh"}},n.a.createElement("form",null,n.a.createElement(c.Columns,null,n.a.createElement(c.Column,{isSize:"1/2"},this.renderOriginal(),t&&!this.state.showSolving&&this.renderFixed(),this.state.showSolving&&this.renderInput()))))}}var ae=te;var se=e=>{let{resource:t}=e;const{data:a,resourceName:s}=t;return n.a.createElement("div",{style:{height:"40vh",overflow:"auto"}},n.a.createElement("h3",null,a.length,' row(s) add to "',s,'" table'),a.map(e=>Object.keys(e).map(t=>n.a.createElement("div",{key:t},n.a.createElement(c.Label,null,t,":"),n.a.createElement("p",null,e[t])))))};const ne={type:0,RICname:1,continent:2,COW_code:3};class re extends n.a.Component{constructor(e){super(e),this.getStateFromProps=()=>{const{resourceDescriptor:e}=this.props,{schema:t}=e;return{fields:t.fields.reduce((e,t)=>{let a="",s=!0;if(t.constraints&&t.constraints.enum){a=t.constraints.enum[0]}return t.constraints&&t.constraints.required&&!t.constraints.enum&&(s=!1),"type"===t.name&&(a="group"),"continent"===t.name&&(a=""),{...e,[t.name]:{value:a,fieldValid:{valid:s}}}},{})}},this.handleFieldChange=e=>{this.setState({fields:{...this.state.fields,[e.fieldName]:e}})},this.handleChangeMulti=e=>{const{referenceTables:t}=this.props,a=t.ricentities,s=e?(n=e,Object(o.orderBy)(n,[e=>e.value.toLowerCase()],["asc"]).map(e=>e.value).join(" & ")):"";var n;const r=e||[],l=e?((e,t)=>{const a=e.map(e=>t.find(t=>t.RICname===e.value).continent);return a.length>1?"World":1===a.length?a[0]:null})(r,a):null;this.setState({multiParts:r,fields:{...this.state.fields,RICname:{fieldName:"RICname",value:s,fieldValid:{valid:""!==s,error:""===s?{message:"field is required"}:null}},continent:{fieldName:"continent",value:l,fieldValid:{valid:""!==l,error:""===l?{message:"field is required"}:null}}}})},this.state=this.getStateFromProps()}render(){const{resourceDescriptor:e,referenceTables:t}=this.props,{schema:a}=e,s=Object(o.values)(this.state.fields).filter(e=>e.fieldValid&&!e.fieldValid.valid),r=Object(o.sortBy)(a.fields,e=>ne[e.name]),l=X({tables:t,resourceName:"ricentities",referenceField:"RICname",filter:{field:"type",value:"group"}});return n.a.createElement("div",null,n.a.createElement("div",{style:{height:"40vh",overflow:"auto"}},n.a.createElement("h3",null,'New row to "',e.name,'" table'),r.map((e,a)=>{if("RICname"===e.name){const{value:t,fieldValid:a}=this.state.fields[e.name];return n.a.createElement(c.Field,null,n.a.createElement(c.Label,null,e.name,e.constraints&&e.constraints.required&&n.a.createElement("span",null,"*")),n.a.createElement(c.Control,null,n.a.createElement(Q.a,{isSearchable:!0,isClearable:!0,isMulti:!0,value:this.state.multiParts,options:l,onChange:this.handleChangeMulti}),n.a.createElement("div",null,t)),a&&a.error&&n.a.createElement(c.Help,{isColor:"danger"},a.error.message))}return n.a.createElement(ee,{key:a,isNonchangable:"RICname"!==e.name,referenceTables:t,fieldDescriptor:e,fieldValue:this.state.fields[e.name].value,onChange:this.handleFieldChange})})),n.a.createElement(c.Field,{isGrouped:!0},n.a.createElement(c.Control,null,n.a.createElement(c.Button,{isColor:"info",onClick:this.props.onCancel},"Cancel")),n.a.createElement(c.Control,null,n.a.createElement(c.Button,{isColor:"info",isDisabled:s.length>0,onClick:()=>{const t={newResource:{resourceName:e.name,data:[Object(o.mapValues)(this.state.fields,e=>e.value||"")]},newReference:{resourceName:"ricentities_groups",data:this.state.multiParts.map(e=>({RICname_group:this.state.fields.RICname.value,RICname_part:e.value}))}};this.props.onAddNew(t)}},"Add new"))))}}var le=re;class ie extends n.a.Component{constructor(e){super(e),this.getStateFromProps=()=>{const{resourceDescriptor:e,originalValues:t,prefixedValues:a}=this.props,{schema:s}=e;return{newResource:s.fields.reduce((e,s)=>{let n="",r=!0;return s.constraints&&s.constraints.required&&(r=!1),t&&t.find(e=>e.referenceField===s.name)&&"slug"!==s.name&&(n=t.find(e=>e.referenceField===s.name).value,r=!0),a&&a[s.name]&&(n=a[s.name],r=!0),{...e,[s.name]:{value:n,fieldValid:{valid:r}}}},{}),showNewReference:!1}},this.getSlug=e=>{let t={...this.state.newResource,[e.fieldName]:e};var a,s;return{fieldName:"slug",value:(s=t,a=Object(o.mapValues)(s,e=>e.value),O(a,(e=>["website"===e.source_category?"editor":"author","name","country","volume_date","volume_number","pages"])(a)))}},this.handleFieldChange=e=>{const{resourceDescriptor:t}=this.props;if(this.state.newResource.slug){const t=this.getSlug(e);this.setState({newResource:{...this.state.newResource,slug:t,[e.fieldName]:e}})}else"ricentities"===t.name&&"type"===e.fieldName&&"group"===e.value&&this.props.onSelectGroup(),this.setState({newResource:{...this.state.newResource,[e.fieldName]:e}})},this.handleShowNew=e=>{this.setState({showNewReference:!0})},this.handleHideNew=()=>{const{referenceMap:e}=this.state,{field:t}=e;this.setState({showNewReference:!1,newReference:null,referenceMap:null,isRICentityGroup:!1,prefixedValues:null,newResource:{...this.state.newResource,[t]:{fieldValid:{valid:!1},value:""}}})},this.handleCreateNewReference=e=>{const{referenceMap:t}=e,{field:a}=t;this.setState({showNewReference:!0,resourceValid:{valid:!0},referenceMap:t,newReference:null,newResource:{...this.state.newResource,[a]:{fieldValid:{valid:!1},value:""}}})},this.handleAddNewReference=e=>{const{newResource:t,newReference:a}=e,{field:s,referenceField:n}=this.state.referenceMap;this.setState({newReference:t,newRefReference:a,showNewReference:!1,newResource:{...this.state.newResource,[s]:{fieldValid:{valid:!0},value:t.data[0][n]}}})},this.handleResetNewReference=()=>{const{referenceMap:e}=this.state,{field:t}=e;this.setState({newReference:null,newRefReference:null,showNewReference:!0,newResource:{...this.state.newResource,[t]:{fieldValid:{valid:!1},value:""}}})},this.handleSelectGroup=()=>{this.setState({isRICentityGroup:!0})},this.state=this.getStateFromProps()}render(){const{descriptor:e,resourceDescriptor:t,referenceTables:a,originalValues:s,prefixedValues:r}=this.props,{schema:l}=t,i=Object(o.values)(this.state.newResource).filter(e=>e.fieldValid&&!e.fieldValid.valid),d=()=>{if(l.foreignKeys){const{reference:t}=l.foreignKeys[0];return e.resources.find(e=>e.name===t.resource)}};return n.a.createElement("div",null,n.a.createElement(c.Columns,null,n.a.createElement(c.Column,{style:{height:"50vh",overflow:"auto"}},n.a.createElement("h3",null,'New row to "',t.name,'" table'),Object(o.sortBy)(l.fields,e=>e.constraints&&e.constraints.required).map((e,s)=>{let i;return"sources"===t.name&&-1!==A.indexOf(e.name)&&(i=Object(o.uniq)(a.sources.map(t=>t[e.name]))),n.a.createElement(ee,{key:s,isNonchangable:-1!==x.indexOf(e.name)||r&&r[e.name],isValidationField:this.state.prefixedValues&&this.state.prefixedValues[e.name],fieldDescriptor:e,foreignKeys:l.foreignKeys,referenceTables:a,suggestedOptions:i,fieldValue:this.state.newResource[e.name]&&this.state.newResource[e.name].value||r&&r[e.name],showNewReference:this.state.showNewReference,newReference:this.state.newReference,onClickCreate:this.handleCreateNewReference,onChange:this.handleFieldChange})}),this.state.resourceValid&&this.state.resourceValid.message&&n.a.createElement(c.Field,null,n.a.createElement(c.Help,{isColor:"danger"},this.state.resourceValid.message))),l.foreignKeys&&n.a.createElement(c.Column,null,this.state.showNewReference&&(this.state.isRICentityGroup?n.a.createElement(le,{descriptor:e,resourceDescriptor:d(),referenceTables:a,onCancel:this.handleHideNew,onAddNew:this.handleAddNewReference}):n.a.createElement(ie,{descriptor:e,originalValues:s.filter(e=>"year"===e.field),resourceDescriptor:d(),referenceTables:a,prefixedValues:this.state.prefixedValues,onSelectGroup:this.handleSelectGroup,onCancel:this.handleHideNew,onAddNew:this.handleAddNewReference})),this.state.newReference&&n.a.createElement("div",null,n.a.createElement(se,{resource:this.state.newReference}),n.a.createElement(c.Button,{onClick:this.handleResetNewReference},"Reset"))),l.foreignKeys&&this.state.newRefReference&&n.a.createElement(c.Column,null,n.a.createElement(se,{resource:this.state.newRefReference}))),n.a.createElement(c.Field,{isGrouped:!0},n.a.createElement(c.Control,null,n.a.createElement(c.Button,{isColor:"info",onClick:this.props.onCancel},"Cancel")),n.a.createElement(c.Control,null,n.a.createElement(c.Button,{isColor:"info",isDisabled:i.length>0,onClick:async()=>{const e={newResource:{resourceName:t.name,data:[Object(o.mapValues)(this.state.newResource,e=>e.value||"")]},newReference:this.state.newReference,newRefReference:this.state.newRefReference};if("currencies"!==t.name||this.state.newReference)this.props.onAddNew(e);else{const t=[Object(o.keys)(e.newResource.data[0])].concat([Object(o.values)(e.newResource.data[0])]),n={exchange_rates:a.exchange_rates};let r;const i={modified_currency:this.state.newResource.modified_currency.value};try{r=await R.Table.load(t,{schema:l});const a=(await r.read({forceCast:!0,relations:n})).filter(e=>e.errors);a.length?this.setState({prefixedValues:i,resourceValid:{valid:!1,message:a[0].errors[0].errors[0].message}}):(this.setState({resourceValid:{valid:!0}}),this.props.onAddNew(e))}catch(s){this.setState({prefixedValues:i,resourceValid:{valid:!1,message:s.message||"validation fail"}}),console.error(s)}}}},"Add new"))))}}var oe=ie;class ce extends n.a.Component{constructor(e){super(e),this.initFixedValues=()=>{const{modificationItem:e}=this.props;return e.field.split("|").reduce((e,t)=>({...e,[t]:void 0}),{})},this.hydrateState=()=>{const{modificationItem:e}=this.props;let t=this.initFixedValues();return e.fixedValues&&(t=e.fixedValues),{fixedValues:t,showNewForm:!1,newResource:null,newReference:null,newRefReference:null,showSolving:!e.fixed}},this.handleSubmitForm=()=>{const{fixedValues:e,newResource:t,newReference:a,newRefReference:s}=this.state;let n=[];t&&n.push(t),a&&n.push(a),s&&n.push(s),this.props.onSubmitForm({fixedValues:e,fixedReferenceTable:n})},this.handleClickCreate=()=>{this.props.onTouch(!0);const e=this.initFixedValues();this.setState({fixedValues:e,showSolving:!0,showNewForm:!0,newResource:null,newReference:null,newRefReference:null})},this.handleResetCreate=()=>{this.setState({showNewForm:!0,newResource:null,newReference:null})},this.handleAddNewResource=e=>{const{newResource:t,newReference:a,newRefReference:s}=e,{modificationItem:n,foreignKeyField:r}=this.props,l=n.field.split("|"),i=l.reduce((e,a,s)=>{let n=l.length>1?t.data[0][r.reference.fields[s]]:t.data[0][r.reference.fields];const i=T[a];return i&&i in t.data[0]&&(n=t.data[0][i]),{...e,[a]:n}},{});this.setState({newResource:t,newReference:a,newRefReference:s,fixedValues:i,showNewForm:!1})},this.handleCancel=()=>{this.setState({showNewForm:!1,newResource:null,newReference:null,newRefReference:null})},this.handleSelectExist=e=>{const{modificationItem:t}=this.props;this.props.onTouch(!0),e?this.setState({fixedValues:{[t.field]:e.value},newResource:null}):this.setState({fixedValues:{[t.field]:""}})},this.handleShowSolving=()=>{this.props.onTouch(!0);const e=this.initFixedValues();this.setState({fixedValues:e,showSolving:!0,newResource:null,newReference:null,newRefReference:null})},this.handleHideSolving=()=>{this.props.onTouch(!1),this.setState({showSolving:!1,showNewForm:!1,newResource:null,newReference:null,newRefReference:null})},this.handleDiscard=()=>{const{modificationItem:e}=this.props;this.props.onTouch(!1);const t=this.initFixedValues();this.setState({fixedValues:t,showSolving:!e.fixed,showNewForm:!1,newResource:null,newReference:null,newRefReference:null}),this.props.onDiscard()},this.state=this.hydrateState()}componentDidUpdate(e){if(this.props.modificationIndex!==e.modificationIndex){const e=this.hydrateState();this.setState({...e})}}renderFixed(){const{modificationItem:e}=this.props,{field:t,fixedValues:a,fixedReferenceTable:s,unchangable:r,fixedStatus:l}=e,i=Object(o.values)(a).join("|"),d=i.length?i:"none",u=Object(o.difference)(x,t.split("|")).length<x.length;return n.a.createElement(c.Field,null,n.a.createElement(c.Control,null,n.a.createElement(c.Label,{className:"has-text-success"},"Fixed with value"),n.a.createElement("p",{className:"has-text-success"},d),n.a.createElement(c.Help,{isColor:"success"},!u&&n.a.createElement("li",null,"total ",e.errors.length," rows updated"),s&&s.map((e,t)=>n.a.createElement("li",{key:t},e.data.length,' row(s) added to "',e.resourceName,'" table'))),!this.state.showSolving&&n.a.createElement(c.Button,{isColor:"info",isDisabled:r,onClick:this.handleShowSolving},"Change this fix"),r&&"fixInOther"===l&&n.a.createElement(c.Help,{isColor:"success"},"found same value in other error, please fix it there"),r&&"autoFixed"===l&&n.a.createElement(c.Help,{isColor:"success"},"this foreign key error is auto fixed by previous format modification")))}renderSolving(){const{modificationItem:e,referenceTables:t,isCurrencyFixDisabled:a,schema:s}=this.props,r=s.fields.find(t=>t.name===e.field);return n.a.createElement("div",null,"source"===e.field&&!this.state.showNewForm&&!this.state.newResource&&n.a.createElement(ee,{isNonchangable:!1,foreignKeys:s.foreignKeys,fieldDescriptor:r,referenceTables:t,fixedValue:this.state.fixedValues[e.field],fieldValue:this.state.fixedValues[e.field],onClickCreate:this.handleClickCreate,onChange:this.handleSelectExist}),"source"!==e.field&&n.a.createElement(c.Field,null,n.a.createElement(c.Control,null,a&&n.a.createElement(c.Help,{isColor:"danger"},"Please fix year format error first"),n.a.createElement(c.Button,{isDisabled:a,isColor:"info",onClick:this.handleClickCreate},"Create new item"))))}render(){const{modificationItem:e,foreignKeyField:t,descriptor:a,referenceTables:s,isModificationTouched:r}=this.props,{value:l,message:i,field:d}=e,u=t.reference.resource,h=a.resources.find(e=>e.name===u),m=((e,a)=>e.split("|").map((e,s)=>({value:a.split("|")[s],field:e,referenceField:"string"===typeof t.reference.fields?t.reference.fields:t.reference.fields[s]})))(d,l),f=(e=>{switch(e){case"reporting":case"partner":case"currency|year|reporting":return"1/4";default:return"1/2"}})(e.field),p=(()=>{if(d.split("|").length>0){return Object(o.values)(this.state.fixedValues).filter(e=>void 0===e).length>0}return void 0===this.state.fixedValues[d]})();return n.a.createElement("div",{style:{height:"60vh"}},n.a.createElement("form",null,n.a.createElement(c.Columns,null,n.a.createElement(c.Column,{isSize:f},n.a.createElement(c.Field,null,n.a.createElement(c.Label,null,'Original value of "',d,'":'),n.a.createElement("div",{className:"has-text-danger"},l),n.a.createElement(c.Help,{isColor:"danger"},i)),!this.state.showSolving&&e.fixed&&this.renderFixed(),this.state.showSolving&&this.renderSolving()),this.state.showNewForm&&n.a.createElement(c.Column,{className:"new-resource-form",style:{flex:"auto"}},n.a.createElement(oe,{originalValues:m,descriptor:a,resourceDescriptor:h,referenceTables:s,onCancel:this.handleCancel,onAddNew:this.handleAddNewResource})),this.state.newResource&&n.a.createElement(c.Column,null,n.a.createElement(se,{resource:this.state.newResource}),n.a.createElement(c.Button,{onClick:this.handleClickCreate},"Reset")),this.state.newReference&&n.a.createElement(c.Column,null,n.a.createElement(se,{resource:this.state.newReference})),this.state.newRefReference&&n.a.createElement(c.Column,null,n.a.createElement(se,{resource:this.state.newRefReference}))),this.state.showSolving&&n.a.createElement(c.Field,{isGrouped:!0},r&&n.a.createElement(c.Control,null,n.a.createElement(c.Button,{isColor:"info",onClick:this.handleDiscard},"Discard modification")),n.a.createElement(c.Control,null,n.a.createElement(c.Button,{isColor:"info",isDisabled:p,onClick:this.handleSubmitForm},"Confirm this fix")))))}}var de=Object(i.b)(null,{validateResource:e=>t=>{const{descriptor:a}=e;t(async()=>{let e;try{e=y.Resource.load(a),await e.read(),t({type:"VALIDATE_RESOURCE_SUCCESS",payload:{valid:!0}})}catch(s){console.error(s),s.multiple?t({type:"VALIDATE_RESOURCE_FAILURE",payload:{rowNumber:s.rowNumber,messages:s.errors.map(e=>({...e,message:e.message}))}}):t({type:"VALIDATE_RESOURCE_FAILURE",payload:{rowNumber:s.rowNumber,messages:[{...s,message:s.message}]}})}})}})(ce);var ue=Object(i.b)(e=>({descriptor:e.schemaValidation.descriptor,referenceTables:e.referenceTables.referenceTables}))(e=>{let{className:t,flows:a,referenceTables:s,descriptor:r,schema:l,isCurrencyFixDisabled:i,isModificationTouched:c,modificationItem:d,modificationIndex:u,onDiscard:h,onTouch:m,onSubmitModification:f}=e;const p=e=>{const{fixedValues:t,fixedReferenceTable:a}=e;return f({...d,fixedValues:t,fixedReferenceTable:a,index:u})};return n.a.createElement("div",null,"ERROR_FORMAT"===d.errorType&&n.a.createElement(ae,{fieldDescriptor:(()=>{const{field:e}=d;return l.fields.find(t=>t.name===e)})(),modificationItem:d,modificationIndex:u,isModificationTouched:c,onDiscard:h,onTouch:m,onSubmitForm:p}),"ERROR_FOREIGN_KEY"===d.errorType&&n.a.createElement(de,{schema:l,descriptor:r,foreignKeyField:(()=>{let e;if(-1!==d.field.indexOf("|")){const t=d.field.split("|");e=l.foreignKeys.find(e=>Object(o.isEqual)(e.fields,t))}else e=l.foreignKeys.find(e=>e.fields===d.field);return e})(),isCurrencyFixDisabled:i,isModificationTouched:c,referenceTables:s,modificationItem:d,modificationIndex:u,onDiscard:h,onTouch:m,onSubmitForm:p}),n.a.createElement(q,{flows:a,modificationItem:d}))});var he=e=>{let{isActive:t,closeModal:a}=e;return n.a.createElement(c.Modal,{isActive:t},n.a.createElement(c.ModalBackground,{onClick:a}),n.a.createElement(c.ModalContent,null,n.a.createElement(c.Card,{bodyContent:"You have made a modification, please confirm your fix first?"})),n.a.createElement(c.ModalClose,{onClick:a}))};class me extends n.a.Component{constructor(e){super(e),this.handleTouchModification=e=>{this.setState({isModificationTouched:e})},this.handleShowAlert=()=>{this.setState({showAlert:!0})},this.handleHideAlert=()=>{this.setState({showAlert:!1})},this.state={showAlert:!1,isModificationTouched:!1}}render(){const{flows:e,schema:t,isModification:a,modificationIndex:s,modificationList:r,referenceTables:l,steps:i,selectedStep:d}=this.props,u=r.filter(e=>!1===e.fixed),h=r.filter(e=>"year"===e.field&&!e.fixed).map(e=>""+e.value),m=r[s];let f=!1;"currency|year|reporting"===m.field&&-1!==h.indexOf(m.value.split("|")[1])&&(f=!0);return n.a.createElement("div",null,!a&&n.a.createElement("div",null,r.length>0&&n.a.createElement("div",{className:"has-text-danger has-text-weight-bold"},r.length," different errors need to modify"),r&&n.a.createElement(W,{modificationList:r,onSelectError:e=>{e<r.length&&this.props.selectError({index:e})}}),n.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},n.a.createElement(c.Button,{isColor:"info",onClick:()=>{const e=Object(o.findIndex)(i,d);this.props.setStep(i[e-1])}},"Previous Step"),0===u.length?n.a.createElement(c.Button,{isColor:"info",onClick:()=>{const e=Object(o.findIndex)(i,d);this.props.setStep(i[e+1])}},"Ready to publish"):n.a.createElement(c.Button,{isColor:"info",onClick:()=>{this.props.selectError({index:u[0].index})}},"Start fix error"))),a&&n.a.createElement("div",null,n.a.createElement(ue,{flows:e,schema:t,isCurrencyFixDisabled:f,modificationIndex:s,modificationItem:m,isModificationTouched:this.state.isModificationTouched,onTouch:this.handleTouchModification,onDiscard:()=>{s<r.length-1&&u.length>0?this.props.goNextError():this.props.hideModification()},onSubmitModification:a=>{const{errors:n,errorType:i,fixedReferenceTable:o}=a;if("ERROR_FORMAT"!==i&&"source"!==a.field||this.props.updateFlows(a),"year"===a.field){const s=n.map(e=>e.rowNumber),r=e[0].indexOf("year"),i=[e[0]].concat(n.map(t=>{const s=[...e[t.rowNumber-1]];return s[r]=a.fixedValues.year,s})),o={currencies:l.currencies};this.props.revalidateRows({originalValue:a.value,fixedValues:a.fixedValues,rowNumbers:s,source:i,schema:t,relations:o})}if("ERROR_FOREIGN_KEY"===i){const e=m.fixedReferenceTable;e&&o&&e.forEach(e=>{this.props.deleteTableRow(e)}),o.forEach(e=>{this.props.addTableRow(e)})}this.props.submitModification(a),this.setState({isModificationTouched:!1}),s<r.length-1&&u.length>0?this.props.goNextError():this.props.hideModification()}}),n.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},n.a.createElement("div",null,n.a.createElement(c.Button,{isColor:"info",onClick:()=>{this.state.isModificationTouched?this.handleShowAlert():this.props.hideModification()}},"Back to summary")),n.a.createElement("span",{className:"has-text-danger has-text-weight-bold"},s+1," / ",r.length),n.a.createElement("span",null,this.state.showAlert.toString()),n.a.createElement("div",null,0!==s&&n.a.createElement(c.Button,{isColor:"info",style:{marginLeft:"10px"},onClick:()=>{this.state.isModificationTouched?this.handleShowAlert():s>0&&this.props.goPrevError()}},"Prev Error"),s!==r.length-1&&n.a.createElement(c.Button,{isColor:"info",style:{marginLeft:"10px"},onClick:()=>{this.state.isModificationTouched?this.handleShowAlert():s<r.length-1&&this.props.goNextError()}},"Next Error"))),n.a.createElement(he,{isActive:this.state.showAlert,closeModal:this.handleHideAlert})))}}var fe=Object(i.b)(e=>({flows:e.flows.data,referenceTables:e.referenceTables.referenceTables,schema:K(e),modificationList:e.modification.modificationList,steps:e.ui.steps,selectedStep:e.ui.selectedStep,isModification:e.ui.isModification,modificationIndex:e.modification.modificationIndex}),{setStep:E,updateFlows:e=>({type:"UPDATE_FLOWS",payload:e}),addTableRow:e=>({type:"ADD_TABLE_ROW",payload:e}),deleteTableRow:e=>({type:"DELETE_TABLE_ROW",payload:e}),revalidateRows:e=>t=>{const{rowNumbers:a,originalValue:s,fixedValues:n,source:r,schema:l,relations:i}=e;t({type:"REVALIDATE_ROWS_REQUEST",payload:{...e,status:"loading"}}),t(async()=>{let e;try{e=await R.Table.load(r,{schema:l});const o=await e.read({forceCast:!0,relations:i});o.filter(e=>e.errors).length?t({type:"REVALIDATE_ROWS_FAILURE",payload:{status:"done",valid:!1,rowNumbers:a,originalValue:s,fixedValues:n}}):t({type:"REVALIDATE_ROWS_SUCCESS",payload:{status:"done",valid:!0,rowNumbers:a,originalValue:s,fixedValues:n}})}catch(o){console.error(o),t({type:"REVALIDATE_ROWS_FAILURE",payload:{status:"done",valid:!1,error:o}})}})},hideModification:()=>({type:"HIDE_MODIFICATION"}),selectError:e=>({type:"SELECT_ERROR",payload:e}),goNextError:()=>({type:"GO_NEXT_ERROR"}),goPrevError:()=>({type:"GO_PREV_ERROR"}),submitModification:e=>({type:"SUBMIT_MODIFICATION",payload:e})})(me),pe=a(47),Ee=a.n(pe),ge=a(197),be=a.n(ge);function we(e,t,a){let s;const n=e[0];switch(a){case"csv":default:{const n=Object(k.unparse)(e)+"\r\n";s=new File([n],`${t}.${a}`,{type:"text/csv;charset=utf-8"}),be.a.saveAs(s);break}case"xlsx":{const s=Ee.a.utils.aoa_to_sheet(e,{header:n}),r=Ee.a.utils.book_new();Ee.a.utils.book_append_sheet(r,s,"SheetJS"),Ee.a.writeFile(r,`${t}.${a}`);break}}}function Ce(e,t,a){let s;switch(a){case"csv":default:{const n=Object(k.unparse)(e)+"\r\n";s=new File([n],`${t}.${a}`,{type:"text/csv;charset=utf-8"}),be.a.saveAs(s);break}}}var ve=a(21);class ye extends n.a.Component{constructor(e){super(e),this.handleChangeToken=e=>{this.setState({token:e.target.value})},this.handleChangeMessage=e=>{this.setState({message:e.target.value})},this.handleSubmit=()=>{this.props.onSubmitAuth(this.state)},this.state={token:"",message:""}}render(){const{isActive:e,isCommit:t,closeModal:a}=this.props;let s=!this.state.token;return t&&(s=!this.state.token||!this.state.message),n.a.createElement(ve.Modal,{isActive:e},n.a.createElement(ve.ModalBackground,{onClick:a}),n.a.createElement(ve.ModalCard,null,n.a.createElement(ve.ModalCardBody,null,n.a.createElement(c.Field,null,n.a.createElement(c.Label,null,"personal access token*:"),n.a.createElement(c.Control,null,n.a.createElement(c.Input,{type:"password",value:this.state.token,onChange:this.handleChangeToken}))),t&&n.a.createElement(c.Field,null,n.a.createElement(c.Label,null,"commit message*:"),n.a.createElement(c.Control,null,n.a.createElement(c.Input,{value:this.state.message,onChange:this.handleChangeMessage}))),n.a.createElement(c.Field,null,s&&n.a.createElement(c.Help,{isColor:"danger"},"requied field is missing"),n.a.createElement(c.Button,{isDisabled:s,isColor:"info",onClick:this.handleSubmit},t?"Commit":"Login")))),n.a.createElement(ve.ModalClose,{onClick:a}))}}var Re=ye;class Se extends n.a.Component{constructor(e){super(e),this.handleOpenModal=()=>{this.setState({isModalShow:!0})},this.handleCloseModal=()=>{this.setState({isModalShow:!1})},this.state={isModalShow:!1}}render(){const{flows:e,repoData:t,referenceTables:a,originalLength:s}=this.props,{selectedBranch:r,remoteUpdateStatus:l,lastCommit:i,remoteUpdateMessage:d,tables:u}=t;let h=[];Object.keys(a).forEach(e=>{a[e].length!==s[e]&&h.push({name:e,updatedRows:a[e].slice(s[e])})});let f={};try{const t=Object(o.keyBy)(a.sources,e=>e.slug),s=Object(m.b)(Object(m.a)(e.data));f=Object(o.groupBy)(s,e=>{return a=t[e.source],Object(o.deburr)(O(a,["website"===a.source_category?"editor":"author","name","country","volume_date","volume_number"]));var a})}catch(p){console.log(p),E(2)}return n.a.createElement("div",null,n.a.createElement(c.Columns,null,n.a.createElement(c.Column,null,n.a.createElement("strong",null,"fixed flows table by source"),Object.keys(f).map(e=>n.a.createElement("p",null,e,".csv"))),n.a.createElement(c.Column,null,n.a.createElement("div",null,n.a.createElement("strong",null,"updated reference tables"),h.map(e=>{const t=this.props.repoData.descriptor.resources.find(t=>t.name===e.name);if(!t)throw new Error(`Resource ${e.name} can't be found in descriptor.`);const s=t.path.split(".")[0].split("/").slice(-1)[0];return n.a.createElement(c.Control,null,n.a.createElement("a",{href:"#",onClick:()=>{Ce(a[e.name],s,"csv")}},s," table: ",e.updatedRows.length," rows added"))})))),n.a.createElement(c.Field,{isGrouped:!0},n.a.createElement(c.Control,null,n.a.createElement(c.Button,{isColor:"info",onClick:()=>{const{file:t,data:a}=e;we(a,t.name+"_corrections","csv")}},"Download fixed flows")),n.a.createElement(c.Control,null,"updated"===l?n.a.createElement(c.Button,{isColor:"success",onClick:()=>{this.props.setStep({id:"0"})}},"Start a new import"):n.a.createElement(c.Button,{isDisabled:"loading"===l,isColor:"info",onClick:this.handleOpenModal},'Publish tables to "',r.name,'" branch'))),n.a.createElement(c.Field,null,"loading"===l&&n.a.createElement(c.Help,{isColor:"success"},"updating files on github: ",d,"..."),"updated"===l&&n.a.createElement(c.Help,{isColor:"success"},"files have been commited on github see"," ",n.a.createElement("a",{href:`https://github.com/${F.c}/${F.e}/commit/${i}`},"commit details")),"fail"===l&&n.a.createElement(c.Help,{isColor:"danger"},"fail to update files on github")),n.a.createElement(Re,{isActive:this.state.isModalShow,isCommit:!0,closeModal:this.handleCloseModal,onSubmitAuth:e=>{this.handleCloseModal();const t=Object.keys(f).map(e=>({filePath:`data/flows/${e}.csv`,data:f[e],source:e})),s=h.map(e=>{const t=this.props.repoData.descriptor.resources.find(t=>t.name===e.name);if(!t)throw new Error(`Resource ${e.name} can't be found in descriptor.`);return{filePath:t.path,data:a[e.name],sha:u[e.name].sha}});this.props.updateRemoteFiles({auth:e,files:t.concat(s),branch:r.name,descriptor:this.props.repoData.descriptor})}}))}}var Te=Object(i.b)(e=>({flows:e.flows,referenceTables:e.referenceTables.referenceTables,originalLength:e.referenceTables.originalLength,repoData:e.repoData}),{setStep:E,exportFlows:e=>({type:"EXPORT_FLOWS"}),updateRemoteFiles:e=>t=>{t({type:"UPDATE_REMOTE_FILES_REQUEST"});const{files:a,branch:s,auth:n,descriptor:r}=e,l=new L.a({token:n.token});t(async()=>{try{let i=await l.repos(F.c,F.e).fetch(),o=await i.git.refs("heads/"+s).fetch(),c=r.resources.find(e=>"flows"===e.name),d=r.resources.find(e=>"flows"===e.group),u=[];for(let n of a){if(!n.sha&&n.filePath.includes("flows")){t({type:"UPDATE_REMOTE_FILES_LOG",payload:"downloading existing flows file "+n.filePath});try{const e=await Object(N.get)(`${F.f}/${s}/${n.filePath}?cb=${Date.now()}`,{responseType:"text",responseEncoding:"utf8"});200===e.status&&(n.data=Object(m.b)(e.data).concat(n.data))}catch(e){if(!e.response||404!==e.response.status)return console.log(e),void t({type:"UPDATE_REMOTE_FILES_FAILURE",error:e});if(c)c.path.push(n.filePath);else if(d){const e={...d};e.path=n.filePath,e.title=n.source,r.resources.push(e)}}}t({type:"UPDATE_REMOTE_FILES_LOG",payload:"uploading "+n.filePath});let a=await i.git.blobs.create({content:D.Base64.encode(Object(k.unparse)(n.data)+"\r\n"),encoding:"base64"});u.push({path:n.filePath,sha:a.sha,mode:"100644",type:"blob"})}t({type:"UPDATE_REMOTE_FILES_LOG",payload:"uploading datapackage"});let h=await i.git.blobs.create({content:D.Base64.encode(JSON.stringify(r,null,2)),encoding:"base64"}),f="datapackage.json";u.push({path:f,sha:h.sha,mode:"100644",type:"blob"}),t({type:"UPDATE_REMOTE_FILES_LOG",payload:"creating tree"});let p=await i.git.trees.create({tree:u,base_tree:o.object.sha});t({type:"UPDATE_REMOTE_FILES_LOG",payload:"creating commit"});let E=await i.git.commits.create({message:n.message||"update data",tree:p.sha,parents:[o.object.sha]});o.update({sha:E.sha}),t({type:"UPDATE_REMOTE_FILES_SUCCESS",payload:E.sha})}catch(i){console.error(i),t({type:"UPDATE_REMOTE_FILES_FAILURE",err:i})}})}})(Se);class xe extends n.a.Component{constructor(e){super(e),this.handleShowLogin=()=>{this.setState({isModalShow:!0})},this.handleCloseModal=()=>{this.setState({isModalShow:!1})},this.handleLogin=e=>{this.props.loginCreateBranch(e),this.handleCloseModal()},this.state={isModalShow:!1}}renderFetchTable(){const{repoData:e}=this.props,{selectedBranch:t,tables:a,isBranchCreated:s}=e;return n.a.createElement("div",null,s?n.a.createElement(c.Help,{isColor:"success"},'branch "',t.name,'" is created'):n.a.createElement(c.Help,{isColor:"danger"},"could not get branch from github, try login again"),t&&!a&&n.a.createElement(c.Button,{isColor:"info",onClick:()=>{this.props.fetchAllTables({branch:t.name})}},"Fetch table from branch ",t.name),t&&(a?n.a.createElement(c.Help,{isColor:"success"},"tables from ",t.name," branch are loaded"):n.a.createElement(c.Help,{isColor:"danger"},"tables are not loaded, please reload from ",t.name," branch")))}render(){const{repoData:e}=this.props,{selectedBranch:t,isLogined:a}=e;return n.a.createElement("div",null,!a&&n.a.createElement(c.Button,{isColor:"info",onClick:this.handleShowLogin},n.a.createElement("span",null,"Login to get branch")),a&&n.a.createElement(c.Button,{isColor:"info",onClick:this.props.logoutUser},n.a.createElement("span",null,"Logout")),t&&this.renderFetchTable(),n.a.createElement(Re,{isActive:this.state.isModalShow,isCommit:!1,closeModal:this.handleCloseModal,onSubmitAuth:this.handleLogin}))}}var _e=Object(i.b)(e=>({repoData:e.repoData}),{logoutUser:()=>({type:"LOGOUT_USER"}),loginCreateBranch:e=>t=>{t({type:"LOGIN_CREATE_BRANCH_REQUEST",payload:e});const{token:a}=e,s=new L.a({token:a});t(async()=>{try{const e=(await s.user.fetch()).login;let a=await s.repos(F.c,F.e).fetch(),n=await a.branches.fetch(),r=n.items.find(t=>t.name===e);if(!r){const t=n.items.find(e=>"master"===e.name);r=await a.git.refs.create({ref:"refs/heads/"+e,sha:t.commit.sha})}t({type:"LOGIN_CREATE_BRANCH_SUCCESS",payload:{name:e,ref:r}})}catch(e){console.error(e),t({type:"LOGIN_CREATE_BRANCH_FAILURE",payload:{error:e}})}})},fetchAllTables:V})(xe);var Oe=e=>{let{headerNames:t,fieldNames:a}=e;const s=t.length-a.length;let r;r=s>0?Object(o.difference)(t,a):Object(o.difference)(a,t);const l=t.map((e,t)=>a[t]&&a[t]===e?{name:e,valid:!0}:{name:e,valid:!1});return n.a.createElement("div",{style:{}},r.length===s&&s>0&&n.a.createElement("div",{className:"has-text-danger"},n.a.createElement("span",null,"Extra headers - "),r.map(e=>n.a.createElement("span",null,'"',e,'" '))),r.length===Math.abs(s)&&s<0&&n.a.createElement("div",{className:"has-text-danger has-text-weight-bold"},n.a.createElement("span",null,"Missing headers - "),r.map(e=>n.a.createElement("span",null,'"',e,'" '))),n.a.createElement("div",{style:{display:"flex",justifyContent:"space-evenly"}},n.a.createElement("div",null,n.a.createElement("div",{className:"has-text-weight-bold"},"headers "),l.map((e,t)=>n.a.createElement("div",{key:t,className:e.valid?"has-text-black":"has-text-danger"},e.name))),n.a.createElement("div",null,n.a.createElement("div",{className:"has-text-weight-bold"},"schema fields"),a.map((e,t)=>n.a.createElement("div",{key:t},e)))))},Ae=a(925);const Ne=(e,t)=>{const a=t.foreignKeys.map(e=>Array.isArray(e.fields)?e.fields:[e.fields]).reduce((t,a)=>(a.forEach(a=>{if("source"!==a){const s=e[0].indexOf(a);t.includes(s)||t.push(s)}}),t),[]);return e.map((e,t)=>0!==t?e.map((e,t)=>a.includes(t)&&e.toLowerCase?e.toLowerCase().trim():e):e)};var Fe=Object(i.b)(e=>({steps:e.ui.steps,selectedStep:e.ui.selectedStep,schema:e.repoData.descriptor&&K(e),flows:e.flows,tables:e.repoData.tables,headerFeedback:e.schemaValidation.headerFeedback,repoData:e.repoData}),{importFlows:e=>({type:"IMPORT_FLOWS",payload:e}),setStep:E,validateHeader:e=>t=>{const{source:a,schema:s}=e;t({type:"VALIDATE_HEADER_REQUEST",payload:{...e,status:"loading"}}),t(async()=>{let e;try{e=await R.Table.load(a.slice(0,2),{schema:s}),await e.read({limit:1}),t({type:"VALIDATE_HEADER_SUCCESS",payload:{status:"done",valid:!0,headers:e.headers}})}catch(n){console.error(n),"ERROR_HEADER"!==n.type?t({type:"VALIDATE_HEADER_SUCCESS",payload:{status:"done",valid:!0,headers:e.headers}}):t({type:"VALIDATE_HEADER_FAILURE",valid:!1,status:"done",payload:n})}})},fetchAllTables:V})(e=>{let{steps:t,selectedStep:a,schema:s,tables:r,flows:l,headerFeedback:i,setStep:d,importFlows:u,validateHeader:h,repoData:f,fetchAllTables:p}=e;return n.a.createElement("div",null,n.a.createElement(_e,null),r&&n.a.createElement(c.DropZone,{maxSize:1e7,onDrop:e=>{let[t]=e;"xlsx"===t.name.split(".")[1]?function(e){return new Promise((t,a)=>{let s=new FileReader;s.onload=e=>{const a=e.target.result,n=Ee.a.read(a,{type:"binary"}),r=n.SheetNames[0],l=n.Sheets[r],i=Ee.a.utils.sheet_to_json(l,{header:1,defval:"",blankrows:!1});t(i),s=void 0},s.onerror=e=>{a(e.target.error),s=void 0},s.readAsBinaryString(e)})}(t).then(e=>{e=Ne(e,s),u({file:{name:t.name.split(".")[0]},data:e}),h({source:e,schema:s}),p({branch:f.selectedBranch.name})}).catch(e=>{console.error(e),console.error("fail to parse file")}):function(e){return new Promise((t,a)=>{let s=new FileReader;return s.onload=a=>{let n;n="csv"===e.name.split(".")[1]?Object(m.c)(a.target.result):Object(Ae.a)(a.target.result),t(n),s=void 0},s.onerror=e=>{a(e.target.error),s=void 0},s.readAsText(e)})}(t).then(e=>{e=Ne(e,s),u({file:{name:t.name},data:e}),h({source:e,schema:s}),p({branch:f.selectedBranch.name})}).catch(e=>{console.error(e),console.error("fail to parse file")})},onDropRejected:(e,t)=>{console.log("file is invalid")},isSize:"small"},n.a.createElement("span",{className:"tech-info"},"Cick here to upload or drag and drop .xlsx, .csv file here(maximum 10MB)")),i&&"loading"===i.status&&n.a.createElement("span",null,"Validating Headers"),i&&i.valid&&n.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},n.a.createElement("span",{className:"has-text-success has-text-weight-bold"},'Headers of "',l.file.name,'" are valid'),n.a.createElement(c.Button,{isColor:"info",onClick:()=>{const e=Object(o.findIndex)(t,a);d(t[e+1])}},"Next Step")),i&&!i.valid&&"ERROR_HEADER"===i.type&&n.a.createElement("div",{style:{textAlign:"center"}},n.a.createElement("span",{className:"has-text-danger has-text-weight-bold"},'Headers of "',l.file.name,'" do not match schema fields, please fix your file and re-upload'),n.a.createElement(Oe,{headerNames:i.headerNames,fieldNames:i.fieldNames})))});var Ie=e=>{let{className:t,collectedErrors:a}=e;const s=["Field","Error Type","Error Overview"],r=Object(o.sortBy)(a,e=>S[e.name]);return n.a.createElement("div",{style:{position:"relative",width:"100%",height:"70vh"}},n.a.createElement("div",{className:"action-table "+t},n.a.createElement("div",{className:"action-table-header"},s.map((e,t)=>n.a.createElement("div",{key:t,className:"table-cell"},e))),n.a.createElement("div",{className:"action-table-main"},r.map((e,t)=>{const a=e.errors.length,r=Object(o.groupBy)(e.errors,e=>e.value),l=Object.keys(r).length;return n.a.createElement("div",{key:t,className:"table-row"},s.map((t,s)=>{let r=[];return"ERROR_FORMAT"!==e.errorType||"reporting"!==e.name&&"partner"!==e.name||(r=e.errors.map(e=>e.rowNumber)),0===s?n.a.createElement("div",{key:s,className:"table-cell"},e.name):1===s?n.a.createElement("div",{key:s,className:"table-cell"},e.errorType):n.a.createElement("div",{key:s,className:"table-cell"},n.a.createElement("span",null,l," different invalid values, ",a," rows affected in total"),r.map(e=>n.a.createElement("li",{className:"has-text-danger"},"missing value in row ",e)))}))}))))};class Le extends n.a.Component{componentDidMount(){const{flows:e,schema:t,relations:a,schemaFeedback:s}=this.props;s||this.props.validateTable({source:e,schema:t,relations:a})}render(){const{schemaFeedback:e,modificationList:t,steps:a,selectedStep:s}=this.props;let r=!1;e&&e.collectedErrors&&(r=e.collectedErrors.reporting&&"ERROR_FORMAT"===e.collectedErrors.reporting.errorType||e.collectedErrors.partner&&"ERROR_FORMAT"===e.collectedErrors.partner.errorType);return n.a.createElement("div",null,e&&"loading"===e.status&&n.a.createElement("span",null,e.loader),n.a.createElement("div",null,e&&!e.valid&&e.collectedErrors&&n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:"has-text-danger has-text-weight-bold"},"Found errors in ",e.errors.length," rows of"," ",Object.keys(e.collectedErrors).length," fields",r&&n.a.createElement("span",null,", value of required field is missing, please fix it locally first")),n.a.createElement(Ie,{collectedErrors:e.collectedErrors})),e&&e.valid&&n.a.createElement("span",{className:"has-text-success has-text-weight-bold"},"Flows data is valid"),n.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},n.a.createElement(c.Button,{isColor:"info",onClick:()=>{const e=Object(o.findIndex)(a,s);this.props.setStep(a[e-1])}},"Previous Step"),e&&!e.valid&&e.collectedErrors&&n.a.createElement(c.Button,{isColor:"info",isDisabled:r,onClick:()=>{if(!t){const t=(e=>{const t=Object(o.values)(e).reduce((e,t)=>e.concat(t.errors),[]),a=Object(o.values)(Object(o.groupBy)(t,e=>e.field+e.value)).map((e,t)=>({index:t,field:e[0].field,errorType:e[0].errorType,fixed:!1,message:e[0].message.replace(G,e.length+" rows"),originalValue:e[0].value,value:e[0].value,errors:e}));return Object(o.sortBy)(a,e=>S[e.name])})(e.collectedErrors);this.props.startModification(t)}const n=Object(o.findIndex)(a,s);this.props.setStep(a[n+1])}},"Review Errors"),e&&e.valid&&n.a.createElement(c.Button,{isColor:"info",isDisabled:r,onClick:()=>this.props.setStep(a[3])},"Publish"))))}}var De=Object(i.b)(e=>({steps:e.ui.steps,selectedStep:e.ui.selectedStep,flows:e.flows.data,schema:K(e),relations:$(e),schemaFeedback:e.schemaValidation.schemaFeedback,modificationList:e.modification.modificationList}),{validateTable:e=>t=>{const{source:a,schema:s,relations:n}=e;t(async()=>{try{const e=a.length,r=100;let l=[];const i=a[0],c=Object(o.chunk)(a.slice(1),r);let d=0;for(const a of c){t({type:"VALIDATE_TABLE_REQUEST",payload:{status:"loading",loader:`validating ${d*r}/${e-1} rows`}});const o=await R.Table.load([i].concat(a),{schema:s}),c=(await o.read({forceCast:!0,relations:n})).filter(e=>e.errors);if(c.length)for(const e of c)e.rowNumber=e.rowNumber+r*d,l.push(e);d+=1}l.length?t({type:"VALIDATE_TABLE_FAILURE",payload:{status:"done",valid:!1,errors:l,collectedErrors:B(a,s,l)}}):t({type:"VALIDATE_TABLE_SUCCESS",payload:{status:"done",valid:!0}})}catch(e){console.error(e),t({type:"VALIDATE_TABLE_FAILURE",payload:e})}})},setStep:E,startModification:e=>({type:"START_MODIFICATION",payload:e})})(Le);var ke=e=>{let{steps:t,selectedStep:a,onSetStep:s,children:r}=e;return n.a.createElement(c.LayoutWrapper,{hasConfig:!0},n.a.createElement(c.LayoutHeader,null,n.a.createElement(c.AppTitle,null,"Ricardo Data App"),n.a.createElement(c.RunningTitle,null,a.title)),n.a.createElement(c.LayoutContainer,null,n.a.createElement(c.LayoutContent,null,n.a.createElement(c.LayoutContentColumn,{isConfig:!0},t.map((e,t)=>{const r=a.id===e.id,l=e.id>a.id;return n.a.createElement(c.ButtonContainer,{key:t},n.a.createElement(c.Button,{isColor:r?"info":null,isDisabled:l,onClick:()=>s(e)},e.name))})),n.a.createElement(c.LayoutContentColumn,{isWorkspace:!0},r)),n.a.createElement(c.LayoutFooter,null,n.a.createElement(c.LayoutFooterColumn,{isSecondary:!0},n.a.createElement("h3",null,"m\xe9dialab SciencesPo")),n.a.createElement(c.LayoutFooterColumn,{isPrimary:!0},"Ricardo Data App"))))};a(918),a(919);var Ve=e=>{let{originalLength:t,referenceTables:a,onSelectDiscard:s,onSelectDownload:r,isActive:l,closeModal:i}=e,o=[];return a&&Object.keys(a).forEach(e=>{a[e].length!==t[e]&&o.push({name:e,updatedRows:a[e].slice(t[e])})}),n.a.createElement(ve.Modal,{isActive:l},n.a.createElement(ve.ModalBackground,{onClick:i}),n.a.createElement(ve.ModalCard,null,n.a.createElement(ve.ModalCardBody,null,n.a.createElement("div",{style:{textAlign:"center"}},n.a.createElement("h5",{className:"title is-5"},"Leave this step, you might lost your modification?"),o.length>0&&n.a.createElement("p",null,"updated reference tables"),o.map((e,t)=>n.a.createElement("div",{key:t},n.a.createElement("a",{href:"#",onClick:()=>{Ce(a[e.name],e.name,"csv")}},e.name," table: ",e.updatedRows.length," rows added"))),n.a.createElement(c.Field,{isGrouped:!0},n.a.createElement(c.Control,null,n.a.createElement(c.Button,{onClick:r,isColor:"success"},"Download fixed flows")),n.a.createElement(c.Control,null,n.a.createElement(c.Button,{onClick:s,isColor:"danger"},"Discard")),n.a.createElement(c.Control,null,n.a.createElement(c.Button,{onClick:i,isColor:"info"},"Cancel")))))),n.a.createElement(ve.ModalClose,{onClick:i}))};var Me=Object(i.b)(e=>({steps:e.ui.steps,isModalDisplay:e.ui.isModalDisplay,flows:e.flows,referenceTables:e.referenceTables.referenceTables,originalLength:e.referenceTables.originalLength,selectedStep:e.ui.selectedStep,modificationList:e.modification.modificationList,repoData:e.repoData}),{showModal:()=>({type:"SHOW_CONFIRMATION_MODAL"}),hideModal:()=>({type:"HIDE_CONFIRMATION_MODAL"}),setStep:E})(e=>{let{steps:t,isModalDisplay:a,selectedStep:s,repoData:r,flows:l,referenceTables:i,originalLength:o,modificationList:c,setStep:d,showModal:u,hideModal:h}=e;return n.a.createElement("div",{className:"App"},n.a.createElement(ke,{steps:t,selectedStep:s,onSetStep:e=>{const{remoteUpdateStatus:t}=r;let a;c&&(a=c.filter(e=>e.fixed)),a&&"0"===e.id&&"updated"!==t?u():d(e)}},(()=>{switch(s.id){case"0":default:return n.a.createElement(Fe,null);case"1":return n.a.createElement(De,null);case"2":return n.a.createElement(fe,null);case"3":return n.a.createElement(Te,null)}})()),n.a.createElement(Ve,{referenceTables:i,originalLength:o,isActive:a,onSelectDiscard:()=>{d(t[0])},onSelectDownload:()=>{const{file:e,data:t}=l;we(t,e.name+"_ongoing_corrections","csv")},closeModal:h}))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var je=a(17),Be=a(198),Ue=a(351),Pe=a(128),He=Object(je.combineReducers)({ui:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;const{payload:a}=t;switch(t.type){case"SET_STEP":return{...b,selectedStep:g.find(e=>a.id===e.id)};case"SHOW_CONFIRMATION_MODAL":return{...e,isModalDisplay:!0};case"HIDE_CONFIRMATION_MODAL":return{...e,isModalDisplay:!1};case"START_MODIFICATION":return{...e,isModification:!0};case"HIDE_MODIFICATION":return{...e,isModification:!1};case"SELECT_ERROR":return{...e,isModification:!0};default:return e}},flows:C,referenceTables:p,schemaValidation:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0;const{payload:a}=t;switch(t.type){case"SET_STEP":return"0"===a.id?{...e,schemaFeedback:null,headerFeedback:null}:e;case"FETCH_DATAPACKAGE_SUCCESS":return{...e,descriptor:a};case"VALIDATE_HEADER_REQUEST":case"VALIDATE_HEADER_FAILURE":case"VALIDATE_HEADER_SUCCESS":return{...e,headerFeedback:a};case"VALIDATE_TABLE_REQUEST":case"VALIDATE_TABLE_FAILURE":case"VALIDATE_TABLE_SUCCESS":return{...e,schemaFeedback:a};default:return e}},modification:h,repoData:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=arguments.length>1?arguments[1]:void 0;const{payload:a}=t;switch(t.type){case"LOGOUT_USER":return{...e,isLogined:!1,tables:null,selectedBranch:null,isBranchCreated:!1};case"INIT_TABLES":return{...e,tables:null,remoteUpdateStatus:null};case"FETCH_TABLES_SUCCESS":return{...e,tables:a};case"FETCH_TABLES_FAILURE":return{...e,tables:null};case"FETCH_DATAPACKAGE_SUCCESS":return{...e,descriptor:a};case"FETCH_BRANCHES_SUCCESS":return{...e,branches:a.branches};case"LOGIN_CREATE_BRANCH_SUCCESS":return{...e,isLogined:!0,selectedBranch:a,isBranchCreated:!0};case"LOGIN_CREATE_BRANCH_FAILURE":return{...e,isLogined:!1,selectedBranch:null,isBranchCreated:!1};case"UPDATE_REMOTE_FILES_REQUEST":return{...e,remoteUpdateStatus:"loading",lastCommit:null,remoteUpdateMessage:null};case"UPDATE_REMOTE_FILES_LOG":return{...e,remoteUpdateStatus:"loading",remoteUpdateMessage:a};case"UPDATE_REMOTE_FILES_SUCCESS":return{...e,remoteUpdateStatus:"updated",lastCommit:a};case"UPDATE_REMOTE_FILES_FAILURE":return{...e,remoteUpdateStatus:"fail"};default:return e}}});const Ge={key:"root",storage:Ue},Ke=Object(Be.a)(Ge,He);const{store:$e}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=[],a=[Pe.a],s=Object(je.compose)(Object(je.applyMiddleware)(...a),...t);let n=Object(je.createStore)(Ke,e,s),r=Object(Be.b)(n);return{store:n,persistor:r}}({});l.a.render(n.a.createElement(i.a,{store:$e},n.a.createElement(Me,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()})}},[[353,1,2]]]);
//# sourceMappingURL=main.154271d4.chunk.js.map